<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
		<meta name="og:description" content="Every year we seem to buy a bigger Christmas tree. This year is no exception and it is now proving difficult to maneuver around it to turn the lights on and off. To fix this, I&#39;ve connected my lights up to a Belkin WeMo and I&#39;m running the excellent Homebridge1 server so that I can control it all via Siri:Hat tip to Luke Redpath for introducing me to Homebridge.&nbsp;&#8617;">
	
	<link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'>
	<link rel="alternate" type="application/rss+xml" title="The Blog of Ben Dodson - iPhone Developer and WallaBee Founder" href="https://bendodson.com/rss.xml" />
	<link rel="stylesheet" href="/styles-2015-12-20.css" />
	<link rel="stylesheet" href="/highlight.css" />
	<title>HomeKit enabled Christmas tree lights with Siri control</title>
</head>
<body>

	<div id="wrapper">

		<header>
			<hgroup>
				<h1><a href="/">Ben Dodson</a></h1>
				<h2>Freelance iOS, Apple Watch, and Apple TV Developer</h2>
			</hgroup>
			<nav>
				<ul>
					<li><a href="/">Home</a></li><li><a href="/weblog/">Blog</a></li><li><a href="/about/">About</a></li><li><a href="/clients/">Portfolio</a></li><li><a href="/apps/">Apps</a></li><li><a href="/projects/">Projects</a></li><li><a href="/contact/">Contact</a></li>
				</ul>
				<div class="divider"></div>
			</nav>
		</header>

		<section id="posts">
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/12/01/homekit-christmas-tree-with-siri/">HomeKit enabled Christmas tree lights with Siri control</a></h1>
			
			<time datetime="2015-12-01" pubdate=""><a href="/weblog/2015/12/01/homekit-christmas-tree-with-siri/">December 01, 2015</a></time>
    	</header>
    	<div>
			<p>Every year we seem to buy a bigger Christmas tree. This year is no exception and it is now proving difficult to maneuver around it to turn the lights on and off. To fix this, I&#39;ve connected my lights up to a <a href="http://www.belkin.com/uk/F7C027/p/P-F7C027/">Belkin WeMo</a> and I&#39;m running the excellent <a href="https://github.com/nfarina/homebridge">Homebridge</a><sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup> server so that I can control it all via Siri:</p>

<iframe width="800" height="450" src="https://www.youtube.com/embed/xBuMQ-PMyeY?rel=0" frameborder="0" allowfullscreen></iframe>

<p>To get this up and running on your own machine, you&#39;ll need to do the following in the Mac Terminal:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ruby -e <span class="s2">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span>
brew install node
sudo npm install -g homebridge
sudo npm install -g homebridge-wemo
homebridge</code></pre></div>

<p>This will install brew, install node, install Homebridge, install the WeMo plugin for Homebridge, and then attempt to run Homebridge (which will fail as you have no config file). Next, you&#39;ll want to go to <code>~/.homebridge</code> and create a config.json file that looks like this:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&quot;bridge&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Homebridge&quot;</span><span class="p">,</span>
        <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;CC:22:3D:E3:CE:30&quot;</span><span class="p">,</span>
        <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">51826</span><span class="p">,</span>
        <span class="nt">&quot;pin&quot;</span><span class="p">:</span> <span class="s2">&quot;031-45-154&quot;</span>
    <span class="p">},</span>
    
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This is an example configuration file with all supported devices. You can use this as a template for creating your own configuration file containing devices you actually own.&quot;</span><span class="p">,</span>

    <span class="nt">&quot;accessories&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;accessory&quot;</span><span class="p">:</span> <span class="s2">&quot;WeMo&quot;</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Christmas Tree&quot;</span><span class="p">,</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This shim supports Belkin WeMo devices on the same network as this server. You can create duplicate entries for this device and change the &#39;name&#39; attribute to reflect what device is plugged into the WeMo, for instance &#39;Air Conditioner&#39; or &#39;Coffee Maker&#39;. This name will be used by Siri. Make sure to update the &#39;wemo_name&#39; attribute with the EXACT name of the device in the WeMo app itself. This can be the same value as &#39;name&#39; but it doesn&#39;t have to be.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;wemo_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Christmas Tree&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></div>

<p>The important part is to make sure that the <code>wemo_name</code> matches the name of your device within the WeMo app; the <code>name</code> attribute is what you want your device to be called on HomeKit. Run the <code>homebridge</code> command again and you should see that your device is found and Homebridge is running.</p>

<p>Next, you&#39;ll need to get a HomeKit enabled app to run all of this. My recommendation is to use the one that Apple provides to developers, <a href="https://developer.apple.com/library/ios/samplecode/HomeKitCatalog/Introduction/Intro.html">HomeKit Catalog</a>, although that will require you to know how to sideload apps from Xcode. Alternatively you can download the <a href="https://itunes.apple.com/app/elgato-eve/id917695792">Elgato Eve app</a>. Once you have an app, you&#39;ll need to add the Homebridge using the pin that is in your config file. You can play around with the app and create rooms, scenes, zones, etc, but for now the basic commands should work. If you can turn your device on and off via the HomeKit enabled app, you will be able to activate Siri and say &quot;<em>turn on the Christmas tree</em>&quot;, &quot;<em>turn off the Christmas tree</em>&quot;, and &quot;<em>is the Christmas tree on?</em>&quot;.</p>

<p>Added bonus: if you have an Apple TV, you are signed into iCloud, and you use iCloud keychain, then you&#39;ll be able to use all of these voice commands when you&#39;re outside of your house! It&#39;s a pretty useful way to activate these devices and I have several of them dotted around my home<sup id="fnref2"><a href="#fn2" rel="footnote">2</a></sup>. Homebridge also supports many other services such as Philips Hue (without the need for their HomeKit bridge) and you can write your own plugins very easily<sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup>.</p>

<p>My next task is to dig out some code I wrote last year to turn the tree lights on and off automatically depending on if I&#39;m in the house using an iBeacon...</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>Hat tip to <a href="http://lukeredpath.co.uk/">Luke Redpath</a> for introducing me to Homebridge.&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

<li id="fn2">
<p>After my wife asked me for the 62nd time if she&#39;d left her straighteners plugged in whilst we were driving in the car, I set up the plug near her dresser with a WeMo so she can use Siri to ask &quot;<em>are my straighteners turned on?</em>&quot; and &quot;<em>turn off the straighteners</em>&quot; if need be!&nbsp;<a href="#fnref2" rev="footnote">&#8617;</a></p>
</li>

<li id="fn3">
<p>I&#39;ve written a <a href="https://github.com/bendodson/homebridge-prismatik">very basic plugin</a> for the <a href="http://lightpack.tv/">Prismatik Light Pack</a>.&nbsp;<a href="#fnref3" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>

		</div>
	</article>
</section>

<section id="pagination">
	 
		<a href="/weblog/2015/12/02/introducing-the-divide/" title="Next Article" class="pagination-next">Introducing 'The Divide' &raquo;</a>
    
	 
		<a href="/weblog/2015/11/27/brapp-v1.1/" title="Previous Article" class="pagination-previous">&laquo; Brapp v1.1</a>
    
</section>
		
		<footer>
			<p>I perform all freelance work through my company <strong>Dodo Apps Ltd</strong> (07856552) registered at The Bristol Office, 2nd Floor, 5 High Street, Westbury on Trym, Bristol, England, BS9 3BY</p>
		</footer>

	</div>

</body>
</html>