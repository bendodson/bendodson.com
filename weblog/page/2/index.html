<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	<link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'>
	<link rel="alternate" type="application/rss+xml" title="The Blog of Ben Dodson - iPhone Developer and WallaBee Founder" href="https://bendodson.com/rss.xml" />
	<link rel="stylesheet" href="/styles-2016-01-13-updated.css" />
	<link rel="stylesheet" href="/highlight.css" />
	<title>Ben Dodson's Blog &mdash; Freelance Swift Developer and WallaBee Founder</title>
</head>
<body>

	<div id="wrapper">

		<header>
			<hgroup>
				<h1><a href="/">Ben Dodson</a></h1>
				<h2>Freelance iOS, Apple Watch, and Apple TV Developer</h2>
			</hgroup>
			<nav>
				<ul>
					<li><a href="/">Home</a></li><li><a href="/weblog/">Blog</a></li><li><a href="/about/">About</a></li><li><a href="/clients/">Portfolio</a></li><li><a href="/apps/">My Apps</a></li><li><a href="/projects/">Projects</a></li><li><a href="/contact/">Contact</a></li>
				</ul>
				<div class="divider"></div>
			</nav>
		</header>

		<section id="posts">

	
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/12/16/the-divide-4-getting-into-code/">The Divide #4 - Getting into code</a></h1>
			
			<time datetime="2015-12-16" pubdate=""><a href="/weblog/2015/12/16/the-divide-4-getting-into-code/">December 16, 2015</a></time>
    	</header>
    	<div>
			<p>Episode 4 of <a href="http://thedivide.co.uk/">The Divide</a>, a podcast I co-host, has just gone live. This week, we discuss the routes we all took to becoming software developers. We take a look at how the programmer market is evolving while sharing our experiences of how we learned to code and we close with some musings and tips on where new coders might start to learn how to join the digital gold rush. <a href="http://twitter.com/Lord_Chancellor">Chris</a> also shares a harrowing tale of how Captain Janeway wouldn’t look at him…</p>

<p>You can get The Divide from these fine outlets:</p>

<ul>
  <li><a href="https://itunes.apple.com/gb/podcast/the-divide/id1063410638">iTunes</a></li>
  <li><a href="https://overcast.fm/itunes1063410638/the-divide">Overcast</a></li>
  <li><a href="http://thedivide.co.uk/shows/itunes.xml">RSS</a> (for other podcast readers)</li>
  <li><a href="http://thedivide.co.uk/">The Divide website</a></li>
</ul>

<p>Don’t forget to leave a review on iTunes and follow us on Twitter via <a href="http://twitter.com/PodcastDivide">@PodcastDivide</a></p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/12/14/steve-jobs-introduces-the-ipad-at-death-star-briefing/">Steve Jobs introduces the iPad at Death Star briefing</a></h1>
			
			<time datetime="2015-12-14" pubdate=""><a href="/weblog/2015/12/14/steve-jobs-introduces-the-ipad-at-death-star-briefing/">December 14, 2015</a></time>
    	</header>
    	<div>
			<p>I’ve been re-watching Star Wars<sup id="fnref:machete"><a href="#fn:machete" class="footnote">1</a></sup> this weekend in preparation for <em>The Force Awakens</em> and a special episode of <a href="https://bendodson.com/weblog/2015/12/02/introducing-the-divide/">The Divide</a> we are recording after Christmas. When it got to the Death Star briefing sequence towards the end of <em>A New Hope</em>, I was reminded of an excellent video that came out after the original iPad announcement with a mashup of that sequence and Steve Jobs voiceover. I had a quick look for it and couldn’t find it as for some reason it had been <a href="https://www.youtube.com/watch?v=jbHF63b7g50">removed from YouTube</a><sup id="fnref:legal"><a href="#fn:legal" class="footnote">2</a></sup>. After much searching, I eventually found a copy online but I’ve extracted it and saved it here to avoid it disappearing again in the future:</p>

<video width="512" height="288" controls="">
  <source src="https://bendodson.s3.amazonaws.com/star-wars-ipad.mp4" type="video/mp4" />
  (It looks like your browser doesn't suppoer HTML5 video)
</video>

<p>I absolutely love this video and wish I knew who created it.</p>

<div class="footnotes">
  <ol>
    <li id="fn:machete">
      <p>In <a href="https://bendodson.com/weblog/2015/05/04/the-correct-way-to-watch-star-wars/">Machete Order</a>, obviously (although I’m tempted to re-watch <em>The Phantom Menace</em> after <a href="https://www.reddit.com/comments/3qvj6w">this theory</a> that Jar-Jar is a Sith master…) <a href="#fnref:machete" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:legal">
      <p>It doesn’t look like a takedown notice so maybe the account was deleted for some other video and this disappeared along with it. <a href="#fnref:legal" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/12/09/using-the-siri-remote-with-the-apple-tv-simulator/">Using the Siri Remote with the Apple TV Simulator</a></h1>
			
			<time datetime="2015-12-09" pubdate=""><a href="/weblog/2015/12/09/using-the-siri-remote-with-the-apple-tv-simulator/">December 09, 2015</a></time>
    	</header>
    	<div>
			<p>I’ve been working on a tvOS app for a client recently which has led to a lot of time spent building to both the Apple TV hardware and simulator. Whilst the simulator is very good for basic testing, the simulated remote can be a bit tricky to use and so I was very pleased to discover today that the physical Siri Remote can be used with the Apple TV Simulator on El Capitan. All you have to do is pair your Siri Remote to your Mac and it’ll work in the simulator just like it does with the real thing.</p>

<p>The full set of steps are as follows:</p>

<ol>
  <li>
    <p>Unpair your remote from your existing Apple TV (if applicable) by holding down the menu button and volume up button for around 5-10 seconds whilst the Apple TV is unplugged or otherwise out of Bluetooth range<sup id="fnref:pairing"><a href="#fn:pairing" class="footnote">1</a></sup>.</p>
  </li>
  <li>
    <p>Open up the Bluetooth settings panel in OS X; you should see a device with no details other than a mac address. Pair it.</p>
  </li>
  <li>
    <p>Profit! Your Siri Remote is now paired and can be used in the simulator.</p>
  </li>
</ol>

<p>I have a 1080p external monitor plugged into my iMac 5k and so if I run the Apple TV simulator on that in fullscreen mode it feels almost exactly like using the real hardware. This could be a good stop gap for those on a budget as you could just <a href="http://www.apple.com/uk/shop/product/MLLC2ZM/A/siri-remote">buy a Siri Remote</a> for testing rather than the whole Apple TV<sup id="fnref:budget"><a href="#fn:budget" class="footnote">2</a></sup>. You should always test your apps on real hardware of course but this is a useful trick nonetheless.</p>

<div class="footnotes">
  <ol>
    <li id="fn:pairing">
      <p>Otherwise it’ll just unpair and repair very quickly - a frustrating way to spend 15 minutes on a Wednesday morning! <a href="#fnref:pairing" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:budget">
      <p>Or for developers who simply don’t want a second Apple TV. I’ve been moving mine between my office and living room for the past week and considered getting a second “development only” Apple TV to avoid this minor irritation; buying just a second remote seems a wiser investment. <a href="#fnref:budget" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/12/02/introducing-the-divide/">Introducing 'The Divide'</a></h1>
			
			<time datetime="2015-12-02" pubdate=""><a href="/weblog/2015/12/02/introducing-the-divide/">December 02, 2015</a></time>
    	</header>
    	<div>
			<p>I’m happy to announce that <a href="https://itunes.apple.com/gb/podcast/the-divide/id1063410638">The Divide</a>, a new podcast I’ve been working on recently, is now available on <a href="https://itunes.apple.com/gb/podcast/the-divide/id1063410638">iTunes</a>.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2015/the-divide.jpg" width="800" height="606" /></p>

<p>Every two weeks, myself, <a href="http://misterford.co.uk/">Mr Christopher Ford</a>, and <a href="http://johnwordsworth.com/">Dr John Wordsworth</a> will discuss a particular topic that is of interest to us for around an hour. The topics of our first three shows (which are available now) are:</p>

<ul>
  <li>
    <p><strong>Episode 1, The Phantom Keeper</strong>: A round-table discussion of our favourite PC games with each of us allowed to bring two for consideration</p>
  </li>
  <li>
    <p><strong>Three Geeks and a Toddler</strong>: A debate about our current computer setup and whether we can see a tablet replacing our laptops</p>
  </li>
  <li>
    <p><strong>Fitting in with all of the stereotypes</strong>: We discuss media in the digital age including films, tv, music, magazines, books, and comics.</p>
  </li>
</ul>

<p>You can <a href="https://itunes.apple.com/gb/podcast/the-divide/id1063410638">subscribe on iTunes</a>, <a href="https://overcast.fm/itunes1063410638/the-divide">listed online with Overcast</a>, or by directing your podcast app of choice<sup id="fnref:overcast"><a href="#fn:overcast" class="footnote">1</a></sup> to <a href="http://thedivide.co.uk/shows/itunes.xml">our XML Feed</a>. Alternatively, you can download the MP3 files directly from <a href="http://thedivide.co.uk/">The Divide website</a>.</p>

<p>These first few episodes, whilst not perfect<sup id="fnref:perfect"><a href="#fn:perfect" class="footnote">2</a></sup>, have been a lot of fun to record and hopefully you’ll enjoy them. If you have feedback, questions, or want to suggest a topic, you can chat to us on <a href="https://twitter.com/PodcastDivide">Twitter via @PodcastDivide</a>. Our next episode should go live on Wednesday 16th December.</p>

<div class="footnotes">
  <ol>
    <li id="fn:overcast">
      <p>I personally use <a href="https://overcast.fm">Overcast</a>. <a href="#fnref:overcast" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:perfect">
      <p>There are a few minor mic issues which we’ve fixed now and our second episode has an unscheduled drop-in from a hungry toddler. <a href="#fnref:perfect" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/12/01/homekit-christmas-tree-with-siri/">HomeKit enabled Christmas tree lights with Siri control</a></h1>
			
			<time datetime="2015-12-01" pubdate=""><a href="/weblog/2015/12/01/homekit-christmas-tree-with-siri/">December 01, 2015</a></time>
    	</header>
    	<div>
			<p>Every year we seem to buy a bigger Christmas tree. This year is no exception and it is now proving difficult to maneuver around it to turn the lights on and off. To fix this, I’ve connected my lights up to a <a href="http://www.belkin.com/uk/F7C027/p/P-F7C027/">Belkin WeMo</a> and I’m running the excellent <a href="https://github.com/nfarina/homebridge">Homebridge</a><sup id="fnref:luke"><a href="#fn:luke" class="footnote">1</a></sup> server so that I can control it all via Siri:</p>

<iframe width="800" height="450" src="https://www.youtube.com/embed/xBuMQ-PMyeY?rel=0" frameborder="0" allowfullscreen=""></iframe>

<p>To get this up and running on your own machine, you’ll need to do the following in the Mac Terminal:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ruby -e <span class="s2">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span>
brew install node
sudo npm install -g homebridge
sudo npm install -g homebridge-wemo
homebridge</code></pre></div>

<p>This will install brew, install node, install Homebridge, install the WeMo plugin for Homebridge, and then attempt to run Homebridge (which will fail as you have no config file). Next, you’ll want to go to <code>~/.homebridge</code> and create a config.json file that looks like this:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&quot;bridge&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Homebridge&quot;</span><span class="p">,</span>
        <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;CC:22:3D:E3:CE:30&quot;</span><span class="p">,</span>
        <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">51826</span><span class="p">,</span>
        <span class="nt">&quot;pin&quot;</span><span class="p">:</span> <span class="s2">&quot;031-45-154&quot;</span>
    <span class="p">},</span>
    
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This is an example configuration file with all supported devices. You can use this as a template for creating your own configuration file containing devices you actually own.&quot;</span><span class="p">,</span>

    <span class="nt">&quot;accessories&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;accessory&quot;</span><span class="p">:</span> <span class="s2">&quot;WeMo&quot;</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Christmas Tree&quot;</span><span class="p">,</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This shim supports Belkin WeMo devices on the same network as this server. You can create duplicate entries for this device and change the &#39;name&#39; attribute to reflect what device is plugged into the WeMo, for instance &#39;Air Conditioner&#39; or &#39;Coffee Maker&#39;. This name will be used by Siri. Make sure to update the &#39;wemo_name&#39; attribute with the EXACT name of the device in the WeMo app itself. This can be the same value as &#39;name&#39; but it doesn&#39;t have to be.&quot;</span><span class="p">,</span>
            <span class="nt">&quot;wemo_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Christmas Tree&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></div>

<p>The important part is to make sure that the <code>wemo_name</code> matches the name of your device within the WeMo app; the <code>name</code> attribute is what you want your device to be called on HomeKit. Run the <code>homebridge</code> command again and you should see that your device is found and Homebridge is running.</p>

<p>Next, you’ll need to get a HomeKit enabled app to run all of this. My recommendation is to use the one that Apple provides to developers, <a href="https://developer.apple.com/library/ios/samplecode/HomeKitCatalog/Introduction/Intro.html">HomeKit Catalog</a>, although that will require you to know how to sideload apps from Xcode. Alternatively you can download the <a href="https://itunes.apple.com/app/elgato-eve/id917695792">Elgato Eve app</a>. Once you have an app, you’ll need to add the Homebridge using the pin that is in your config file. You can play around with the app and create rooms, scenes, zones, etc, but for now the basic commands should work. If you can turn your device on and off via the HomeKit enabled app, you will be able to activate Siri and say “<em>turn on the Christmas tree</em>”, “<em>turn off the Christmas tree</em>”, and “<em>is the Christmas tree on?</em>”.</p>

<p>Added bonus: if you have an Apple TV, you are signed into iCloud, and you use iCloud keychain, then you’ll be able to use all of these voice commands when you’re outside of your house! It’s a pretty useful way to activate these devices and I have several of them dotted around my home<sup id="fnref:straighteners"><a href="#fn:straighteners" class="footnote">2</a></sup>. Homebridge also supports many other services such as Philips Hue (without the need for their HomeKit bridge) and you can write your own plugins very easily<sup id="fnref:prismatik"><a href="#fn:prismatik" class="footnote">3</a></sup>.</p>

<p>My next task is to dig out some code I wrote last year to turn the tree lights on and off automatically depending on if I’m in the house using an iBeacon…</p>

<div class="footnotes">
  <ol>
    <li id="fn:luke">
      <p>Hat tip to <a href="http://lukeredpath.co.uk/">Luke Redpath</a> for introducing me to Homebridge. <a href="#fnref:luke" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:straighteners">
      <p>After my wife asked me for the 62nd time if she’d left her straighteners plugged in whilst we were driving in the car, I set up the plug near her dresser with a WeMo so she can use Siri to ask “<em>are my straighteners turned on?</em>” and “<em>turn off the straighteners</em>” if need be! <a href="#fnref:straighteners" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:prismatik">
      <p>I’ve written a <a href="https://github.com/bendodson/homebridge-prismatik">very basic plugin</a> for the <a href="http://lightpack.tv/">Prismatik Light Pack</a>. <a href="#fnref:prismatik" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/11/27/brapp-v1.1/">Brapp v1.1</a></h1>
			
			<time datetime="2015-11-27" pubdate=""><a href="/weblog/2015/11/27/brapp-v1.1/">November 27, 2015</a></time>
    	</header>
    	<div>
			<p>A big update I worked on for <a href="https://www.brapp.tv">Brapp</a> went live today on the App Store. It’s the first major update for the app and adds the following:</p>

<blockquote>
  <ul>
    <li>You can now adjust audio levels of yourself and the beat after recording. Sweet.</li>
    <li>You can now rotate videos after recording so you’re not sideways when you don’t want to be.</li>
    <li>We’ve added 5 new video filters! Ice, Whitewash, Planet Rock, Purple Haze and Blackout.</li>
    <li>We’ve added controls for brightness and video filter intensity so there are infinite variations.</li>
    <li>The new video player is faster, smoother, lighter to control and does not overlay on top of videos.</li>
    <li>Producer’s names now show on videos made on their beats.</li>
    <li>The new beat player shows real waveforms because real waveforms rule.</li>
    <li>You can now loop beats by pressing the ∞ button.</li>
    <li>Spins now show on beats! Spins are all the plays of a beat INCLUDING plays of videos made on them.</li>
    <li>You can now filter your Saved Beats by title, producer name, #hashtag and bpm.</li>
    <li>You can now edit info on your beats &amp; videos. Phew.</li>
    <li>When you make a video you can see it’s progress as it uploads, you no longer have to wait hopingly!</li>
    <li>When you tap the beat icon on any video it shows you the beat, now it also shows you all the other - videos made on that beat on the same page.</li>
    <li>When commenting on a beat/video it won’t stop playing what you are listening to.</li>
    <li>You can tap profile pictures to make them big.</li>
    <li>It is now easier to find your Facebook and Twitter friends, and connect with popular users on Brapp.</li>
    <li>And there’s a heap of other handsome UI, UX and stability updates. P.s. We’re just getting started!</li>
  </ul>
</blockquote>

<p>If you haven’t checked it out yet, you can get Brapp for free on <a href="https://itunes.apple.com/gb/app/brapp-rap-sing-or-dance-to/id1022327727?mt=8">the App Store</a>. You can also <a href="https://bendodson.com/weblog/2015/09/24/brapp-the-rap-app/">read about the initial build and release</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/11/19/chippd-app-for-sharing-personal-messages/">Chipp'd, an app for sharing personal messages</a></h1>
			
			<time datetime="2015-11-19" pubdate=""><a href="/weblog/2015/11/19/chippd-app-for-sharing-personal-messages/">November 19, 2015</a></time>
    	</header>
    	<div>
			<p>I’m happy to announce that an iPhone app I’ve been working on since September this year has gone live in the App Store; <a href="https://itunes.apple.com/gb/app/chippd/id570739404?mt=8">Chipp’d v2.0</a>.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2015/chippd-app.jpg" width="800" /></p>

<p>Chipp’d is an app that works with real world products (available at <a href="http://www.johnlewis.com/search?Ntt=chipp%27d">John Lewis</a>) to let you share secrets or private messages with your friends. You simply scan the QR code on the sticker, create your secret (with video, audio, photos, and text), and send the sticker or card; your friend will then be able to see that secret when they scan it with the app or any other QR scanner.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2015/chippd-code.jpg" width="600" /></p>

<p>It is also possible to share secrets for free using the app via auto-generated URLs that can be sent via email or SMS.</p>

<p>I was the sole iOS developer on the project and worked closely with the CTO of Chipp’d to integrate their existing API into the product on an incredibly agressive timescale<sup id="fnref:timescale"><a href="#fn:timescale" class="footnote">1</a></sup>. Everything was written in Swift 2.0 and used AutoLayout for flexible layouts on all iPhone screen sizes. I’m particularly proud of the QR scanner which I custom built when it transpired that the products that had been printed and shipped to distributors were too light for a conventional QR scanner to detect; I used GPUImage to manipulate the live video feed with multiple filters per second in order to quickly scan at different brightnesses and solve the issue before it caused major problems.</p>

<p>You can check out <a href="https://itunes.apple.com/gb/app/chippd/id570739404?mt=8">Chipp’d on the App Store</a> (it’s free) and you can purchase the stickers and cards to use with it at <a href="http://www.johnlewis.com/search?Ntt=chipp%27d">John Lewis</a>.</p>

<div class="footnotes">
  <ol>
    <li id="fn:timescale">
      <p>The stickers and cards were printed, sitting in a warehouse, and about to be available for sale from John Lewis for Christmas 2015! <a href="#fnref:timescale" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/10/20/a-simple-audio-recorder-controller-in-swift-for-iphone/">A simple Audio Recorder controller in Swift (for iPhone)</a></h1>
			
			<time datetime="2015-10-20" pubdate=""><a href="/weblog/2015/10/20/a-simple-audio-recorder-controller-in-swift-for-iphone/">October 20, 2015</a></time>
    	</header>
    	<div>
			<p>iOS provides a number of useful modal views within it’s system frameworks with everything from sending email to taking photos or video. However, there is still not a standard way to perform what is a fairly basic task; recording a voice memo.</p>

<p>I had a need for such a feature on a project recently and so I put together <a href="https://github.com/bendodson/AudioRecorderViewController-Swift">AudioRecorderViewController</a>. It’s a basic modal view controller that allows you to record, playback, re-record, and save audio locally in mp4 format.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2015/audiorecorderviewcontroller.jpg" width="800" /></p>

<p>Usage is insanely simple and modelled on such classes as <code>UIImagePickerController</code>:</p>

<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="p">@</span><span class="kt">IBAction</span> <span class="k">func</span> <span class="n">presentAudioRecorder</span><span class="p">(</span><span class="nl">sender</span><span class="p">:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">AudioRecorderViewController</span><span class="p">()</span>
    <span class="n">controller</span><span class="p">.</span><span class="n">audioRecorderDelegate</span> <span class="o">=</span> <span class="nb">self</span>
    <span class="n">presentViewController</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="nl">animated</span><span class="p">:</span> <span class="nb">true</span><span class="p">,</span> <span class="nl">completion</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">audioRecorderViewControllerDismissed</span><span class="p">(</span><span class="n">withFileURL</span> <span class="nl">fileURL</span><span class="p">:</span> <span class="bp">NSURL</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something with fileURL</span>
    <span class="n">dismissViewControllerAnimated</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="nl">completion</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>Check out <a href="https://github.com/bendodson/AudioRecorderViewController-Swift">AudioRecorderViewController-Swift on GitHub</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/10/06/hkhealthstore-extension-deletesamplesoftype/">HKHealthStore Extension, deleteSamplesOfType</a></h1>
			
			<time datetime="2015-10-06" pubdate=""><a href="/weblog/2015/10/06/hkhealthstore-extension-deletesamplesoftype/">October 06, 2015</a></time>
    	</header>
    	<div>
			<p>Following on from <a href="/weblog/2015/10/05/healthkit-radar-22977320/">my post yesterday</a> about the broken implementation of the <code>HKHealthStore</code> method <code>deleteObjectsOfType:predicate:withCompletion:</code>, I’ve put together <a href="https://gist.github.com/bendodson/c0f0a6a1f601dc4573ba">a gist</a> which provides a fixed method that works with <code>HKSampleType</code> objects; <code>deleteSamplesOfType:predicate:withCompletion:</code></p>

<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">import</span> <span class="n">Foundation</span>
<span class="k">import</span> <span class="n">HealthKit</span>

<span class="k">extension</span> <span class="n">HKHealthStore</span> <span class="p">{</span>
    
    <span class="k">func</span> <span class="n">deleteSamplesOfType</span><span class="p">(</span><span class="nl">sampleType</span><span class="p">:</span> <span class="n">HKSampleType</span><span class="p">,</span> <span class="nl">predicate</span><span class="p">:</span> <span class="bp">NSPredicate</span><span class="p">,</span> <span class="n">withCompletion</span> <span class="nl">completion</span><span class="p">:</span> <span class="p">(</span><span class="nl">success</span><span class="p">:</span> <span class="n">Bool</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="bp">NSError</span><span class="o">?</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="n">HKSampleQuery</span><span class="p">(</span><span class="nl">sampleType</span><span class="p">:</span> <span class="n">sampleType</span><span class="p">,</span> <span class="nl">predicate</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nl">limit</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">sortDescriptors</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
            
            <span class="k">if</span> <span class="k">let</span> <span class="n">_</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                <span class="n">completion</span><span class="p">(</span><span class="nl">success</span><span class="p">:</span> <span class="nb">false</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="k">let</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">results</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">objects</span><span class="p">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                    <span class="n">completion</span><span class="p">(</span><span class="nl">success</span><span class="p">:</span> <span class="nb">true</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nb">self</span><span class="p">.</span><span class="n">deleteObjects</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="nl">withCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
                        <span class="n">completion</span><span class="p">(</span><span class="nl">success</span><span class="p">:</span> <span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="n">objects</span><span class="p">.</span><span class="n">count</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">completion</span><span class="p">(</span><span class="nl">success</span><span class="p">:</span> <span class="nb">true</span><span class="p">,</span> <span class="nl">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">error</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="p">}</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">executeQuery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="p">}</span>
    
<span class="p">}</span></code></pre></div>

<p>It simply uses the <code>NSPredicate</code> within a <code>HKSampleQuery</code> in order to find any objects that match the <code>HKSampleType</code> and then deletes them with the <code>HKHealthStore</code> method <code>deleteObjects:withCompletion:</code> - this correctly ensures that you are only deleting objects that match both the predicate and type.</p>

<p>By way of example, this simply extends <code>HKHealthStore</code> so you can do something like this:</p>

<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="n">date</span> <span class="o">=</span> <span class="bp">NSDate</span><span class="p">()</span>

<span class="k">let</span> <span class="n">predicate</span> <span class="o">=</span> <span class="n">HKQuery</span><span class="p">.</span><span class="n">predicateForSamplesWithStartDate</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="n">beginningOfDay</span><span class="p">(),</span> <span class="nl">endDate</span><span class="p">:</span> <span class="bp">NSDate</span><span class="p">().</span><span class="n">endOfDay</span><span class="p">(),</span> <span class="nl">options</span><span class="p">:</span> <span class="p">.</span><span class="n">None</span><span class="p">)</span>

<span class="k">let</span> <span class="n">stepType</span> <span class="o">=</span> <span class="n">HKQuantityType</span><span class="p">.</span><span class="n">quantityTypeForIdentifier</span><span class="p">(</span><span class="n">HKQuantityTypeIdentifierStepCount</span><span class="p">)</span><span class="o">!</span>
<span class="n">healthStore</span><span class="p">.</span><span class="n">deleteSamplesOfType</span><span class="p">(</span><span class="n">stepType</span><span class="p">,</span> <span class="nl">predicate</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nl">withCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;deleted \(count) step objects: \(error)&quot;</span><span class="p">)</span>
    <span class="k">let</span> <span class="n">stepQuantity</span> <span class="o">=</span> <span class="n">HKQuantity</span><span class="p">(</span><span class="nl">unit</span><span class="p">:</span> <span class="n">HKUnit</span><span class="p">.</span><span class="n">countUnit</span><span class="p">(),</span> <span class="nl">doubleValue</span><span class="p">:</span> <span class="mi">9800</span><span class="p">)</span>
    <span class="k">let</span> <span class="n">stepSample</span> <span class="o">=</span> <span class="n">HKQuantitySample</span><span class="p">(</span><span class="nl">type</span><span class="p">:</span> <span class="n">stepType</span><span class="p">,</span> <span class="nl">quantity</span><span class="p">:</span> <span class="n">stepQuantity</span><span class="p">,</span> <span class="nl">startDate</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="nl">endDate</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">healthStore</span><span class="p">.</span><span class="n">saveObject</span><span class="p">(</span><span class="n">stepSample</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
    <span class="p">}</span>
<span class="p">})</span>


<span class="k">let</span> <span class="n">flightsType</span> <span class="o">=</span> <span class="n">HKQuantityType</span><span class="p">.</span><span class="n">quantityTypeForIdentifier</span><span class="p">(</span><span class="n">HKQuantityTypeIdentifierFlightsClimbed</span><span class="p">)</span><span class="o">!</span>
<span class="n">healthStore</span><span class="p">.</span><span class="n">deleteSamplesOfType</span><span class="p">(</span><span class="n">flightsType</span><span class="p">,</span> <span class="nl">predicate</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nl">withCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;deleted \(count) flight objects: \(error)&quot;</span><span class="p">)</span>
    <span class="k">let</span> <span class="n">flightsQuantity</span> <span class="o">=</span> <span class="n">HKQuantity</span><span class="p">(</span><span class="nl">unit</span><span class="p">:</span> <span class="n">HKUnit</span><span class="p">.</span><span class="n">countUnit</span><span class="p">(),</span> <span class="nl">doubleValue</span><span class="p">:</span> <span class="mi">15</span><span class="p">)</span>
    <span class="k">let</span> <span class="n">flightsSample</span> <span class="o">=</span> <span class="n">HKQuantitySample</span><span class="p">(</span><span class="nl">type</span><span class="p">:</span> <span class="n">flightsType</span><span class="p">,</span> <span class="nl">quantity</span><span class="p">:</span> <span class="n">flightsQuantity</span><span class="p">,</span> <span class="nl">startDate</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="nl">endDate</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">healthStore</span><span class="p">.</span><span class="n">saveObject</span><span class="p">(</span><span class="n">flightsSample</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
    <span class="p">}</span>
<span class="p">})</span></code></pre></div>

<p>As a reminder, you can file a duplicate of (<a href="https://openradar.appspot.com/radar?id=5021999797633024">rdar://22977320</a>) if you’d like to see the original bug fixed but in the meantime the above should allow you to carry on with your HealthKit app without worrying about deleting other data.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2015/10/05/healthkit-radar-22977320/">HealthKit Radar 22977320</a></h1>
			
			<time datetime="2015-10-05" pubdate=""><a href="/weblog/2015/10/05/healthkit-radar-22977320/">October 05, 2015</a></time>
    	</header>
    	<div>
			<p>Working with any code, it is inevitable that you’ll stumble across bugs. When this happens with iOS development, Apple ask developers to submit a “radar” so that they can track and hopefully fix any issues that arise. The issue is that the <a href="http://bugreport.apple.com/">Apple Bug Reporter</a> is locked down and non-searchable so you have no idea if anyone else has submitted the same issue. Apple supposedly collate all of the bugs and mark any issues as duplicates and then use the number submitted to gauge how important an issue is and prioritise it’s fix. This has led to sites like <a href="https://openradar.appspot.com/">Open Radar</a> that let developers copy and paste their bug reports so other developers can search and then simply submit new bugs as a duplicate.</p>

<p>In any case, today I found an interesting bug in HealthKit. iOS 9 added a new method named <code>deleteObjectsOfType:predicate:withCompletion</code> which is supposed to let you delete any objects you have written to HealthKit nice and easily. For example, I might have an app which constantly checks your step count and flights climbed throughout the day and so it will want to delete any steps and flights from 00.00 to 23.59 before it adds the updated count. Unfortunately, the method doesn’t seem to respect the <code>type</code> parameter and so it will delete everything that matches your query regardless of what <code>HKObjectType</code> it is.</p>

<p>For example, consider the following code:</p>

<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="n">date</span> <span class="o">=</span> <span class="bp">NSDate</span><span class="p">()</span>

<span class="k">let</span> <span class="n">predicate</span> <span class="o">=</span> <span class="n">HKQuery</span><span class="p">.</span><span class="n">predicateForSamplesWithStartDate</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="n">beginningOfDay</span><span class="p">(),</span> <span class="nl">endDate</span><span class="p">:</span> <span class="bp">NSDate</span><span class="p">().</span><span class="n">endOfDay</span><span class="p">(),</span> <span class="nl">options</span><span class="p">:</span> <span class="p">.</span><span class="n">None</span><span class="p">)</span>

<span class="k">let</span> <span class="n">stepType</span> <span class="o">=</span> <span class="n">HKQuantityType</span><span class="p">.</span><span class="n">quantityTypeForIdentifier</span><span class="p">(</span><span class="n">HKQuantityTypeIdentifierStepCount</span><span class="p">)</span><span class="o">!</span>
<span class="n">healthStore</span><span class="p">.</span><span class="n">deleteObjectsOfType</span><span class="p">(</span><span class="n">stepType</span><span class="p">,</span> <span class="nl">predicate</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nl">withCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;deleted \(count) step objects: \(error)&quot;</span><span class="p">)</span>
<span class="p">})</span>
<span class="k">let</span> <span class="n">stepQuantity</span> <span class="o">=</span> <span class="n">HKQuantity</span><span class="p">(</span><span class="nl">unit</span><span class="p">:</span> <span class="n">HKUnit</span><span class="p">.</span><span class="n">countUnit</span><span class="p">(),</span> <span class="nl">doubleValue</span><span class="p">:</span> <span class="mi">9800</span><span class="p">)</span>
<span class="k">let</span> <span class="n">stepSample</span> <span class="o">=</span> <span class="n">HKQuantitySample</span><span class="p">(</span><span class="nl">type</span><span class="p">:</span> <span class="n">stepType</span><span class="p">,</span> <span class="nl">quantity</span><span class="p">:</span> <span class="n">stepQuantity</span><span class="p">,</span> <span class="nl">startDate</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="nl">endDate</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span>
<span class="n">healthStore</span><span class="p">.</span><span class="n">saveObject</span><span class="p">(</span><span class="n">stepSample</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
<span class="p">}</span>

<span class="k">let</span> <span class="n">flightsType</span> <span class="o">=</span> <span class="n">HKQuantityType</span><span class="p">.</span><span class="n">quantityTypeForIdentifier</span><span class="p">(</span><span class="n">HKQuantityTypeIdentifierFlightsClimbed</span><span class="p">)</span><span class="o">!</span>
<span class="n">healthStore</span><span class="p">.</span><span class="n">deleteObjectsOfType</span><span class="p">(</span><span class="n">flightsType</span><span class="p">,</span> <span class="nl">predicate</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nl">withCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;deleted \(count) flight objects: \(error)&quot;</span><span class="p">)</span>
<span class="p">})</span>
<span class="k">let</span> <span class="n">flightsQuantity</span> <span class="o">=</span> <span class="n">HKQuantity</span><span class="p">(</span><span class="nl">unit</span><span class="p">:</span> <span class="n">HKUnit</span><span class="p">.</span><span class="n">countUnit</span><span class="p">(),</span> <span class="nl">doubleValue</span><span class="p">:</span> <span class="mi">15</span><span class="p">)</span>
<span class="k">let</span> <span class="n">flightsSample</span> <span class="o">=</span> <span class="n">HKQuantitySample</span><span class="p">(</span><span class="nl">type</span><span class="p">:</span> <span class="n">flightsType</span><span class="p">,</span> <span class="nl">quantity</span><span class="p">:</span> <span class="n">flightsQuantity</span><span class="p">,</span> <span class="nl">startDate</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="nl">endDate</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span>
<span class="n">healthStore</span><span class="p">.</span><span class="n">saveObject</span><span class="p">(</span><span class="n">flightsSample</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
<span class="p">}</span></code></pre></div>

<p>The expected result is that you’ll end up with an entry for Step Count (9800 steps) and an entry for Flights Climbed (15). However, you’ll only get the Flights Climbed entry as the line <code>healthStore.deleteObjectsOfType(flightsType, predicate: predicate, withCompletion:...</code> will delete all entries that match the predicate, regardless of the <code>HKObjectType</code>. In addition, if you look at the headers for this method within the HealthKit framework, they don’t add up with what is expected:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2015/radar-22977320.png" width="800" /></p>

<p>This suggests that this method was refactored at some point prior to release and has this rather serious bug. I’ve filed this as a radar (<a href="https://openradar.appspot.com/radar?id=5021999797633024">rdar://22977320</a>) but in the mean time you’ll need to do a manual search for objects with <code>HKSampleQuery</code> and delete them with a separate call if you want to avoid this.</p>

<p><strong>Update:</strong> I’ve put together a fix for this issue with a new <code>HKHealthStore</code> method, <a href="/weblog/2015/10/06/hkhealthstore-extension-deletesamplesoftype/"><code>deleteSamplesOfType:predicate:withCompletion:</code></a></p>

<p><strong>Update:</strong> Whilst iOS 9.1 hasn’t fixed this issue, my bug report has today (23rd Oct 2015) been marked as a duplicate of issue 23097982 so looks like they may be getting around to fixing it. iOS 9.2 perhaps?</p>

		</div>
	</article>
    
	
</section>


<section id="pagination">
     
    	<a href="/weblog/page/3/" title="Previous Page" class="pagination-previous">&laquo; Older Entries</a>
     
	
    
      
      	<a href="/weblog/" title="Next Page" class="pagination-next">Newer Entries &raquo; </a>
      
    
</section>

		
		<footer>
			<p>I perform all freelance work through my company <strong>Dodo Apps Ltd</strong> (07856552) registered at The Bristol Office, 2nd Floor, 5 High Street, Westbury on Trym, Bristol, England, BS9 3BY</p>
		</footer>

	</div>

</body>
</html>