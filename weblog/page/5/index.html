<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	


	<link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'>
	<link rel="alternate" type="application/rss+xml" title="Ben Dodson, iOS Developer" href="https://bendodson.com/rss.xml" />
	<link rel="stylesheet" href="/styles-2021-03-10.css" />
	<link rel="stylesheet" href="/highlight-2018-02-23.css" />
	<link rel="icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/favicon.ico">
	<link rel="apple-touch-icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone-retina.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<title>Ben Dodson's Blog &mdash; Freelance Swift and Apple Platforms Developer</title>
</head>
<body>

	<div id="wrapper">

		<header>
			<hgroup>
				<h1><a href="/">Ben Dodson</a></h1>
				<h2>Freelance iOS, macOS, Apple Watch, and Apple TV Developer</h2>
			</hgroup>
			<nav>
				<ul>
					<li><a href="/">Home</a></li><li><a href="/weblog/">Blog</a></li><li><a href="/about/">About</a></li><li><a href="/clients/">Portfolio</a></li><li><a href="/apps/">My Apps</a></li><li><a href="/projects/">Projects</a></li><li><a href="/contact/">Contact</a></li>
				</ul>
				<div class="divider"></div>
			</nav>
		</header>

		<section id="posts">

	
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/10/27/kylo-ben/">Kylo Ben</a></h1>
			
			<time datetime="2016-10-27" pubdate=""><a href="/weblog/2016/10/27/kylo-ben/">October 27, 2016</a></time>
    	</header>
    	<div>
			<p>I have three main hobbies; coding, video games, and LEGO. With the first, I’m fortunate to have a flexible job that allows me to code on tons of different and varied projects every day. With the last, I’ve literally run out of space for the models I already have (most of which are over 2000 bricks in size). Video games, then, are really my main hobby. In the last year I’ve <a href="http://connectingtohost.com/">started a podcast on co-operative gaming</a>, built a powerful gaming PC, and spent somewhere in the region of 900 hours playing games. Today I’m happy to announce a new website I’ve been working on dedicated to my gaming hobby; it’s called <a href="http://kyloben.co.uk">Kylo Ben</a>:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/kylo-ben.jpg" width="800" height="400" /></p>

<p>Kylo Ben is divided into several different sections:</p>

<h3 id="articles">Articles</h3>

<p>I’m currently varying between reviews, things I’m excited about, and general thought pieces on the industry. So far, I have published:</p>

<ul>
  <li>A look ahead at the <a href="http://kyloben.co.uk/titanfall-2-achievements">achievements in Titanfall 2</a> (compared to Titanfall)</li>
  <li>A review of minimalistic transport sim, <a href="http://kyloben.co.uk/mini-metro-review">Mini Metro</a></li>
  <li>A piece about <a href="http://kyloben.co.uk/my-first-steam-refund">my first refund on Steam</a> in 11 years</li>
  <li>Some thoughts on the <a href="http://kyloben.co.uk/thoughts-on-the-nintendo-switch">Nintendo Switch</a> announcement</li>
  <li>A review of the <a href="http://kyloben.co.uk/lego-dimensions-doctor-who">Doctor Who LEGO Dimensions level pack</a></li>
  <li>A roundup of the <a href="http://kyloben.co.uk/humble-monthly-october-2016">games in the October Humble Bundle</a></li>
</ul>

<p>I’m trying to write new pieces every couple of days and it has proven to be a good way to practice my writing and get some long form thoughts out that don’t fit neatly into a 140 character tweet. It also means I can keep these game centric pieces away from my more work-oriented blog here at <a href="https://bendodson.com/">bendodson.com</a>.</p>

<h3 id="about">About</h3>

<p>I’ve listed a few things about my current gaming setups on my <a href="http://kyloben.co.uk/about/">about page</a>. It details the components in my gaming PC, my current console and mobile gaming systems, and a look through the various consoles I’ve owned since I started gaming in 1991.</p>

<h3 id="games">Games</h3>

<p>I have a single page which lists all of the games I currently own on both Steam and my Xbox One. Each game has more details including purchase date, last played, total gaming time, and a short note about where I’m currently at with the game. I also list any articles related to that game for easy reference (and vice versa). For example, here is the entry for <a href="http://kyloben.co.uk/games/mini-metro">Mini Metro</a>.</p>

<h3 id="gaming-time">Gaming Time</h3>

<p>This is perhaps my biggest achievement; a complete log of time spent on each game. The page updates daily and will list each game I’ve played over the last 2 months along with duration and a link through to more details. This is done through a combination of two custom scripts I wrote to scrape both my Steam library and Xbox Live / Windows 10 account periodically for changes. It’s been fascinating for me to see exactly how long I’ve spent on certain games (*cough* <a href="http://kyloben.co.uk/games/peggle-2">Peggle 2</a> *cough*) and will allow me to easily write a regular piece on games I’ve played over the previous month.</p>

<p>I’m really excited to be writing regularly about my biggest hobby and I’m looking forward to posting frequently for the foreseeable future. I have a few extra things to announce soon including some apps and game mods so <a href="https://twitter.com/bendodson">follow me on Twitter</a> for the latest updates. Alternatively, there is an <a href="http://kyloben.co.uk/rss.xml">RSS feed available</a> for Kylo Ben which will keep you up to date on any new articles. If you have any thoughts or suggestions for improvements, please <a href="https://bendodson.com/contact">get in touch</a>.</p>


		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/10/12/working-remotely/">Working Remotely</a></h1>
			
			<time datetime="2016-10-12" pubdate=""><a href="/weblog/2016/10/12/working-remotely/">October 12, 2016</a></time>
    	</header>
    	<div>
			<p>I was recently asked by <a href="http://remote.co/">Remote.co</a> to take part in a new Q&amp;A section about remote workers. You can <a href="https://remote.co/remote-workers/ben-dodson/">read the full Q&amp;A on their website</a> but I’ve put some of their questions and my answers below:</p>

<h2 id="what-advice-would-you-give-someone-considering-going-remote">What advice would you give someone considering going remote?</h2>
<blockquote>
  <p>Discipline. It takes a lot of discipline to work remotely as you’ll find that it is very easy to put off a piece of work when you’re sitting at home. There are no firewalls stopping you from accessing Facebook and Twitter, the Xbox might be sat saying “just one more game”, and before you know it a month has passed and you’ve done nothing.</p>
</blockquote>

<h2 id="how-do-you-avoid-becoming-distracted-when-working-remotely">How do you avoid becoming distracted when working remotely?</h2>
<blockquote>
  <p>I have a pair of noise-cancelling headphones that I bought for working in an open-plan office but they work at home for me as the act of putting them on puts me into “work mode”. The only problem was that if the doorbell went (sidenote: great advantage of working from home is you never miss an Amazon delivery) I wouldn’t hear it; I fixed that by hooking it up to a Philips Hue lightbulb on my desk so I get a visual alert.</p>
</blockquote>

<h2 id="do-you-have-a-dedicated-home-office">Do you have a dedicated home office?</h2>
<blockquote>
  <p>I do have a dedicated room for work. I have a small desk with a 5k iMac and an external 1080p monitor in portrait mode (I find this better for webpages and iPhone simulators). Apart from the computer, my desk only has space for my tea and water and a Blue Yeti microphone I use for podcasting and Skype. I have lots of bookshelves (mainly full of LEGO) and a small orchid by the window.</p>
</blockquote>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/office.jpg" width="800" height="600" /></p>

<h2 id="whats-the-hardest-part-about-working-with-a-traditional-team-while-youre-remote-how-do-you-overcome-it">What’s the hardest part about working with a traditional team while you’re remote? How do you overcome it?</h2>
<blockquote>
  <p>I find the hardest thing is that traditional teams will want to have meetings all the time. They also want you to pop into the office fairly frequently for reasons unknown to me. I’m pretty good at telling prospective clients that I only work remotely and that I don’t do daily catch up calls; I get a good handle for the project and then do a week or two of work before sending over a build for feedback.</p>
</blockquote>


		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/09/15/mailroute-blacklisting-via-email/">MailRoute blacklisting via email</a></h1>
			
			<time datetime="2016-09-15" pubdate=""><a href="/weblog/2016/09/15/mailroute-blacklisting-via-email/">September 15, 2016</a></time>
    	</header>
    	<div>
			<p>I’ve been using <a href="http://mailroute.net/">MailRoute</a> on and off for the past few years<sup id="fnref:sanebox" role="doc-noteref"><a href="#fn:sanebox" class="footnote" rel="footnote">1</a></sup> in an effort to reduce the amount of spam in my inbox but there is one missing feature that always drives me nuts; there is no way to blacklist an email address or domain without going to their website. Whilst you can whitelist domains easily from the daily digest of caught spam, there is no feature that lets you forward spam to them in order to have it blacklisted (despite people, including me, <a href="https://support.mailroute.net/entries/23555217-Blacklist-by-email">requesting it since 2013</a>). After having a look at the <a href="https://support.mailroute.net/forums/21682281-API">MailRoute API</a>, I decided it was time to fix this myself.</p>

<p>There are several components in getting this working.</p>

<ol>
  <li>I created a new email address with <a href="http://gmail.com">Gmail</a> which will catch my forwarded spam<sup id="fnref:gmailspam" role="doc-noteref"><a href="#fn:gmailspam" class="footnote" rel="footnote">2</a></sup>.</li>
  <li>I set up an account with <a href="http://context.io">Context.io</a> and connected it to the gmail account<sup id="fnref:gmailaccount" role="doc-noteref"><a href="#fn:gmailaccount" class="footnote" rel="footnote">3</a></sup>.</li>
  <li>I put the following code <a href="https://github.com/bendodson/mailroute-blacklist-with-contextio">available on GitHub</a> on a 15 minute CRON job</li>
</ol>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="s1">'OAuth.php'</span><span class="p">;</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">'CONTEXT_KEY'</span><span class="p">,</span> <span class="s1">'your-contextio-consumer-key'</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'CONTEXT_SECRET'</span><span class="p">,</span> <span class="s1">'your-contextio-consumer-secret'</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'CONTEXT_USER_ID'</span><span class="p">,</span> <span class="s1">'your-contextio-user-id'</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'CONTEXT_TRASH_NAME'</span><span class="p">,</span> <span class="s1">'[Gmail]/Trash'</span><span class="p">);</span> <span class="c1">// change if not using Gmail</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">'MAILROUTE_USER'</span><span class="p">,</span> <span class="s1">'your-mailroute-username'</span><span class="p">);</span> <span class="c1">// should be your email address</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'MAILROUTE_API_KEY'</span><span class="p">,</span> <span class="s1">'your-mailroute-api-key'</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'MAILROUTE_EMAIL_ACCOUNT_ID'</span><span class="p">,</span> <span class="s1">'your-mailroute-email-id'</span><span class="p">);</span> <span class="c1">// numeric - can be found in admin.mailroute.net network traffic</span>

<span class="nv">$whitelist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sending@example.com'</span><span class="p">];</span> <span class="c1">// add the email address you are forwarding from or you'll blacklist yourself...</span>

<span class="nv">$inbox</span> <span class="o">=</span> <span class="nf">performOAuthRequest</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://api.context.io/lite/users/'</span><span class="mf">.</span><span class="no">CONTEXT_USER_ID</span><span class="mf">.</span><span class="s1">'/email_accounts/0/folders/inbox/messages'</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$inbox</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="p">{</span><span class="s1">'message_id'</span><span class="p">};</span>
    <span class="nv">$body</span> <span class="o">=</span> <span class="nf">performOAuthRequest</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://api.context.io/lite/users/'</span><span class="mf">.</span><span class="no">CONTEXT_USER_ID</span><span class="mf">.</span><span class="s1">'/email_accounts/0/folders/inbox/messages/'</span><span class="mf">.</span><span class="nv">$id</span><span class="mf">.</span><span class="s1">'/body'</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'&lt;'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'&gt;'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$body</span><span class="o">-&gt;</span><span class="n">bodies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">content</span><span class="p">));</span>
    <span class="nv">$emails</span> <span class="o">=</span> <span class="nf">extractEmailAddresses</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$emails</span> <span class="k">as</span> <span class="nv">$email</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">performRequest</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="s1">'https://admin.mailroute.net/api/v1/wblist/'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'email_account'</span> <span class="o">=&gt;</span> <span class="s1">'/api/v1/email_account/'</span><span class="mf">.</span><span class="no">MAILROUTE_EMAIL_ACCOUNT_ID</span><span class="mf">.</span><span class="s1">'/'</span><span class="p">,</span> <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">,</span> <span class="s1">'wb'</span> <span class="o">=&gt;</span> <span class="s1">'b'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Authorization: ApiKey '</span><span class="mf">.</span><span class="no">MAILROUTE_USER</span><span class="mf">.</span><span class="s1">':'</span><span class="mf">.</span><span class="no">MAILROUTE_API_KEY</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nf">performOAuthRequest</span><span class="p">(</span><span class="s1">'PUT'</span><span class="p">,</span> <span class="s1">'https://api.context.io/lite/users/'</span><span class="mf">.</span><span class="no">CONTEXT_USER_ID</span><span class="mf">.</span><span class="s1">'/email_accounts/0/folders/inbox/messages/'</span><span class="mf">.</span><span class="nv">$id</span><span class="p">,</span> <span class="p">[</span><span class="s1">'new_folder_id'</span> <span class="o">=&gt;</span> <span class="no">CONTEXT_TRASH_NAME</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="s1">'DONE!'</span><span class="p">;</span>



<span class="c1">// CURL</span>

<span class="k">function</span> <span class="n">performOAuthRequest</span><span class="p">(</span><span class="nv">$httpMethod</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$params</span><span class="o">=</span><span class="p">[],</span> <span class="nv">$headers</span><span class="o">=</span><span class="p">[])</span> <span class="p">{</span>
    <span class="nv">$signatureMethod</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OAuthSignatureMethod_HMAC_SHA1</span><span class="p">();</span>
    <span class="nv">$oauthConsumer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OAuthConsumer</span><span class="p">(</span><span class="no">CONTEXT_KEY</span><span class="p">,</span> <span class="no">CONTEXT_SECRET</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">);</span>
    <span class="nv">$oauthRequest</span> <span class="o">=</span> <span class="nc">OAuthRequest</span><span class="o">::</span><span class="nf">from_consumer_and_token</span><span class="p">(</span><span class="nv">$oauthConsumer</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="nv">$httpMethod</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
    <span class="nv">$oauthRequest</span><span class="o">-&gt;</span><span class="nf">sign_request</span><span class="p">(</span><span class="nv">$signatureMethod</span><span class="p">,</span> <span class="nv">$oauthConsumer</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">);</span>
    <span class="k">return</span> <span class="nf">performRequest</span><span class="p">(</span><span class="nv">$httpMethod</span><span class="p">,</span> <span class="nv">$oauthRequest</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">performRequest</span><span class="p">(</span><span class="nv">$httpMethod</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$params</span><span class="o">=</span><span class="p">[],</span> <span class="nv">$headers</span><span class="o">=</span><span class="p">[])</span> <span class="p">{</span>
    <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_TIMEOUT</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

    <span class="nv">$headers</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'Content-Type: application/json'</span><span class="p">;</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="nv">$headers</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$httpMethod</span><span class="p">,</span> <span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="nv">$httpMethod</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$httpMethod</span> <span class="o">!=</span> <span class="s1">'GET'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$params</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
    <span class="nv">$httpcode</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLINFO_HTTP_CODE</span><span class="p">);</span>
    <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
<span class="p">}</span>



<span class="c1">// Email parsing</span>

<span class="k">function</span> <span class="n">extractEmailAddresses</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
   <span class="nv">$emails</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
   <span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">,</span><span class="s1">' '</span><span class="p">,</span><span class="nv">$string</span><span class="p">);</span>
   <span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="s1">' '</span><span class="p">,</span><span class="nv">$string</span><span class="p">);</span>

   <span class="k">foreach</span><span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s1">'/ /'</span><span class="p">,</span> <span class="nv">$string</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$token</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="no">FILTER_VALIDATE_EMAIL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$email</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> 
            <span class="nv">$emails</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$email</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$emails</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Now all you need to do is forward any spam you receive to the Gmail account you set up. Every 15 minutes, the CRON job will run and check the inbox for any emails. When it finds some, it will parse them for email addresses and blacklist them with MailRoute before deleting them.</p>

<p>In an ideal world, MailRoute would implement a custom email address for blacklisting but this seems to be working for now.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:sanebox" role="doc-endnote">
      <p>I stopped using MailRoute a while back and was using the black hole feature of <a href="http://sanebox.com/">Sanebox</a> but I’ve just stopped using them as found the free service <a href="http://followupthen.com/">FollowUpThen</a> - I was getting a lot of spam after the switch off so decided to re-activate MailRoute this week. I use <a href="http://fastmail.fm">Fastmail</a> for my email in case you were wondering. <a href="#fnref:sanebox" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:gmailspam" role="doc-endnote">
      <p>As you’ll be forwarding emails to Gmail, you’ll want to disable its spam filter as otherwise your emails won’t end up in the inbox for processing by Context. To do this, you’ll need to set up a new rule which matches the email ‘@’ and ensures it never goes to spam. <a href="#fnref:gmailspam" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:gmailaccount" role="doc-endnote">
      <p>Whilst I could connect Context to my personal email and just move things into a folder for blacklisting, I don’t trust services with access to my email account, certainly not services that are free and are using the data. <a href="#fnref:gmailaccount" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/09/14/pocket-rocket-for-ios-10-with-imessage-app/">Pocket Rocket for iOS 10 (now with an iMessage app)</a></h1>
			
			<time datetime="2016-09-14" pubdate=""><a href="/weblog/2016/09/14/pocket-rocket-for-ios-10-with-imessage-app/">September 14, 2016</a></time>
    	</header>
    	<div>
			<p>To coincide with the release of iOS 10, I’m happy to announce a free update is available for my app <a href="https://itunes.apple.com/us/app/pocket-rocket-quickly-read/id1062699303?ls=1&amp;mt=8">Pocket Rocket</a> which includes several new features:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/pocket-rocket-ipad.jpg" width="800" height="500" /></p>

<p>First of all, I’ve added an optional tile-based interface which uses an image from the article or a <a href="https://bendodson.com/weblog/2016/09/10/generating-random-colour-with-seed-in-swift/">random colour</a> if one isn’t available. You can long press a tile to get options for sharing, archiving, and deleting the article and tapping will open the article up in Safari or the in-app browser as per your settings. Next, I added the ability to share articles directly from Pocket Rocket; whether you are using the old list view or the new tile-based one, just long press on an article and you’ll be given a share option which uses the standard iOS share sheet so you can transfer the URL to any compatible app.</p>

<p>Finally, I added an iOS 10 iMessage app so you can share articles directly within iMessage:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/pocket-rocket-imessage.jpg" width="800" height="500" /></p>

<p>This was a really interesting feature for me as it let me get to grips with the new APIs that allow apps to hook into iMessage. There are a few interesting niggles for developers when writing these apps<sup id="fnref:niggles" role="doc-noteref"><a href="#fn:niggles" class="footnote" rel="footnote">1</a></sup> but on the whole it is fairly simple and includes a lot more power than I thought they would<sup id="fnref:imessagepower" role="doc-noteref"><a href="#fn:imessagepower" class="footnote" rel="footnote">2</a></sup>. With Pocket Rocket, you get a list of all of your articles; you can then tap to include them in your message and send them. Once received, you can tap to have the article open up in a webview directly within iMessage.</p>

<p>I think iMessage apps are going to be a huge deal so I’m excited that Pocket Rocket is one of the first apps available on the iMessage store.</p>

<p>You can <a href="https://itunes.apple.com/us/app/pocket-rocket-quickly-read/id1062699303?ls=1&amp;mt=8">get Pocket Rocket for free on the App Store</a>. If you have any feature requests or feedback, please <a href="https://bendodson.com/contact/">get in touch</a>.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:niggles" role="doc-endnote">
      <p>For example, there is no standard way of seeing when someone tapped a link which is… irritating. Instead you have to work out if a particular message is selected (which happens for a variety of reasons) and then be clever about what you present. <a href="#fnref:niggles" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:imessagepower" role="doc-endnote">
      <p>I’ve seen one app that lets you use the camera within iMessage - pretty cool! <a href="#fnref:imessagepower" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/09/10/generating-random-colour-with-seed-in-swift/">Generating a random colour, with a seed, in Swift 3</a></h1>
			
			<time datetime="2016-09-10" pubdate=""><a href="/weblog/2016/09/10/generating-random-colour-with-seed-in-swift/">September 10, 2016</a></time>
    	</header>
    	<div>
			<p>I’ve been working on some iOS 10 updates to <a href="https://dodoapps.io/pocket-rocket/">Pocket Rocket</a><sup id="fnref:imessageapp" role="doc-noteref"><a href="#fn:imessageapp" class="footnote" rel="footnote">1</a></sup> which led me to trying to solve an interesting problem; how do you generate a random colour, with a seed, in Swift? The reason for this dilemma is that I’m going to start showing a grid view of Pocket articles and many of them do not have images associated with them. In order to break things up, I decided I’d like a random colour for the background of each article:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/pocket-rocket-colors.jpg" width="800" height="500" /></p>

<p>As each article is <code class="language-plaintext highlighter-rouge">UICollectionViewCell</code>, setting a random background colour is not suitable as when you scroll and the cells are re-used the backgrounds will change. Whilst that could be fixed fairly easily, I also want the colours to persist with the article between app launches and also be the same in the iPad app and the iMessage extension. This means I need to generate a random colour with a seed so that colours generated with the same seed will always be the same.</p>

<p>Thankfully this is fairly easy if we use the <code class="language-plaintext highlighter-rouge">srand48</code> and <code class="language-plaintext highlighter-rouge">drand48</code> functions:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">func</span> <span class="nf">randomColor</span><span class="p">(</span><span class="nv">seed</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIColor</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">total</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">u</span> <span class="k">in</span> <span class="n">seed</span><span class="o">.</span><span class="n">unicodeScalars</span> <span class="p">{</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="kt">Int</span><span class="p">(</span><span class="kt">UInt32</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="nf">srand48</span><span class="p">(</span><span class="n">total</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="nf">drand48</span><span class="p">())</span>
    
    <span class="nf">srand48</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">g</span> <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="nf">drand48</span><span class="p">())</span>
    
    <span class="nf">srand48</span><span class="p">(</span><span class="n">total</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">b</span> <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="nf">drand48</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="n">g</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>We start by taking a string (in my case an article title) and turning it into an integer by getting the sum of the unicode scalar values of each character. Next, we seed the <code class="language-plaintext highlighter-rouge">drand48</code> function by using <code class="language-plaintext highlighter-rouge">srand48</code> with our Int along with a multiplier or division so that the red, green, and blue values are all different. Finally, we compile the UIColor together.</p>

<p>I’ve put together a <a href="https://bendodson.s3.amazonaws.com/RandomColorWithSeed.playground.zip">Swift Playground demonstrating this</a> using the last few headlines from <a href="http://daringfireball.net">Daring Fireball</a>:</p>

<p><img src="http://bendodson.s3.amazonaws.com/weblog/2016/random-color-with-seed.jpg" width="800" height="500" /></p>

<p>As you can see, each article title results in a different colour; the same string will always result in the same colour being generated. Be aware that this is not collision free as it is just a basic addition of scalar values – a string such as “ben” and “neb” will result in the same colours. This isn’t an issue for my usage and still serves as an interesting way of seeding random colours.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:imessageapp" role="doc-endnote">
      <p>Specifically an <a href="https://twitter.com/bendodson/status/774265987231281152">iMessage app</a>. <a href="#fnref:imessageapp" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/08/23/tips-for-remote-working/">Tips for Remote Working</a></h1>
			
			<time datetime="2016-08-23" pubdate=""><a href="/weblog/2016/08/23/tips-for-remote-working/">August 23, 2016</a></time>
    	</header>
    	<div>
			<p>I was recently asked by <a href="http://inc.com/">Inc.com</a> to contribute to a feature asking several successful remote workers to share their favourite tips and tools to sustain productivity when working remotely. You can <a href="http://www.inc.com/stacey-macnaught/successful-remote-workers-share-their-productivity-secrets.html">read the full article on their website</a> but I’ve also put their questions and my answers below:</p>

<h3 id="how-long-have-you-worked-remotely">How long have you worked remotely?</h3>

<blockquote>
  <p>Around 6 years</p>
</blockquote>

<h3 id="what-does-a-typical-day-look-like-for-you">What does a typical day look like for you?</h3>

<blockquote>
  <p>I’ll wake up and go and deal with my dogs first thing around 6.30am whilst getting breakfast ready for my wife. Once she has left, I’ll read and deal with any overnight emails before doing a concentrated burst of work until around 1pm. After lunch, I’ll typically go for a walk and do a bit more work before playing some video games on my PC before my wife gets home. We’ll then walk the dogs, cook some dinner, and generally watch TV. Once she falls asleep, I’ll either do some more work or play some video games depending on how busy my schedule is.</p>
</blockquote>

<h3 id="whats-the-one-tip-or-tool-youd-give-to-anyone-looking-to-get-started-remote-working-to-keep-productive">What’s the one tip or tool you’d give to anyone looking to get started remote working to keep productive?</h3>

<blockquote>
  <p>Develop a schedule and stick to it. The hardest thing in the world is finding the motivation to start on a new project but once you’ve done 10 minutes of work you’ll be raring to go on the next 10 minutes and the next. To work remotely, you need the self-control to work when you don’t want to, the passion in your work to keep going, and the common sense to know when a 30 minute break is going to actually help rather than hinder you.</p>
</blockquote>

<blockquote>
  <p>With regards to tools, I can strongly recommend <a href="http://cushionapp.com/">Cushion</a> as an incredible way of managing your schedule, invoices, and expenses; it’ll make sure you don’t get overbooked (a big no-no) and also help you manage your finances better.</p>
</blockquote>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/08/18/brapp-ui-and-location-updates/">Brapp: Summer Updates</a></h1>
			
			<time datetime="2016-08-18" pubdate=""><a href="/weblog/2016/08/18/brapp-ui-and-location-updates/">August 18, 2016</a></time>
    	</header>
    	<div>
			<p>Over the summer, I’ve continued working with <a href="https://www.brapp.tv">Brapp</a> on <a href="https://itunes.apple.com/us/app/brapp-rap-sing-or-dance-to/id1022327727?mt=8">3 big releases</a> which added several new features and UI updates.</p>

<h3 id="v21">v2.1</h3>

<p>Released in July, Brapp 2.1 added the ability to trim recorded videos and change vibrancy of video filters along with adding a load of speed and stability improvements. However, the big new feature allowed users to export their beats as a video complete with an animating waveform:</p>

<iframe width="640" height="360" src="https://www.youtube-nocookie.com/embed/96MIV-HcByI?list=PLbTRLLbwMtevdMea2cVjGPEopDu7atfl2" frameborder="0" allowfullscreen=""></iframe>

<p>This was a really interesting feature for me to build as I wasn’t sure initially how it would work. It turns out that it is actually fairly easy by adding your animations directly to the various <code class="language-plaintext highlighter-rouge">CALayers</code> and then using an <code class="language-plaintext highlighter-rouge">AVVideoCompositionCoreAnimationTool</code> as your <code class="language-plaintext highlighter-rouge">AVMutableVideoComposition</code> animation tool. Fun stuff!</p>

<h3 id="v211">v2.1.1</h3>

<p>Released just a few days later, Brapp 2.1.1 included the ability to pin your favourite beat or post to the top of your profile feed<sup id="fnref:featureby" role="doc-noteref"><a href="#fn:featureby" class="footnote" rel="footnote">1</a></sup> and added a “Now Playing” bar along the bottom of the app with a similar style to Apple Music. It also introduced synchornicity between the website and app for notifications which is an interesting problem to solve; basically, if someone reads the notifications on the website, a silent push needs to be sent to the app in order to remove the badge icon so you don’t think you have new notifications. There were also some pretty meaty performance upgrades behind the scenes.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/brapp-now-playing.jpg" width="375" height="90" /></p>

<h3 id="v22">v2.2</h3>

<p>Brapp 2.2 was released today with the headline feature of location support. One of my main interests with iOS apps has always been in geo-location so it was really fun for me to add these new features including the ability to tag specific locations to beats and videos, add a city or town to your profile, view beats and videos on a profile map, and search for beats and videos either near you or at a specific location.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/brapp-map.jpg" width="800" height="450" /></p>

<p>Once again, Brapp has been a really fun project to work on. I can’t say enough good things about the people behind it and am looking forward to working with them again in the future. If you haven’t checked it out yet, you can <a href="https://itunes.apple.com/us/app/brapp-rap-sing-or-dance-to/id1022327727?mt=8">get Brapp for free on the App Store</a>. You can also read about the <a href="https://bendodson.com/weblog/2015/09/25/brapp-the-rap-app/">initial build and release</a>, the <a href="https://bendodson.com/weblog/2015/11/27/brapp-v1.1/">v1.1 update last November</a>, and the <a href="https://bendodson.com/weblog/2016/03/11/brapp-v2/">v2 update earlier this year</a>.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:featureby" role="doc-endnote">
      <p>This feature was added by <a href="http://bangmeansdoit.co.uk/en/">David Gibson</a>. <a href="#fnref:featureby" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/08/11/moonlight-tvos/">Moonlight tvOS for Apple TV 4</a></h1>
			
			<time datetime="2016-08-11" pubdate=""><a href="/weblog/2016/08/11/moonlight-tvos/">August 11, 2016</a></time>
    	</header>
    	<div>
			<p>A few nights ago I was attempting to finish playing Day of the Tentacle on my PC via a Steam Link in my bedroom. For some reason, whilst it all loaded correctly, it was really jerky to play with a severe delay between controller input and response on the screen. As I’d been playing it successfully using GameStream on my Nvidia Shield, I assumed correctly that the issue was with the Steam Link.</p>

<p>Not content to have to either a) go downstairs and use the Nvidia Shield or b) go to my office and play in front of my PC, I instead turned to my Apple TV as I knew there was an open source project called <a href="https://github.com/moonlight-stream/moonlight-ios">Moonlight</a> that basically lets you run the GameStream technology on non-Nvidia devices like iPhone or iPad. I assumed there would be a version for Apple TV but unfortunately it turns out that the AVFoundation frameworks have a <code class="language-plaintext highlighter-rouge">__TVOS_PROHIBITED</code> flag on some key components that prevent it from working. That’s when I found a fork by <a href="https://github.com/kevsmithpublic/moonlight-ios">kevsmithpublic</a> that enabled tvOS support with some code changes and requiring you to remove the <code class="language-plaintext highlighter-rouge">__TVOS_PROHIBITED</code> flags from the AVFoundation framework<sup id="fnref:frameworks" role="doc-noteref"><a href="#fn:frameworks" class="footnote" rel="footnote">1</a></sup>. Unfortunately, I wasn’t able to get it to pair to my PC and after a lot of searching it turns out that the fork was fairly old and hadn’t been updated to the latest specifications for GeForce Experience 3.0 and above.</p>

<p>Determined not to be beaten, I forked the project and then set about updating the code to support the latest Moonlight connections. This ended up being similar to the point and click adventure I was trying to play as I needed to constantly fetch the Apple TV from my bedroom, connect it to my mac, build the project, unplug the Apple TV, reconnect it in my bedroom, and then test if it actually worked (all because I didn’t have a spare monitor in my office as I use an iMac). After several hours (and a few beers) I had the project working and can now stream my games at 1080p from my PC to my Apple TV 4 and play them using an MFI controller.</p>

<p>You can <a href="https://github.com/bendodson/moonlight-tvos">download the project from my GitHub account</a>.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:frameworks" role="doc-endnote">
      <p>This means it can’t ever be used in an App Store version but it’s pretty cool nonetheless. I had no idea you could alter framework headers to enable things like this. It does beg the question why this framework is prohibited as it all clearly works. <a href="#fnref:frameworks" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/08/05/divide-15-virtually-reality/">The Divide #15 - Virtually Reality</a></h1>
			
			<time datetime="2016-08-05" pubdate=""><a href="/weblog/2016/08/05/divide-15-virtually-reality/">August 05, 2016</a></time>
    	</header>
    	<div>
			<p>After a short summer break we’re back with <a href="http://thedivide.co.uk/episodes/15">episode 15 of The Divide podcast</a> which is all about virtual reality. John has a fancy new HTC Vive, I’m trying to convince myself I don’t need one, and Chris just wants to be on the bridge with Captain Janeway…</p>

<p>You can get The Divide from these fine outlets:</p>

<ul>
  <li><a href="https://itunes.apple.com/gb/podcast/the-divide/id1063410638">iTunes</a></li>
  <li><a href="https://overcast.fm/itunes1063410638/the-divide">Overcast</a></li>
  <li><a href="http://thedivide.co.uk/shows/itunes.xml">RSS</a> (for other podcast readers)</li>
  <li><a href="http://thedivide.co.uk/">The Divide website</a></li>
</ul>

<p>Don’t forget to leave a review on iTunes and follow us on Twitter via <a href="http://twitter.com/PodcastDivide">@PodcastDivide</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2016/08/02/media-library-privacy-flaw-fixed-in-ios-10/">Media Library privacy flaw fixed in iOS 10</a></h1>
			
			<time datetime="2016-08-02" pubdate=""><a href="/weblog/2016/08/02/media-library-privacy-flaw-fixed-in-ios-10/">August 02, 2016</a></time>
    	</header>
    	<div>
			<p>As I’ve mentioned <a href="https://bendodson.com/weblog/2016/01/13/your-music-library-is-a-security-and-privacy-risk-on-ios/">many times before</a>, iOS had a pretty terrible privacy flaw in that apps didn’t need any permissions in order to read through your media library. This was an issue as it meant you could be fingerprinted easily and tracked across various apps<sup id="fnref:proof" role="doc-noteref"><a href="#fn:proof" class="footnote" rel="footnote">1</a></sup>. Thankfully, this has now been fixed in iOS 10<sup id="fnref:fixed" role="doc-noteref"><a href="#fn:fixed" class="footnote" rel="footnote">2</a></sup>.</p>

<p>In this article, I’ll explain how to update your apps to support this new privacy requirement. Before I do that, I’m going to show you what happens if you run an app built against the iOS 9.3 SDK (or earlier) on iOS 10:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2016/access-apple-music.jpg" width="800" height="450" alt="[app name] would like to access Apple Music" /></p>

<p>You’ll be prompted<sup id="fnref:permissiontext" role="doc-noteref"><a href="#fn:permissiontext" class="footnote" rel="footnote">3</a></sup> to allow permissions as soon as any media library code is encountered be that on app startup or in a background process such as that used by <a href="https://dodoapps.io/music-tracker/">Music Tracker</a>. If you decline to give permission then the app will quit to the home screen and you will not be able to use it. This is a big change from previous permission switches whereby apps built against the old SDK would be exempt from new permissions (i.e. if your iOS 7 SDK compiled app ran on iOS 8, it wouldn’t crash because it wasn’t using the new location privacy options). Personally I like this change as it allows you to see clearly which apps were abusing these APIs such as <a href="https://twitter.com/rosyna/status/743427770760364034">Canary</a> and <a href="https://twitter.com/chinanderm/status/743091483595546624">Google Calendar</a>.</p>

<p><strong>Bottom line</strong>: If you are using <code class="language-plaintext highlighter-rouge">MPMediaQuery</code> or similar in your app, you’d better update it with the iOS 10 SDK as soon as possible as otherwise you are going to get a lot of crashes if your users don’t allow the permission (or a lot of awkward questions if you shouldn’t be using this API).</p>

<p>How do you update your app to request permission for these APIs? First of all, lets whip up a basic example with Swift 3 that will pull the title of the first track in your music library:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">buttonPressed</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">MPMediaQuery</span><span class="o">.</span><span class="nf">songs</span><span class="p">()</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="k">let</span> <span class="nv">item</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
        <span class="kt">NSLog</span><span class="p">(</span><span class="s">"Title: </span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>In keeping with other permissions based APIs such as photos, contacts, and calendars, iOS 10 requires that you add a new key to your Info.plist file to explain why you want to use this permission; for music library access, this key is <code class="language-plaintext highlighter-rouge">NSAppleMusicUsageDescription</code>. If you don’t add this key, your app will crash as soon as you try and access an <code class="language-plaintext highlighter-rouge">MPMediaQuery</code> with the following message:</p>

<blockquote>
  <p><em>This app has crashed because it attempted to access privacy-sensitive data without a usage description.  The app’s Info.plist must contain an NSAppleMusicUsageDescription key with a string value explaining to the user how the app uses this data.</em></p>
</blockquote>

<p>With the <code class="language-plaintext highlighter-rouge">NSAppleMusicUsageDescription</code> key in place, you will now be given a standard permission dialogue when you first try and access the users media library. If the user chooses “Don’t Allow”, then the media query will fail and any subsequent calls will request in the <code class="language-plaintext highlighter-rouge">query.items</code> property being nil. If they choose “OK”, then nothing happens (as execution of the code is not suspended and there is no callback). To fix this, we need to use the <code class="language-plaintext highlighter-rouge">MPMediaLibrary.authorizationStatus()</code> and <code class="language-plaintext highlighter-rouge">requestAuthorization((MPMediaLibraryAuthorizationStatus) -&gt; Void)</code> APIs that were added in iOS 9.3 to do something like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">buttonPressed</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">MPMediaLibrary</span><span class="o">.</span><span class="n">requestAuthorization</span> <span class="p">{</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">authorized</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">runMediaLibraryQuery</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">displayMediaLibraryError</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">runMediaLibraryQuery</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">MPMediaQuery</span><span class="o">.</span><span class="nf">songs</span><span class="p">()</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="k">let</span> <span class="nv">item</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
        <span class="kt">NSLog</span><span class="p">(</span><span class="s">"Title: </span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">title</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">displayMediaLibraryError</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">switch</span> <span class="kt">MPMediaLibrary</span><span class="o">.</span><span class="nf">authorizationStatus</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">restricted</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="s">"Media library access restricted by corporate or parental settings"</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">denied</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="s">"Media library access denied by user"</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="s">"Unknown error"</span>
    <span class="p">}</span>
    
    <span class="k">let</span> <span class="nv">controller</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Error"</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span> <span class="nv">preferredStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">alert</span><span class="p">)</span>
    <span class="n">controller</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"OK"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>
    <span class="nf">present</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>You first need to request authorization and then run your code only if the status is <code class="language-plaintext highlighter-rouge">authorized</code>. If not, then you should display an error specific to whether or not the request was <code class="language-plaintext highlighter-rouge">denied</code> or <code class="language-plaintext highlighter-rouge">restricted</code> (usually by corporate or parental controls).</p>

<p>I’ve put an <a href="https://github.com/bendodson/media-library-access-in-ios-10">example project on GitHub</a> which uses the code above by way of demonstration.</p>

<p>I’m extremely grateful to everyone that has helped share my posts about this issue and to the engineers at Apple for fixing this privacy flaw. I’ll update this post should anything change between now and the expected public release of iOS 10 in September.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:proof" role="doc-endnote">
      <p>Whilst I had no concrete proof of this at the time of writing those articles, it <a href="https://twitter.com/rosyna/status/743398363496751104">looks like I was right that this was a widespread problem</a>. <a href="#fnref:proof" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:fixed" role="doc-endnote">
      <p>I don’t want to take all the credit for this but I honestly don’t think this would have been fixed if I hadn’t raised the issue repeatedly over the last 7 months. <a href="#fnref:fixed" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:permissiontext" role="doc-endnote">
      <p>In earlier builds of iOS 10 you’d be asked “<em>[App Name] Would Like to Access Apple Music</em>” (as shown in screenshots above) but as of iOS 10 beta 4 this has been changed to the more appropriate “<em>[App Name] Would Like to Access Apple Music and Your Media Library</em>”. <a href="#fnref:permissiontext" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	
</section>


<section id="pagination">
     
    	<a href="/weblog/page/6/" title="Previous Page" class="pagination-previous">&laquo; Older Entries</a>
     
	
    
      
      	<a href="/weblog/page/4/" title="Next Page" class="pagination-next">Newer Entries &raquo; </a>
      
    
</section>

		
		<footer>
			<p>I perform all freelance work through my company <strong>Dodo Apps Ltd</strong> (07856552) registered at The Bristol Office, 2nd Floor, 5 High Street, Westbury on Trym, Bristol, England, BS9 3BY</p>
		</footer>

	</div>


</body>
</html>