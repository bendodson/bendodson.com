<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	


	<link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'>
	<link rel="alternate" type="application/rss+xml" title="Ben Dodson, iOS Developer" href="https://bendodson.com/rss.xml" />
	<link rel="stylesheet" href="/styles-2018-07-02.css" />
	<link rel="stylesheet" href="/highlight-2018-02-23.css" />
	<link rel="icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/favicon.ico">
	<link rel="apple-touch-icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone-retina.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<title>Ben Dodson's Blog &mdash; Freelance Swift Developer and WallaBee Founder</title>
</head>
<body>

	<div id="wrapper">

		<header>
			<hgroup>
				<h1><a href="/">Ben Dodson</a></h1>
				<h2>Freelance iOS, Apple Watch, and Apple TV Developer</h2>
			</hgroup>
			<nav>
				<ul>
					<li><a href="/">Home</a></li><li><a href="/weblog/">Blog</a></li><li><a href="/about/">About</a></li><li><a href="/clients/">Portfolio</a></li><li><a href="/apps/">My Apps</a></li><li><a href="/projects/">Projects</a></li><li><a href="/contact/">Contact</a></li>
				</ul>
				<div class="divider"></div>
			</nav>
		</header>

		<section id="posts">

	
	<article>
		<header>
     		
				<h1><a href="/weblog/2018/08/09/bulleted-lists-with-uilabel/">Scalable bulleted lists with UILabel or UITextView</a></h1>
			
			<time datetime="2018-08-09" pubdate=""><a href="/weblog/2018/08/09/bulleted-lists-with-uilabel/">August 09, 2018</a></time>
    	</header>
    	<div>
			<p>I’ve recently been implementing auto-renewable subscriptions for a client and came across the need to create a bulleted list of notes<sup id="fnref:iapnotes"><a href="#fn:iapnotes" class="footnote">1</a></sup>. There are numerous tutorials available that show how you can do this but all of the ones I found had a flaw of some kind be it using fixed values for bullet widths or not taking variable font sizes from Dynamic Type into consideration.</p>

<p>Here, then, is a quick primer on how you can add correctly aligned bullets to a list be it in a UILabel or UITextView and have it scale correctly dependent on the users text size preferences.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>

    <span class="kr">@IBOutlet</span> <span class="kr">weak</span> <span class="kd">var</span> <span class="nv">label</span><span class="p">:</span> <span class="bp">UILabel</span><span class="p">!</span>
    
    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
        <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">updateUI</span><span class="p">),</span> <span class="n">name</span><span class="p">:</span> <span class="p">.</span><span class="n">UIContentSizeCategoryDidChange</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="n">updateUI</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">updateUI</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">let</span> <span class="nv">bullet</span> <span class="p">=</span> <span class="s">&quot;•  &quot;</span>
        
        <span class="kd">var</span> <span class="nv">strings</span> <span class="p">=</span> <span class="p">[</span><span class="nb">String</span><span class="p">]()</span>
        <span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Payment will be charged to your iTunes account at confirmation of purchase.&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Your subscription will automatically renew unless auto-renew is turned off at least 24-hours before the end of the current subscription period.&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Your account will be charged for renewal within 24-hours prior to the end of the current subscription period.&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Automatic renewals will cost the same price you were originally charged for the subscription.&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;You can manage your subscriptions and turn off auto-renewal by going to your Account Settings on the App Store after purchase.&quot;</span><span class="p">)</span>
        <span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Read our terms of service and privacy policy for more information.&quot;</span><span class="p">)</span>
        <span class="n">strings</span> <span class="p">=</span> <span class="n">strings</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="k">return</span> <span class="n">bullet</span> <span class="o">+</span> <span class="nv">$0</span> <span class="p">}</span>
        
        <span class="kd">var</span> <span class="nv">attributes</span> <span class="p">=</span> <span class="p">[</span><span class="n">NSAttributedStringKey</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]()</span>
        <span class="n">attributes</span><span class="p">[.</span><span class="n">font</span><span class="p">]</span> <span class="p">=</span> <span class="bp">UIFont</span><span class="p">.</span><span class="n">preferredFont</span><span class="p">(</span><span class="n">forTextStyle</span><span class="p">:</span> <span class="p">.</span><span class="n">body</span><span class="p">)</span>
        <span class="n">attributes</span><span class="p">[.</span><span class="n">foregroundColor</span><span class="p">]</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">darkGray</span>
        
        <span class="kd">let</span> <span class="nv">paragraphStyle</span> <span class="p">=</span> <span class="bp">NSMutableParagraphStyle</span><span class="p">()</span>
        <span class="n">paragraphStyle</span><span class="p">.</span><span class="n">headIndent</span> <span class="p">=</span> <span class="p">(</span><span class="n">bullet</span> <span class="k">as</span> <span class="bp">NSString</span><span class="p">).</span><span class="n">size</span><span class="p">(</span><span class="n">withAttributes</span><span class="p">:</span> <span class="n">attributes</span><span class="p">).</span><span class="n">width</span>
        <span class="n">attributes</span><span class="p">[.</span><span class="n">paragraphStyle</span><span class="p">]</span> <span class="p">=</span> <span class="n">paragraphStyle</span>

        <span class="kd">let</span> <span class="nv">string</span> <span class="p">=</span> <span class="n">strings</span><span class="p">.</span><span class="n">joined</span><span class="p">(</span><span class="n">separator</span><span class="p">:</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="p">.</span><span class="n">attributedText</span> <span class="p">=</span> <span class="bp">NSAttributedString</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">attributes</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2018/bulleted-list-scale.jpg" width="800" height="463" alt="Bulleted List for UILabel and UITextView" /></p>

<p>The first thing to determine is the bullet you want to use. I like to have a • (press <code>option + 8</code>) with two spaces afterwards. We store this in a variable and then build a <code>String</code> array with which we’ll populate each line of our list<sup id="fnref:localise"><a href="#fn:localise" class="footnote">2</a></sup>. These are then mapped to append the bullet we chose to the front of each string.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">let</span> <span class="nv">bullet</span> <span class="p">=</span> <span class="s">&quot;•  &quot;</span>        
<span class="kd">var</span> <span class="nv">strings</span> <span class="p">=</span> <span class="p">[</span><span class="nb">String</span><span class="p">]()</span>
<span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;First line of your list&quot;</span><span class="p">)</span>
<span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Second line of your list&quot;</span><span class="p">)</span>
<span class="n">strings</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;etc&quot;</span><span class="p">)</span>
<span class="n">strings</span> <span class="p">=</span> <span class="n">strings</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="k">return</span> <span class="n">bullet</span> <span class="o">+</span> <span class="nv">$0</span> <span class="p">}</span></code></pre></figure>

<p>Next we create the base attributes of our label or text view such as the font size and colour. As we want the text to scale dependent on the users own text preferences, we use Dynamic Type via <code>preferredFont(forTextStyle: .body)</code> although you can obviously use any font. The bulk of the heavy lifting is done by an <code>NSParagraphStyle</code> attribute called <code>headIndent</code> which adds a fixed amount of padding to all but the first line of a paragraph. We can determine the size that this indent should be by casting our bullet as an <code>NSString</code> and then providing our previously created attributes to the <code>size</code> method. This gives us the width of the bullet and any spacing you added afterwards in the exact font and size you have chosen.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">var</span> <span class="nv">attributes</span> <span class="p">=</span> <span class="p">[</span><span class="n">NSAttributedStringKey</span><span class="p">:</span> <span class="nb">Any</span><span class="p">]()</span>
<span class="n">attributes</span><span class="p">[.</span><span class="n">font</span><span class="p">]</span> <span class="p">=</span> <span class="bp">UIFont</span><span class="p">.</span><span class="n">preferredFont</span><span class="p">(</span><span class="n">forTextStyle</span><span class="p">:</span> <span class="p">.</span><span class="n">body</span><span class="p">)</span>
<span class="n">attributes</span><span class="p">[.</span><span class="n">foregroundColor</span><span class="p">]</span> <span class="p">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">darkGray</span>

<span class="kd">let</span> <span class="nv">paragraphStyle</span> <span class="p">=</span> <span class="bp">NSMutableParagraphStyle</span><span class="p">()</span>
<span class="n">paragraphStyle</span><span class="p">.</span><span class="n">headIndent</span> <span class="p">=</span> <span class="p">(</span><span class="n">bullet</span> <span class="k">as</span> <span class="bp">NSString</span><span class="p">).</span><span class="n">size</span><span class="p">(</span><span class="n">withAttributes</span><span class="p">:</span> <span class="n">attributes</span><span class="p">).</span><span class="n">width</span>
<span class="n">attributes</span><span class="p">[.</span><span class="n">paragraphStyle</span><span class="p">]</span> <span class="p">=</span> <span class="n">paragraphStyle</span></code></pre></figure>

<p>Finally we join our string with line breaks (<code>strings.joined(separator: "\n\n")</code>) and create an attributed string with the attributes including the new paragraph style.</p>

<p>This all works but there are two more things you’ll need to do to support dynamic font scaling. First of all you’ll want to ensure that the ‘Automatically Adjusts Font’ checkbox is selected in Interface Builder for your label or text view<sup id="fnref:automaticallyadjusts"><a href="#fn:automaticallyadjusts" class="footnote">3</a></sup>. Secondly, you’ll want to be notified when the content size changes (i.e. when the user goes to the Settings app and increases or decreases the text size) by subscribing to the <code>UIContentSizeCategoryDidChange</code> notification and regenerating your label. I prefer to do this in a method named <code>updateUI</code> but your personal preference may vary.</p>

<p>The nice thing about this setup is that it is entirely fluid, doesn’t require any 3rd party dependencies, and can be used with any mixture of bullet types be they a single character, a word, or even emoji:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2018/bulleted-list-marks.jpg" width="800" height="463" alt="Bulleted List with custom bullets for UILabel and UITextView" /></p>

<p>I’ve uploaded a <a href="https://github.com/bendodson/bulleted-list-for-uilabel-uitextview">basic project</a> to GitHub to demonstrate this code in action. Hopefully this article will serve as a reminder that you don’t need to import 3rd party libraries to achieve basic text formatting and that you should always be wary of text code that doesn’t take font scaling into account.</p>

<div class="footnotes">
  <ol>
    <li id="fn:iapnotes">
      <p>Sourced from the <a href="http://davidbarnard.com/post/164337147440/testing-auto-renewable-subscriptions-on-ios">excellent tutorial</a> by David Barnard. <a href="#fnref:iapnotes" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:localise">
      <p>Don’t forget to use <code>NSLocalizedString</code> - I didn’t bother for the sake of brevity in this article. <a href="#fnref:localise" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:automaticallyadjusts">
      <p>Alternatively you can use the <code>adjustsFontForContentSizeCategory</code> boolean on <code>UILabel</code> and <code>UITextView</code>. <a href="#fnref:automaticallyadjusts" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2018/07/02/solcaster/">Solcaster</a></h1>
			
			<time datetime="2018-07-02" pubdate=""><a href="/weblog/2018/07/02/solcaster/">July 02, 2018</a></time>
    	</header>
    	<div>
			<p>I’m pleased to announce the release of a new client app I’ve been working on for the last few weeks: <a href="https://itunes.apple.com/us/app/solcaster/id1387772375?ls=1&amp;mt=8">Solcaster</a>, the reverse weather app.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2018/solcaster.jpg" width="800" height="468" /></p>

<p>I worked as the only iOS developer on Solcaster for Reidefine LLC working remotely from the UK. The app is an interesting concept in that it helps you find weather you might be looking for rather than telling you what the weather is like right now. When you open the app, you can choose the type of weather you are looking for, the area you are searching from, and the maximum amount of travelling you are willing to do. It then runs this through a sophisticated algorithm of my own design to show you where you can find that weather. This is useful for a wide range of people be they searching for sun, snow, storms, wind, or even rain<sup id="fnref:rain"><a href="#fn:rain" class="footnote">1</a></sup>!</p>

<p>Once you’ve found an area you are interested in, Solcaster provides even more information including the previous and future weather<sup id="fnref:previousfuture"><a href="#fn:previousfuture" class="footnote">2</a></sup>, interesting hikes and climbs, and any events that may be in the local area. This is all powered by a number of APIs with an intelligent caching layer that makes requests as fast and responsive as possible. In addition, there are deeply customisable settings including temperature thresholds, wind speeds, snow accumulation, and of course the option to choose between Celsius and Fahrenheit.</p>

<p>The app is written entirely in Swift 4.1 and is optimised for all iPhone sizes including the relatively new iPhone X. There are a number of interesting Apple technologies being used including iCloud sync which helps keep the settings the same across all of your devices as well as syncing your favourited trips and recent searches. Whilst the app is free to download, it is limited to searching within a 1 hour radius and does contain ads from Admob. For a single in-app purchase of $1.99, the ads are removed and the radius can be extended up to 8 hours. This unlock is also synced automatically through iCloud sync so that you don’t ever need to hit the “restore purchases” button that is ubiquitious with in-app purchases<sup id="fnref:restore"><a href="#fn:restore" class="footnote">3</a></sup>.</p>

<p>I really enjoyed working with Reidefine LLC on this project and building something a little bit different to other weather apps on the market. You can download <a href="https://itunes.apple.com/us/app/solcaster/id1387772375?ls=1&amp;mt=8">Solcaster on the App Store</a> for free and learn more about it at <a href="https://www.solcaster.com">solcaster.com</a>.</p>

<div class="footnotes">
  <ol>
    <li id="fn:rain">
      <p>I’m currently in the middle of a heatwave in Leicester. Unfortunately my nearest rain is in 300 miles away in France… tempting! <a href="#fnref:rain" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:previousfuture">
      <p>Why the previous weather? If you’re a snowboarder the amount of snow that fell yesterday is probably more important to you than the weather today. <a href="#fnref:previousfuture" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:restore">
      <p>It is mandatory for iOS apps to provide a “restore purchases” button when using in-app purchases so that functionality can be restored should you delete and reinstall the app, restore from a backup, or update to a new device. My thinking was that it was far better to sync this information through the secure iCloud sync such that this unlocking is seamless. You can try it by downloading and upgrading Solcaster on one device then opening it on another; within a second or two of opening the app you’ll notice the ads pop away without the need to tap a button and sign in to your Apple account. Wonderful! <a href="#fnref:restore" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2018/06/20/iphone-only-apps-on-ipad/">"iPhone Only" apps on the iPad</a></h1>
			
			<time datetime="2018-06-20" pubdate=""><a href="/weblog/2018/06/20/iphone-only-apps-on-ipad/">June 20, 2018</a></time>
    	</header>
    	<div>
			<p>Since the launch of the iPad in 2010, any app that runs on the iPhone will also run on the iPad in a scaled format. This is normally<sup id="fnref:ipadpro"><a href="#fn:ipadpro" class="footnote">1</a></sup> in the 3:2 aspect ratio which the original iPhone had all the way up until the iPhone 5 when they changed to the 16:9 ratio<sup id="fnref:xratio"><a href="#fn:xratio" class="footnote">2</a></sup>. Many developers forget about this fact and happily build their iPhone apps unaware that the App Store Review team will test them on an iPad and reject you if something doesn’t work. The fact that this 3:2 aspect ratio is used has been the bane of my iPhone development life for the past couple of years as even though iOS 10 dropped support for the iPhone 4S you still had to make your iPhone apps run at 3:2 so they could work on the iPad. This is particularly frustrating when designers provide designs at the 16:9 size and you have to find a way to make fixed size assets work on the smaller height without resorting to scrollbars…</p>

<p>It looks like this is set to change with iOS 12 as beta 2 is now running iPhone apps in their 16:9 ratio on all iPads rather than than the 3:2 ratio. Whilst there aren’t any App Store guidelines changes to go along with this, it follows that <strong>if you build an iOS 12 app you no longer need to support the 3:2 screen size</strong>.</p>

<p>Here is an example of one of my upcoming iPhone only apps running on a 9.7” iPad with iOS 11 and one with iOS 12 beta 2:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2018/ios12ipadscaling.jpg" width="800" height="600" /></p>

<p>As ever, things could still change and Apple may reverse this decision in later betas but it seems unlikely bearing in mind this has been standard practice on the 12.9” iPad Pro since launch.</p>

<p>This is still not a perfect solution. I am desperate for Apple to finally stop the ridiculous notion that iPhone apps need to run on iPad. The App Store actively fights against this edge case by requiring you to choose “iPhone Only”<sup id="fnref:appstoresearch"><a href="#fn:appstoresearch" class="footnote">3</a></sup> when searching for iPhone apps so why not allow developers to choose if their app should be able to run on an iPad or not?</p>

<p>The thing that irks me most about this is that iPhone apps on the iPad are not a good experience. Phil Schiller even <a href="https://youtu.be/L4eZryAFcLg?t=7m42s">said</a> as much at the launch of the iPad Mini:</p>

<blockquote>
  <p>We’ve learned […] that customers love the ones written for iPad, designed for that screen. What does the other platform have? They have phone applications stretched up; not tablet applications.</p>
</blockquote>

<p>He even shows the Android phone version of Yelp scaled up on an Android tablet versus the native iPad app <a href="https://youtu.be/L4eZryAFcLg?t=8m1s">saying</a>:</p>

<blockquote>
  <p>You get a great experience on iPad mini, you get a scaled up phone experience on that other product. It’s a big difference.</p>
</blockquote>

<p>This continues with a number of apps with the message being clear that scaled up phone apps on a tablet are worse than native tablet apps. I couldn’t agree more, Phil.</p>

<p>For now, the change from 3:2 ratio apps to 16:9 ratio is a big win for developers and will avoid a lot of design problems. I can only hope that later Xcode builds will finally allow an option for truly “iPhone Only” builds.</p>

<div class="footnotes">
  <ol>
    <li id="fn:ipadpro">
      <p>The 12.9” iPad Pro was an outlier that always used the 16:9 ratio for some reason. Doesn’t really make sense that it got this change first as all iPads are the same 4:3 ratio anyway… <a href="#fnref:ipadpro" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:xratio">
      <p>Unfortunately 16:9 wasn’t the end of it and the iPhone X has a new aspect ratio of 39:18 (or 19.5:9 if you prefer). <a href="#fnref:xratio" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:appstoresearch">
      <p>Which is a ridiculous name. Why not “iPad Only” and “iPad and iPhone”? If they were truly “iPhone Only” they shouldn’t even show up in the same way that Apple TV apps don’t appear on an iPad! <a href="#fnref:appstoresearch" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2018/06/05/custom-intents-with-sirikit-ios-12/">Custom Intents with SiriKit on iOS 12</a></h1>
			
			<time datetime="2018-06-05" pubdate=""><a href="/weblog/2018/06/05/custom-intents-with-sirikit-ios-12/">June 05, 2018</a></time>
    	</header>
    	<div>
			<p>Yesterday was the start of WWDC 2018 and one new feature in iOS 12 caught my attention amongst the many that were demonstrated:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2018/heysiritile.jpg" alt="Hey Siri, I lost my keys" width="800" height="450" /></p>

<p>The demo was part of the new Shortcuts system and showed that apps could reveal some functionality to Siri, in this case the Tile app being able to search for your keys. Once the keynote was over and the documentation went live, I had a dig through and was intrigued to find a new “custom intent” within SiriKit exposed as <a href="https://developer.apple.com/documentation/sirikit/inobject?changes=latest_minor">INObject</a>. This is paired with a full demo app in the form of <a href="https://developer.apple.com/documentation/sirikit/accelerating_app_interactions_with_shortcuts?changes=latest_minor">Soup Chef</a> that shows how you can create these custom intents and use them as shortcuts for Siri. The most interesting thing about this is the following concept from the Soup Chef overview:</p>

<blockquote>
  <p>These types define the schema that Siri uses to identify requests the user makes; for example, “Order tomato soup with cheese.” The parameter combination for this example is: soup and options.</p>
</blockquote>

<p>When I dug into the code, I found this new <code>Intents.intentdefinition</code> file with which you can create custom intents complete with paramater binding.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2018/sirikit-custom-intent.jpg" alt="Custom Intent creation with SiriKit" width="800" height="640" /></p>

<p>This sure looks like the much anticipated ability to write your own Siri code!</p>

<h3 id="what-this-isnt">What this isn’t</h3>

<p>It turns out that isn’t the case. The new custom intents are for “Siri the all-seeing widget assistant” not for “Siri the thing you control with your voice”. These custom intents are designed to be created for very specific use cases and then exposed as shortcuts so that you can access them quickly from your lock screen, add them to a workflow, or activate them with a custom voice command <em>that the user creates</em>. Despite the schema being present and the documentation alluding to voice control, you cannot create your own custom commands such as <em>“Order tomato soup with cheese”</em>.</p>

<p>By way of an example, I have my own app that I use to update my gaming time on my <a href="https://shyguys.io/recently-played/">ShyGuys gaming website</a> and I was hoping to be able to use this system to say <em>“Hey Siri, add 0.8 hours of gaming time to Skyrim on the Switch”</em>. In parameter based terms this would be <em>“add [hours:decimal] of gaming time to [title:string] on the [console:enum]”</em>. Unfortunately this is not yet possible although the system shows promise for this future.</p>

<p>Before I go into how this system works and the intended use case, there is one extra thing in SiriKit that will please many developers; <a href="https://developer.apple.com/documentation/sirikit/media?changes=latest_minor">Media Intent Domain</a> which effectively allows you to use Siri to control media apps such as Spotify, Audible, or Overcast once the developers add the necessary updates.</p>

<h3 id="custom-intents-and-shortcuts">Custom Intents and Shortcuts</h3>

<p>If you are unable to write custom Siri scripts, what then is the point of the new custom intent? It is designed to give you a quick shortcut to commonly used tasks.</p>

<p>In many ways, the Tile app is the perfect demo as it really only does one thing which is to find a specific object. The developers of Tile could create a custom intent of the sort “Find [tile:custom]” and when the app first launches on iOS 12 they can <em>donate</em> an <code>INIntent</code> for every Tile that you own; this basically registers the shortcut with the system so you are telling Siri<sup id="fnref:widgetmaster"><a href="#fn:widgetmaster" class="footnote">1</a></sup> that there is a “Find Keys” intent, “Find Remote” intent, “Find Dog” intent, etc. These intents are exposed to the user as Shortcuts both within the Settings app and in the new Shortcuts app<sup id="fnref:shortcutsapp"><a href="#fn:shortcutsapp" class="footnote">2</a></sup>. Every time you use the Tile app to find something, the specific intent for that device can be re-donated to the system which helps Siri learn and enables it to prompt you when you may need to do this. For example, if you open your Tile app every morning at 8am and tap on your “Keys” Tile to find it, then that “Find Keys” intent is donated to the system helping Siri realise it should probably show you that intent just before 8am. How does it show an intent? By displaying it as a Shortcut on your lock screen, notification centre, Apple Watch, or within the Shortcuts app where it can then be paired with other Shortcuts from other apps (i.e. you could have an “I’m running late” workflow which sends an iMessage to your boss, activates your find keys intent, loads up your route to work in Maps, and opens the garage ready for you to jump into your car).</p>

<p>The piece that makes this slightly more confusing is that you can add a custom Siri voice command to a Shortcut. When Craig demonstrated saying <em>“Hey Siri, I lost my keys”</em>, that is really just a voice command on the “Find Keys” custom intent and is highly specific to that particular Tile; you’d have to record a new one if you wanted to find your TV Remote Tile. These <em>Shortcut Phrases</em> can be created either from within the Settings app or an app can present a view controller<sup id="fnref:inuiaddvoiceshortcutviewcontroller"><a href="#fn:inuiaddvoiceshortcutviewcontroller" class="footnote">3</a></sup> (complete with a suggested command text) that lets the user record their custom snippet.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2018/sirikit-shortcut-phrases.jpg" width="800" height="600" /></p>

<p>When a Shortcut is invoked (either by a Shortcut Phrase or by tapping on a Shortcut) it can either launch your app in the foreground or fire up your <code>INExtension</code> that will allow you to then return a custom UI directly within Siri. Both have their uses although again they are fairly specific.</p>

<p>By way of an example, lets say I order a Chinese takeaway every Friday night<sup id="fnref:everyfriday"><a href="#fn:everyfriday" class="footnote">4</a></sup> via the Just Eat app. When I place my order, the app could create two custom intents:</p>

<ol>
  <li>A generic intent for the takeaway venue: <code>"Order from [name:string]"</code></li>
  <li>A specific intent for my meal: <code>"Order [menuitems:array] from [name:string]"</code></li>
</ol>

<p>The first one could launch the Just Eat app and take me directly to the menu for the takeaway I order from so I can peruse and then place my order. The second one would instead be able to place my regular order without opening the app and even provide custom UI to perform an Apple Pay transaction within Siri.</p>

<p>This is super powerful when combined with other Shortcuts as I could then record a Shortcut Phrase <em>“Hey Siri, it’s Friday Friday got to get down on Friday”<sup id="fnref:friday"><a href="#fn:friday" class="footnote">5</a></sup></em> which would turn on my living room lights, open up the Netflix app on my Apple TV<sup id="fnref:dream"><a href="#fn:dream" class="footnote">6</a></sup>, lock the front door, and place my Chinese order.</p>

<p>The fact that these Shortcuts can be created silently by the app and then donated to Siri so it can then suggest them to you at certain points is also super interesting. Siri already knows to show the Just Eat app in my Siri App Suggestions on a Friday night so having it in the future automatically prompt me to place a repeat order will cut out some time. Once lots of apps add support for this it will be cool and perhaps a little scary to see what regular habits we have that we didn’t even realise.</p>

<p>(<strong>Update:</strong> It turns out that apps have been creating Shortcuts since as far back as iOS 8. If you make use of <code>NSUserActivity</code> then these are donated automatically when calling <code>becomeCurrent()</code> or you can use the <code>donate(completion:)</code> method of <code>INInteraction</code> since iOS 10 to donate any of the standard SiriKit interactions such as starting a workout, initiating a voip call, or booking a ride. Any app that has done this, regardless of whether it has been updated for iOS 12, will show in the Shortcuts system.)</p>

<p>To be clear, this system is not yet at the same stage as Alexa or Google Home. You can’t say “Order half crispy aromatic duck and some egg friend rice from Peking House” without first having already placed that order and assigning a Shortcut Phrase to it. However, the jump to that system suddenly doesn’t seem so far. Siri is already getting all of the data it needs thanks to the intents parameter builder and I can’t shake the feeling that these custom Shortcut Phrases are just going to be used to train Siri to lots of different words over the coming year. There is going to need to be some clever work to avoid collisions<sup id="fnref:collisions"><a href="#fn:collisions" class="footnote">7</a></sup> but on the whole I’m excited to see where this heads next.</p>

<p>All of the topics above are due to be covered at WWDC today and tomorrow at the following sessions:</p>

<ul>
  <li>Tuesday 5pm: “Introduction to Siri Shortcuts” [<a href="https://developer.apple.com/videos/play/wwdc2018/211/">link</a>]</li>
  <li>Wednesday 10am: “Building for Voice with Siri Shortcuts” [<a href="https://developer.apple.com/videos/play/wwdc2018/214/">link</a>]</li>
  <li>Wednesday 11am: “Siri Shortcuts on the Siri Watch Face” [<a href="https://developer.apple.com/videos/play/wwdc2018/217/">link</a>]</li>
</ul>

<p>Also, don’t forget to check out the <a href="https://developer.apple.com/documentation/sirikit/accelerating_app_interactions_with_shortcuts?changes=latest_minor">Soup Chef</a> demo app.</p>

<div class="footnotes">
  <ol>
    <li id="fn:widgetmaster">
      <p>Siri the widget master, not the voice. <a href="#fnref:widgetmaster" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:shortcutsapp">
      <p>Which is not available in iOS 12 Beta 1. <a href="#fnref:shortcutsapp" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:inuiaddvoiceshortcutviewcontroller">
      <p><a href="https://developer.apple.com/documentation/sirikit/inuiaddvoiceshortcutviewcontroller?changes=latest_minor"><code>INUIAddVoiceShortcutViewController</code></a> <a href="#fnref:inuiaddvoiceshortcutviewcontroller" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:everyfriday">
      <p>And maybe Tuesday night as well. Sometimes. <a href="#fnref:everyfriday" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:friday">
      <p><a href="https://www.youtube.com/watch?v=kfVsfOSbJY0">It’s a classic.</a> <a href="#fnref:friday" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:dream">
      <p>I can dream - this might be possible with the Shortcuts app but we won’t know until it appears in a later beta seed! <a href="#fnref:dream" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:collisions">
      <p>Even saying “Hey Siri, use Just Eat to order half crispy aromatic duck and some egg fried rice from Peking House” isn’t great as an app name is not unique (only the app name on the App Store is and even then it can’t distinguish between “Just Eat”, “JustEat”, and “Just Eat!”). It’s a solvable problem but it does add an extra layer of difficulty. <a href="#fnref:collisions" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2017/11/07/infoworld-interview/">Developers who work from spectacular locations</a></h1>
			
			<time datetime="2017-11-07" pubdate=""><a href="/weblog/2017/11/07/infoworld-interview/">November 07, 2017</a></time>
    	</header>
    	<div>
			<p>I was recently asked some questions about how I work for an article about <a href="https://www.infoworld.com/article/3236404/it-careers/developers-who-work-from-spectacular-locations.html#slide3">developers who work from spectacular locations</a>. You can read the full piece over at <a href="https://www.infoworld.com/article/3236404/it-careers/developers-who-work-from-spectacular-locations.html#slide3">InfoWorld</a> but I’ve put their full questions and my answers below:</p>

<h3 id="what-work-do-you-do">What work do you do?</h3>

<blockquote>
  <p>I am a freelance app developer working on apps for iPhone, iPad, Apple Watch, and Apple TV.</p>
</blockquote>

<h3 id="whenhow-did-you-go-remote">When/how did you go remote?</h3>

<blockquote>
  <p>I used to be a Development Manager in a London-based digital agency back in 2009 and when I moved to another agency it wasn’t a good fit (far too many meetings, not enough actual work). I made the decision to go freelance as a PHP developer which necessitated me working from home essentially forcing me into remote work. I was intrigued by the recently launched iPhone and so started to develop for that - thanks to a lucky appearance on The Gadget Show, I’ve been able to do that ever since.</p>
</blockquote>

<h3 id="how-did-you-end-up-in-the-location-you-are-in">How did you end up in the location you are in?</h3>

<blockquote>
  <p>I’ve always worked from home as a freelancer so the location I’m in now is really just because I live here (which was due to meeting my wife). The greatest joy of remote working is that you can literally work from anywhere so whilst I could theoretically work in a hammock on a beach I’m much happier sat in bed with a cup of tea and my laptop!</p>
</blockquote>

<h3 id="what-did-it-take-to-go-remote-buy-a-laptop-outfit-an-office-argue-with-a-bossteam-something-else">What did it take to go remote? (Buy a laptop? Outfit an office? Argue with a boss/team? Something else?)</h3>

<blockquote>
  <p>The only thing I needed was the confidence to quit my job and base all of my income on freelancing. That wasn’t an easy decision and it was fairly difficult for the first few months but it all worked out in the end.</p>
</blockquote>

<h3 id="have-you-compared-the-economics-of-your-remote-situation-to-your-previous-one-how-do-they-compare">Have you compared the economics of your remote situation to your previous one? How do they compare?</h3>

<blockquote>
  <p>Initially I was earning a lot less money due to having very few clients and I was paid irregularly compared to a monthly salary. This changed fairly quickly though and now there is no question that financially it was the right decision to make. Even more importantly is the economics of happiness; I am far happier in my life as a freelance remote worker able to choose when and where I work than I ever was working in an office. This is so true that I refuse to work as a contractor in a clients office even if only for a few days as I find I just can’t produce the same quality of work when stuck in an open plan office on a fixed time schedule.</p>
</blockquote>

<h3 id="are-there-hassles-you-didnt-expect">Are there hassles you didn’t expect?</h3>

<blockquote>
  <p>The biggest problems are distractions and motivation. It is very easy, especially in the first few months, to kick back and do very little work as you don’t feel the need to rush. Then, when you run out of money you panic and work ridiculously long hours to try and get some invoices sent out. Freelancers typically have periods they call “feast and famine” or “rollercoaster dips” but they are generally referring to having enough advance work; my problem was always that I introduced those periods myself by putting things off as sometimes I’d wake up and just want to play on the Xbox rather than writing an algorithm for a social feed. Thankfully I have now gotten myself into a comfortable routine (especially now that I don’t live on my own) and so things tend to be smooth sailing but at the start it was very difficult to stay motivated when surrounded by nice distractions!</p>
</blockquote>


		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2017/10/26/drinkcoach/">DrinkCoach+</a></h1>
			
			<time datetime="2017-10-26" pubdate=""><a href="/weblog/2017/10/26/drinkcoach/">October 26, 2017</a></time>
    	</header>
    	<div>
			<p>I’m pleased to announce the release of a new client app, <a href="https://itunes.apple.com/gb/app/drinkcoach+/id849022698?mt=8">DrinkCoach+</a>, that I worked on over the summer:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2017/drink-coach.jpg" width="800" height="600" /></p>

<p>I worked on DrinkCoach+ for <a href="http://www.orbismedia.co.uk">Orbis Media</a> as a freelance iOS developer. The app was designed for the Haringey Advisory Group on Alcohol (HAGA) and is designed to help people keep a track of their alcohol intake with measurable goals and monitor any events caused by drinking such as moodswings, cravings, or accidents. This is actually version 3.0 of the app with the previous versions having been created by a different developer. The old code was neither available or desireable and so I rebuilt the app from scratch using Swift 4.0 and the latest iOS SDKs to ensure it was future proofed for any future developer to work on.</p>

<p>The app is optimised for all iPhone and iPad devices (including the iPhone X) and makes use of AutoLayout to scale perfectly across the growing number of screen resolutions and aspect ratios. In terms of functionality, there are a number of interesting technologies used in the app including:</p>

<ul>
  <li><strong>Local notifications:</strong> the app can notify you at certain times and even locations to help keep you on track with your goals. This was all done locally on the device so that notifications could be triggered without an internet connection or unreliable push notifications.</li>
  <li><strong>Infographic generation:</strong> an infographic detailing how many calories and units you’ve consumed along with your total alcohol expenditure can be displayed in the app and shared as an image.</li>
  <li><strong>Full customisation:</strong> the drinks in the app can be customised with specific units, calories, and pricing information so that they accurately reflect your usual tipple. Drinks can also be dragged and dropped so that your regular drinks are easier to access.</li>
</ul>

<p>It was really great to work with Orbis Media again and I’m confident that people will love the improvements to this version of the app. You can download <a href="https://itunes.apple.com/gb/app/drinkcoach+/id849022698?mt=8">DrinkCoach+ on the App Store</a> for free and learn more about it at <a href="http://www.drinkcoach.org.uk">drinkcoach.org.uk</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2017/10/04/forcing-left-to-right-text-ios-localization/">Forcing left-to-right text in iOS localizations</a></h1>
			
			<time datetime="2017-10-04" pubdate=""><a href="/weblog/2017/10/04/forcing-left-to-right-text-ios-localization/">October 04, 2017</a></time>
    	</header>
    	<div>
			<p>Since iOS 6 it has been the case that any localization that utilises a right-to-left language (such as Arabic) will automatically flip your views so that everything scans from right-to-left. Usually this is desireable but there are certain instances where you may want to disable this functionality (such as with a media player that should scrub from left-to-right). I was recently asked by a client to completely disable the right-to-left functionality for all languages as it was causing too many display issues within the app and customers were specifically saying they’d prefer it to scan that way.</p>

<p>After a bit of searching, the <a href="https://stackoverflow.com/questions/14724767/ios-disable-ui-mirroring-in-xib">general consensus</a> was that I’d need to manually alter<sup id="fnref:manualstoryboard"><a href="#fn:manualstoryboard" class="footnote">1</a></sup> all of my horizontal constraints in order to force them to be left to right rather than leading to trailing which will flip based on localization. In a project with 1000s of these constraints this did not seem a suitable course of action and would require any future developers on the project to keep this in mind when creating new constraints.</p>

<p>Instead, I came across a property added to UIView in iOS 9 named <code>semanticContentAttribute</code>. This allows you to choose <code>unspecified</code> (the default which flips based on localization), <code>playback</code> and <code>spatial</code> which are special cases for media controls or directional controls, and <code>forceLeftToRight</code> and <code>forceRightToLeft</code> which work as their names would suggest. Thanks to the <code>UIAppearance</code> protocol, disabling the flipping globally is a simple one-liner:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="bp">UIView</span><span class="p">.</span><span class="n">appearance</span><span class="p">().</span><span class="n">semanticContentAttribute</span> <span class="p">=</span> <span class="p">.</span><span class="n">forceLeftToRight</span></code></pre></figure>

<p>This not only flips all content back to left-to-right but also ensures that your <code>UINavigationController</code> will animate from left-to-right as well. Of course, you can also use the <code>appearanceWhenContainedIn:</code> method to limit this global change to specific view controllers of your app should you wish to or to set certain controls to other directions.</p>

<p>The only other thing I needed to change in my project to get this all working was some paragraph styles for attributed strings. I frequently use <code>NSMutableParagraphStyle</code> to set custom line heights and I leave the other properties to their defaults. One of these is <code>alignment</code> which is always left on my devices due to my English language but the default is actually <code>natural</code> which means it renders depending on the language. Searching through my project and finding the few places I’d left out a default and setting it was fairly trivial:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">let</span> <span class="nv">paragraph</span> <span class="p">=</span> <span class="bp">NSMutableParagraphStyle</span><span class="p">()</span>
<span class="n">paragraph</span><span class="p">.</span><span class="n">lineSpacing</span> <span class="p">=</span> <span class="mf">4.0</span>
<span class="n">paragraph</span><span class="p">.</span><span class="n">alignment</span> <span class="p">=</span> <span class="p">.</span><span class="kr">left</span></code></pre></figure>

<p>In total, I only needed to make 8 edits to my project; much easier than trying to edit every horizontal constraint in your storyboard!</p>

<div class="footnotes">
  <ol>
    <li id="fn:manualstoryboard">
      <p>If I had gone down that route I likely would have written a build script that would go through every xib and storyboard file and do this for me but I have been burned by manually editing xib files in the past. That’s a young man’s game! <a href="#fnref:manualstoryboard" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2017/07/19/mpmediaitem-canaddtolibrary/">MPMediaItem+CanAddToLibrary.swift</a></h1>
			
			<time datetime="2017-07-19" pubdate=""><a href="/weblog/2017/07/19/mpmediaitem-canaddtolibrary/">July 19, 2017</a></time>
    	</header>
    	<div>
			<p>Since iOS 9.3 it has been possible to <a href="https://bendodson.com/weblog/2016/02/23/details-on-ios-9-3-media-library-additions/">add Apple Music tracks to the media library</a> as such:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">let</span> <span class="nv">library</span> <span class="p">=</span> <span class="bp">MPMediaLibrary</span><span class="p">()</span>
<span class="n">library</span><span class="p">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">withProductID</span><span class="p">:</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
	<span class="k">if</span> <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
		<span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error: </span><span class="si">\(</span><span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This is powerful as you can use a simple identifier to both play a song and add it to the library but it is likely that your UI will want to show an add to library button similar to the Music app on iOS. To remedy this, I’ve created a <a href="https://github.com/bendodson/MPMediaItem-CanAddToLibrary">simple Swift extension</a><sup id="fnref:mpmediaitemswift"><a href="#fn:mpmediaitemswift" class="footnote">1</a></sup> for MPMediaItem that tells you if a currently playing track is available in your library:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">MediaPlayer</span>

<span class="kd">extension</span> <span class="bp">MPMediaItem</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">canAddToLibrary</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">id</span> <span class="p">=</span> <span class="bp">MPMediaPropertyPredicate</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">persistentID</span><span class="p">,</span> <span class="n">forProperty</span><span class="p">:</span> <span class="n">MPMediaItemPropertyPersistentID</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">query</span> <span class="p">=</span> <span class="bp">MPMediaQuery</span><span class="p">(</span><span class="n">filterPredicates</span><span class="p">:</span> <span class="p">[</span><span class="n">id</span><span class="p">])</span>
        <span class="kd">let</span> <span class="nv">count</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="n">items</span><span class="p">?.</span><span class="bp">count</span> <span class="p">??</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">count</span> <span class="p">==</span> <span class="mi">0</span>
    <span class="p">}</span>
    
<span class="p">}</span></code></pre></figure>

<p>Why an extension on MPMediaItem? The only way to know if a track is in your library is to search the user library with an <code>MPMediaQuery</code>. Unfortunately you can’t search on  the <code>MPMediaItemPropertyPlaybackStoreID</code> (as some tracks may not be on Apple Music) so instead you need to use the persistent ID property. If you try and play an Apple Music track using an identifier, then you can retrieve an MPMediaItem and use that to get the persistent ID for searching the media library. I use this in my own apps<sup id="fnref:playlist"><a href="#fn:playlist" class="footnote">2</a></sup> by listening to the <code>MPMusicPlayerControllerNowPlayingItemDidChange</code> notification and then checking if there is a <code>nowPlayingItem</code> on my <code>MPMusicPlayerController</code> instance; if there is then check it to find the current status:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">var</span> <span class="nv">player</span> <span class="p">=</span> <span class="bp">MPMusicPlayerController</span><span class="p">()</span>

<span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
    
    <span class="n">player</span><span class="p">.</span><span class="n">beginGeneratingPlaybackNotifications</span><span class="p">()</span>
    <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">playbackStateDidChange</span><span class="p">),</span> <span class="n">name</span><span class="p">:</span> <span class="p">.</span><span class="n">MPMusicPlayerControllerNowPlayingItemDidChange</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>


<span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">playbackStateDidChange</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">item</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">nowPlayingItem</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// at this point we do not know if the track can be added - any UI for adding should be hidden</span>

    <span class="k">if</span> <span class="n">item</span><span class="p">.</span><span class="n">canAddToLibrary</span> <span class="p">{</span>
    	<span class="c1">// show your &quot;Add to library&quot; button</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    	<span class="c1">// show some UI to explain &quot;Already in library&quot;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>I am fairly sure this is how the Music app works on iOS as you’ll notice when skipping tracks that the UI for the track status is completely hidden until the track is ready to play at which point either an add button or a tick will appear. One thing that caught me out was listening for <code>MPMusicPlayerControllerPlaybackStateDidChange</code> but this seems to fire inconsistently both on iOS 10 and iOS 11 (unless you are on an iPad and run the Music app in split-screen mode in which case it always works) - checking for <code>MPMusicPlayerControllerNowPlayingItemDidChange</code> works consistently and will still yield an <code>MPMediaItem</code> with which to work with.</p>

<p><strong>IMPORTANT:</strong> The user will need to have granted permission to access their media library in order for this extension to work. It will crash your app if you do not have NSAppleMusicUsageDescription in your Info.plist (although that is the bare minimum - you should actively check for capabilities before using this as no point showing an “Add to library” button if the user doesn’t have that capability!)</p>

<p><a href="https://github.com/bendodson/MPMediaItem-CanAddToLibrary">Checkout the <code>MPMediaItem+CanAddToLibrary</code> Swift extension on GitHub</a></p>

<div class="footnotes">
  <ol>
    <li id="fn:mpmediaitemswift">
      <p>I wrote the extension using Swift 4 with Xcode 9 / iOS 11 SDK but it should work just fine in Swift 3 as it isn’t using any new language stuff. <a href="#fnref:mpmediaitemswift" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:playlist">
      <p>Including an exciting iOS 11 only Apple Music app I’m working on. If you’re an Apple Music subscriber with the iOS 11 beta installed (developer or public), <a href="https://bendodson.com/contact/">contact me</a> for a test version before it launches in September… <a href="#fnref:playlist" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2017/06/16/flawless/">Flawless</a></h1>
			
			<time datetime="2017-06-16" pubdate=""><a href="/weblog/2017/06/16/flawless/">June 16, 2017</a></time>
    	</header>
    	<div>
			<p>One of the great things about Twitter is the way it can connect you to other developers. For many years, I’ve been chatting with <a href="https://twitter.com/LisaDziuba">Lisa Dziuba</a> and she got in touch with me last year along with her colleague <a href="https://twitter.com/ahmed_sulajman">Ahmed Sulaiman</a> to tell me about a new app they were working on, <a href="https://flawlessapp.io">Flawless</a>, which has now officially launched.</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2017/flawless.jpg" width="800" height="450" /></p>

<p>Flawless is an absolute godsend for developers working on pixel perfect designs. It is a plugin for the iOS simulator that allows you to compare what is rendering on screen with a static image via various different modes and a slider for opacity. In this way, you can make sure that what you have built matches the image precisely. The app is a plugin for the simulator itself so you don’t need to add any extra code or frameworks to your project. It also works with static images<sup id="fnref:plugin"><a href="#fn:plugin" class="footnote">1</a></sup> so you don’t need to worry how your designs are provided be that by Sketch, Photoshop, or other<sup id="fnref:indesign"><a href="#fn:indesign" class="footnote">2</a></sup>.</p>

<p>I’ve been lucky enough to be both a beta tester and to be interviewed by Lisa and Ahmed about my workflows to help them tweak the app. If you are an app developer that has to work to a fixed design, you should definitely check it out. Flawless is <a href="https://gum.co/SyRKm">available for macOS</a> at the bargain price of $15<sup id="fnref:price"><a href="#fn:price" class="footnote">3</a></sup> and you can find out more (and get a free trial) on their website at <a href="https://flawlessapp.io">flawlessapp.io</a>.</p>

<div class="footnotes">
  <ol>
    <li id="fn:plugin">
      <p>I believe the original idea was to be integrated with Sketch but after they spoke with me and many other developers who don’t work exclusively with Sketch they decided to pivot to being an iOS simulator plugin instead. <a href="#fnref:plugin" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:indesign">
      <p>I have one client who provides me designs via InDesign and he is also the most likely to create a GitHub issue for a dividing line being 0.5px out of alignment - love ya Niki 👊 <a href="#fnref:indesign" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:price">
      <p>This has saved me so many subsequent bug follow ups that $15 is almost criminally low. <a href="#fnref:price" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2017/05/19/gbbc-2017/">Great British Bee Count 2017</a></h1>
			
			<time datetime="2017-05-19" pubdate=""><a href="/weblog/2017/05/19/gbbc-2017/">May 19, 2017</a></time>
    	</header>
    	<div>
			<p>For the past couple of years, I have worked with Two Thirds Water on the <a href="https://itunes.apple.com/gb/app/great-british-bee-count/id880987608?mt=8">Great British Bee Count</a> iOS app for Friends of the Earth. Today, an updated version of the app has gone live to support this years count which runs from 19th May until 30th June 2017:</p>

<p><img src="https://bendodson.s3.amazonaws.com/weblog/2017/gbbc-2017.jpg" width="800" height="500" /></p>

<p>The main update has been a completely new design which fits the more modern “flat” design which was made popular by iOS 7 whilst also putting the navigation within easy thumb reach even on plus-sized devices. There are also many new functionality changes such as an improved bee picker and fact files on each type of bee that can give you a lot more information.</p>

<p>As I also needed to migrate the app to Swift 3.1, I took the decision to completely rebuild the app from scratch<sup id="fnref:scratch"><a href="#fn:scratch" class="footnote">1</a></sup> so I could make use of some newer iOS features such as stack views and improved auto layout constraints. I also made improvements to the way in which content is stored on the device locally in a Realm database making the whole app feel even faster whilst increasing the reliability of sending count information in the background<sup id="fnref:background"><a href="#fn:background" class="footnote">2</a></sup>.</p>

<p>You can check out the <a href="https://itunes.apple.com/gb/app/great-british-bee-count/id880987608?mt=8">Great British Bee Count on the App Store</a> (it’s free) or <a href="http://www.foe.co.uk/page/join-great-british-bee-count-today">learn more about the bee cause</a>.</p>

<div class="footnotes">
  <ol>
    <li id="fn:scratch">
      <p>This was a decision the client was not made aware of and whilst it cost me more time (as I worked to a fixed budget) the end result is an app I can be really proud of. I’d much rather spend a bit more time and money from my own pocket to make something perfect than try and hack something together quickly especially if it is a full redesign of an existing app. Due to changes in the Swift language and a move away from separate xib files to storyboards, I was able to reduce the overall file size by 20% and the amount of code by 45%. <a href="#fnref:scratch" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:background">
      <p>For example, if you try and submit a count when you have no network connection, the app can automatically upload this information once connectivity is restored even if it is no longer in the foreground. <a href="#fnref:background" class="reversefootnote">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	
</section>


<section id="pagination">
     
    	<a href="/weblog/page/2/" title="Previous Page" class="pagination-previous">&laquo; Older Entries</a>
     
	
    
</section>

		
		<footer>
			<p>I perform all freelance work through my company <strong>Dodo Apps Ltd</strong> (07856552) registered at The Bristol Office, 2nd Floor, 5 High Street, Westbury on Trym, Bristol, England, BS9 3BY</p>
		</footer>

	</div>


</body>
</html>