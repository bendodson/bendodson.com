<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	

	


	<link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'>
	<link rel="alternate" type="application/rss+xml" title="Ben Dodson, iOS Developer" href="https://bendodson.com/rss.xml" />
	<link rel="stylesheet" href="/styles-2025-09-22.css" />
	<link rel="stylesheet" href="/highlight-2018-02-23.css" />
	<link rel="icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/favicon.ico">
	<link rel="apple-touch-icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone-retina.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<title>Ben Dodson's Blog &mdash; Freelance Swift and Apple Platforms Developer</title>
</head>
<body>

	<div id="wrapper">

		<header>
			<hgroup>
				<h1><a href="/">Ben Dodson</a></h1>
				<h2>Freelance iOS, macOS, Apple Watch, and Apple TV Developer</h2>
			</hgroup>
			<nav>
				<ul>
					<li><a href="/">Home</a></li><li><a href="/weblog/">Blog</a></li><li><a href="/about/">About</a></li><li><a href="/clients/">Portfolio</a></li><li><a href="/apps/">My Apps</a></li><li><a href="/projects/">Projects</a></li><li><a href="/contact/">Contact</a></li>
				</ul>
				<div class="divider"></div>
			</nav>
		</header>

		<section id="posts">

	
	<article>
		<header>
     		
				<h1><a href="/weblog/2024/08/20/hi-res-album-artwork-in-apple-shortcuts/">Getting Hi-Res Album Artwork in Apple Shortcuts</a></h1>
			
			<time datetime="2024-08-20" pubdate=""><a href="/weblog/2024/08/20/hi-res-album-artwork-in-apple-shortcuts/">August 20, 2024</a></time>
    	</header>
    	<div>
			<p>For over a decade, I’ve been providing a way to easily access high-resolution album artwork through my <a href="/projects/itunes-artwork-finder/">iTunes Artwork Finder</a> and <a href="/projects/apple-music-artwork-finder/">Apple Music Artwork Finder</a>. These tools allow you to uncover the original, uncompressed artwork files exactly as they were delivered to Apple by the artist or their label — no compression, no quality loss, just high quality imagery.</p>

<p>Over the years, I’ve received countless messages from users who loved these tools but wished for more; specifically, the ability to fetch multiple pieces of artwork at once or automate the process…</p>

<p>Today, I’m thrilled to announce an Apple Shortcut that lets you do just that, now available exclusively on <a href="https://bendodson.gumroad.com/l/apple-music-artwork-shortcut">Gumroad</a>.</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2024/fetching-artwork-with-apple-shortcuts.jpg" width="800" height="550" alt="Fetching album artwork with Apple Shortcuts" />
    <figure>Fetching album artwork with Apple Shortcuts</figure>
</div>

<p>With this new shortcut, all you need is an Apple Music URL. Feed it in, and you’ll get back a direct link to the highest resolution, uncompressed artwork available. I’ve also created a demo shortcut that shows you how to use this tool as part of a larger automation. Imagine easily inputting a URL and having the artwork automatically downloaded to your device. It’s that simple.</p>

<p>This shortcut isn’t just limited to album artwork. It works with playlists, stations, artists, music videos, and curators too. Essentially, if it’s on Apple Music, you can get the artwork.</p>

<p>I’m genuinely excited to see how people will use this shortcut. If there’s enough interest, I might expand this functionality to include my other artwork finders. If that’s something you’d like to see, <a href="/contact/">let me know</a>!</p>

<p><strong><a href="https://bendodson.gumroad.com/l/apple-music-artwork-shortcut">View now on Gumroad</a></strong></p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2024/04/03/using-your-personal-voice-in-an-ios-app/">Using your Personal Voice (along with system and novelty voices) in an iOS app</a></h1>
			
			<time datetime="2024-04-03" pubdate=""><a href="/weblog/2024/04/03/using-your-personal-voice-in-an-ios-app/">April 03, 2024</a></time>
    	</header>
    	<div>
			<p>Text to speech has been around on iOS for over a decade, but <a href="https://capitaloneshopping.com/s/apple.com/coupon">Apple</a> added a few new features in iOS 17 that could make interesting additions to your app. In this tutorial I’ll show you how to use <code class="language-plaintext highlighter-rouge">AVSpeechSynthesizer</code> to speak with the default system voices, the new “novelty” voices, and to even speak with the users own AI generated “Personal Voice”!</p>

<p>The motivation for this came about when a user of my <a href="https://dodoapps.io/chaise-longue-to-5k/">Chaise Longue to 5K app</a> asked me to add some sounds so they knew when to alternate between running and walking<sup id="fnref:chaise" role="doc-noteref"><a href="#fn:chaise" class="footnote" rel="footnote">1</a></sup>. Whilst browsing some royalty free sfx libraries it occurred to me that there isn’t really a good way to signal “start walking” or “start running”; A single blast of a whistle for walk and a double blast for run? Instead, I decided that it might be better to use the text to speech features as then I could literally say “walk for 1 minute and 30 seconds” or “run for 3 minutes”.</p>

<p>To do this is relatively straightforward:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">Speaker</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">shared</span> <span class="o">=</span> <span class="kt">Speaker</span><span class="p">()</span>
    
    <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">synthesizer</span><span class="p">:</span> <span class="kt">AVSpeechSynthesizer</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">synthesizer</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesizer</span><span class="p">()</span>
        <span class="n">synthesizer</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="k">return</span> <span class="n">synthesizer</span>
    <span class="p">}()</span>
    
    <span class="kd">func</span> <span class="nf">speak</span><span class="p">(</span><span class="n">_</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">utterance</span> <span class="o">=</span> <span class="kt">AVSpeechUtterance</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">string</span><span class="p">)</span>
        <span class="n">synthesizer</span><span class="o">.</span><span class="nf">speak</span><span class="p">(</span><span class="n">utterance</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Speaker</span><span class="p">:</span> <span class="kt">AVSpeechSynthesizerDelegate</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">speechSynthesizer</span><span class="p">(</span><span class="n">_</span> <span class="nv">synthesizer</span><span class="p">:</span> <span class="kt">AVSpeechSynthesizer</span><span class="p">,</span> <span class="n">willSpeakRangeOfSpeechString</span> <span class="nv">characterRange</span><span class="p">:</span> <span class="kt">NSRange</span><span class="p">,</span> <span class="nv">utterance</span><span class="p">:</span> <span class="kt">AVSpeechUtterance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span><span class="p">?</span> <span class="kt">AVAudioSession</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()</span><span class="o">.</span><span class="nf">setActive</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="k">try</span><span class="p">?</span> <span class="kt">AVAudioSession</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()</span><span class="o">.</span><span class="nf">setCategory</span><span class="p">(</span><span class="o">.</span><span class="n">playback</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">interruptSpokenAudioAndMixWithOthers</span><span class="p">)</span>
    <span class="p">}</span>
        
    <span class="kd">func</span> <span class="nf">speechSynthesizer</span><span class="p">(</span><span class="n">_</span> <span class="nv">synthesizer</span><span class="p">:</span> <span class="kt">AVSpeechSynthesizer</span><span class="p">,</span> <span class="n">didFinish</span> <span class="nv">utterance</span><span class="p">:</span> <span class="kt">AVSpeechUtterance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span><span class="p">?</span> <span class="kt">AVAudioSession</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()</span><span class="o">.</span><span class="nf">setActive</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">notifyOthersOnDeactivation</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The key components of this <code class="language-plaintext highlighter-rouge">Speaker</code> class I’ve created are the <code class="language-plaintext highlighter-rouge">AVSpeechSynthesizer</code> which we need to retain a reference to along with the <code class="language-plaintext highlighter-rouge">AVSpeechSynthesizerDelegate</code> which will allow us to change the <code class="language-plaintext highlighter-rouge">AVAudioSession</code> when speaking starts and finishes. In this case I’m using the <code class="language-plaintext highlighter-rouge">.interruptSpokenAudioAndMixWithOthers</code> category which will ensure our audio plays alongside music but will temporarily pause any spoken audio content such as podcasts or audio books.</p>

<p>To do the actual speaking, we just need to create an <code class="language-plaintext highlighter-rouge">AVSpeechUtterance</code> with our string and then pass that to the synthesizer using <code class="language-plaintext highlighter-rouge">speak()</code>. With that, we have a working text to audio system using the default system voice.</p>

<p>At our call site, it takes just a single line of code to get our device to speak:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// Singleton approach</span>
<span class="kt">Speaker</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">speak</span><span class="p">(</span><span class="s">"Hello, world!"</span><span class="p">)</span>

<span class="c1">// Using the object only within a specific controller</span>
<span class="k">let</span> <span class="nv">speaker</span> <span class="o">=</span> <span class="kt">Speaker</span><span class="p">()</span> <span class="c1">// make sure this is retained</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">speaker</span><span class="o">.</span><span class="nf">speak</span><span class="p">(</span><span class="s">"Hello, world!"</span><span class="p">)</span></code></pre></figure>

<h2 id="using-system-voices">Using System Voices</h2>

<p>Where things get more interesting is that we can allow the user to choose a specific voice to be used. You can fetch an array of <code class="language-plaintext highlighter-rouge">AVSpeechSynthesisVoice</code> by calling <code class="language-plaintext highlighter-rouge">AVSpeechSynthesisVoice.speechVoices()</code> and then use them directly with an utterance or by looking them up by their identifier:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// if you have a reference to your AVSpeechSynthesisVoice</span>
<span class="n">utterance</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="n">voice</span>

<span class="c1">// if you have only stored the identifier</span>
<span class="n">utterance</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="n">identifier</span><span class="p">)</span></code></pre></figure>

<p>Within Chaise Longue to 5K, I list all of the English voices in a UIMenu and <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2024/chaise-longue-voices.jpg">let the user pick one</a>. The identifier is then stored in <code class="language-plaintext highlighter-rouge">UserDefaults</code> and I use this identifier whenever I want the app to speak. Should a voice ever be unavailable (more on that shortly) then using an unknown identifier will cause the system to simply use the default voice. You can also use <code class="language-plaintext highlighter-rouge">AVSpeechSynthesisVoice.AVSpeechSynthesisVoiceIdentifierAlex</code> to get the identifier for the default “Alex” voice.</p>

<h2 id="locales">Locales</h2>

<p>When you fetch voices you’ll discover that there are a <em>lot</em> of them. In fact, there are over 150 preinstalled on iOS 17. This is because there are several default voices for most major languages. Due to this, you’ll likely want to filter out any that aren’t tuned to the language you are planning to speak or to the user’s own language. Apple provide a <code class="language-plaintext highlighter-rouge">AVSpeechSynthesisVoice.currentLanguageCode()</code> method to get the current BCP 47 code of the user’s locale as this differs to the identifier you may usually fetch via <code class="language-plaintext highlighter-rouge">Locale.current.identifier</code><sup id="fnref:bcp47" role="doc-noteref"><a href="#fn:bcp47" class="footnote" rel="footnote">2</a></sup>.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// getting only the voices available in the user's current locale</span>
<span class="k">let</span> <span class="nv">voices</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="o">.</span><span class="nf">speechVoices</span><span class="p">()</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span><span class="nv">$0</span><span class="o">.</span><span class="n">language</span> <span class="o">==</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="o">.</span><span class="nf">currentLanguageCode</span><span class="p">()})</span></code></pre></figure>

<h2 id="enhanced-and-premium-voices">Enhanced and Premium Voices</h2>

<p>With our voices filtered by locale, the next item of interest is the <code class="language-plaintext highlighter-rouge">quality</code> parameter which tells us whether our voice is default, enhanced, or premium. All of the preinstalled voices are <code class="language-plaintext highlighter-rouge">default</code> and it shows 😂. iOS 16 added the enhanced and premium voices but you have to manually download them as they are each over 100MB. To do this, you need to go to Accessibility &gt; Live Speech &gt; Voices<sup id="fnref:settings" role="doc-noteref"><a href="#fn:settings" class="footnote" rel="footnote">3</a></sup> within the Settings app. Here you can browse all of the voices and <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2024/additional-voices.jpg">download any additional ones</a> you may want. Once they are downloaded, you’ll be able to use them within your own app.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// only enhanced voices</span>
<span class="k">let</span> <span class="nv">voices</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="o">.</span><span class="nf">speechVoices</span><span class="p">()</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span><span class="nv">$0</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="o">.</span><span class="n">enhanced</span><span class="p">})</span>

<span class="c1">// only premium voices</span>
<span class="k">let</span> <span class="nv">voices</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="o">.</span><span class="nf">speechVoices</span><span class="p">()</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span><span class="nv">$0</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="o">.</span><span class="n">premium</span><span class="p">})</span></code></pre></figure>

<p>As these downloaded voices can be deleted by the user, it’s worth checking that the voice still exists if you’re letting a user choose a specific voice in your app (although, as mentioned earlier, it will fall back to the default voice if you provide a now invalid identifier).</p>

<h2 id="novelty-voices">Novelty Voices</h2>

<p>In iOS 17, Apple added a number of novelty voices to the system. These range from cellos that speak to the cadence of Edvard Grieg’s “In the Hall of the Mountain King”<sup id="fnref:seriously" role="doc-noteref"><a href="#fn:seriously" class="footnote" rel="footnote">4</a></sup> or alien voices in the form of Trinoids. There’s also a really creepy clown that just laughs as it talks. I don’t know why anybody would actually want to use these but if you do it’s as simple as filtering by the <code class="language-plaintext highlighter-rouge">isNoveltyVoice</code> trait:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// only novelty voices</span>
<span class="k">let</span> <span class="nv">voices</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="o">.</span><span class="nf">speechVoices</span><span class="p">()</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span><span class="nv">$0</span><span class="o">.</span><span class="n">voiceTraits</span> <span class="o">==</span> <span class="o">.</span><span class="n">isNoveltyVoice</span><span class="p">})</span>

<span class="c1">// only non-novelty voices</span>
<span class="k">let</span> <span class="nv">voices</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="o">.</span><span class="nf">speechVoices</span><span class="p">()</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span><span class="nv">$0</span><span class="o">.</span><span class="n">voiceTraits</span> <span class="o">!=</span> <span class="o">.</span><span class="n">isNoveltyVoice</span><span class="p">})</span></code></pre></figure>

<p>These are only available in en-US but it may be worth specifying this in case they get ported to other languages in a future update. Depending on your app, you may also want to filter <em>out</em> these voices from your UI.</p>

<h2 id="personal-voice">Personal Voice</h2>

<p>Personal Voice was announced in May 2023 in advance of it’s debut in iOS 17:</p>

<blockquote>
  <p>For users at risk of losing their ability to speak — such as those with a recent diagnosis of ALS (amyotrophic lateral sclerosis) or other conditions that can progressively impact speaking ability — Personal Voice is a simple and secure way to create a voice that sounds like them.</p>

  <p>Users can create a Personal Voice by reading along with a randomized set of text prompts to record 15 minutes of audio on iPhone or iPad. This speech accessibility feature uses on-device machine learning to keep users’ information private and secure, and integrates seamlessly with Live Speech so users can speak with their Personal Voice when connecting with loved ones.</p>

  <p>– <a href="https://www.apple.com/uk/newsroom/2023/05/apple-previews-live-speech-personal-voice-and-more-new-accessibility-features/">Apple Newsroom</a></p>
</blockquote>

<p>Essentially, Personal Voice is using on-device AI to create a private recreation of your voice. What I hadn’t realised at the time is that apps are able to use these user-created voices if the user allows it. What better motivation for my running app than having you speak to yourself!</p>

<p>To create a Personal Voice, you need to go to Settings &gt; Accessibility &gt; Personal Voice and then choose “Create a Personal Voice”. You’ll read out 150 text prompts (which takes around 15 minutes) at which point you’ll need to leave your device connected to power and in standby mode so it can do the necessary algorithm crunching to generate your soundalike. In my experience, this took around 3 hours on an iPhone 15 Pro Max.</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2024/personal-voice-setup.jpg" width="800" height="417" alt="Setting up Personal Voice on iOS 17" />
    <figure>Setting up Personal Voice on iOS 17</figure>
</div>

<p>Once completed, there is a crucial button you’ll need to enable if you want your voice to be available to other apps; the aptly named “Allow Apps to Request to Use”. This does not magically make your voice available to be used in other apps but allows apps to request the permission, otherwise any request is automatically denied. You can also choose for your voices to be synced across your devices although this currently only extends to iPhone, iPad, and Mac and as yet I’ve not managed to get it working correctly.</p>

<p>Now we have our voice, let’s look at how we can access it within an app:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// request permission</span>
<span class="kt">AVSpeechSynthesizer</span><span class="o">.</span><span class="n">requestPersonalVoiceAuthorization</span> <span class="p">{</span> <span class="n">status</span> <span class="k">in</span>
    <span class="c1">// check `status` to see if you're authorized and then refetch your voices</span>
<span class="p">}</span></code></pre></figure>

<p>As soon as the authorization is granted, personal voices will appear within <code class="language-plaintext highlighter-rouge">AVSpeechSynthesisVoice.speechVoices()</code> with the <code class="language-plaintext highlighter-rouge">isPersonalVoice</code> trait. This means you can filter voices to just Personal Voices very easily:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// fetch only personal voices</span>
<span class="k">let</span> <span class="nv">voices</span> <span class="o">=</span> <span class="kt">AVSpeechSynthesisVoice</span><span class="o">.</span><span class="nf">speechVoices</span><span class="p">()</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span><span class="nv">$0</span><span class="o">.</span><span class="n">voiceTraits</span> <span class="o">==</span> <span class="o">.</span><span class="n">isPersonalVoice</span><span class="p">})</span></code></pre></figure>

<p>The user can choose to remove authorization for your app at any point in the Personal Voice settings panel either by turning off the toggle for your app or by disabling the “Allow Apps to Request to Use” toggle. This is slightly confusing as if you disable requests your app may still be toggled on <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2024/this-will-not-work.jpg">making it seem like it would work</a>. Your app settings also do not contain any mention of Personal Voice, even when enabled, so you can’t link to <code class="language-plaintext highlighter-rouge">UIApplication.openSettingsURLString</code> to get the user to view these settings.</p>

<p>To further confuse things, Personal Voice only works on iPhone, iPad, and Mac and only on newer models. There is an <code class="language-plaintext highlighter-rouge">.unsupported</code> value for <code class="language-plaintext highlighter-rouge">PersonalVoiceAuthorizationStatus</code> but this is only used when running on the Simulator or using an unsupported platform such as tvOS, watchOS, or visionOS; it is not called when trying to run on an older device in a supported platform (i.e. a 2nd Gen 11” iPad Pro) with <code class="language-plaintext highlighter-rouge">.denied</code> being sent back instead. Do bear this in mind when crafting any alert text you may display to users when they are trying to authorize your app!</p>

<hr />

<p>I hope you enjoyed this tutorial. I’ll leave it to my Personal Voice<sup id="fnref:transcript" role="doc-noteref"><a href="#fn:transcript" class="footnote" rel="footnote">5</a></sup> to sign off…</p>

<audio controls="">
    <source src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2024/voice.mp3" type="audio/mpeg" />
</audio>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:chaise" role="doc-endnote">
      <p>The app was designed for Picture-in-Picture mode on an Apple TV so you could see when to run / walk whilst using other apps. I ported it to iPhone, iPad, and Mac with the same feature set but hadn’t added any sounds for those that want to run with their device in standby mode. <a href="#fnref:chaise" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:bcp47" role="doc-endnote">
      <p><code class="language-plaintext highlighter-rouge">Locale</code> will give you something like en_GB whereas the BCP 47 code is en-GB. iOS 17 did add a <code class="language-plaintext highlighter-rouge">Locale.IndentifierType</code> so you can call <code class="language-plaintext highlighter-rouge">Locale.current.identifier(.bcp47)</code> but this will match <code class="language-plaintext highlighter-rouge">AVSpeechSynthesisVoice.currentLanguageCode()</code> which has been around since iOS 7. <a href="#fnref:bcp47" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:settings" role="doc-endnote">
      <p>This is the same on macOS but on tvOS the only way to download extra voices is in Accessibility &gt; VoiceOver &gt; Voice <a href="#fnref:settings" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:seriously" role="doc-endnote">
      <p>Seriously. <a href="#fnref:seriously" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:transcript" role="doc-endnote">
      <p>Here’s a transcript in case you can’t listen to audio right now: “Hi, I’m Ben’s personal Voice. I hope you enjoyed this tutorial and have seen how easy it is to incorporate system voices, novelty voices, and even personal voices like this one into your apps. Personal voice will be available in an update for Chaise Longue to 5K very soon and I’m looking forward to seeing how you use them in your own apps in the future!” <a href="#fnref:transcript" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2023/07/26/tipkit-tutorial/">Adding teachable moments to your apps with TipKit</a></h1>
			
			<time datetime="2023-07-26" pubdate=""><a href="/weblog/2023/07/26/tipkit-tutorial/">July 26, 2023</a></time>
    	</header>
    	<div>
			<p>When TipKit was first mentioned during the WWDC 2023 State of the Union, I assumed it was going to be a way for apps to appear within the Tips app and maybe appear within Spotlight. Instead, it’s a built-in component for adding small tutorial views to your own app across all platforms complete with a rules system for condition-based display and syncing across multiple devices via iCloud! Even better, it’s something Apple are using themselves throughout iOS 17 such as in the Messages and Photos apps.</p>

<p>Having built a fair few popover onboarding systems in the past, this was quickly my most anticipated feature from WWDC 2023. I was slightly disappointed then when Xcode beta after Xcode beta was missing the TipKit framework. Fortunately, Xcode 15 beta 5 (released last night) now includes the relevant framework and <a href="https://developer.apple.com/documentation/tipkit">documentation</a> allowing me to integrate tips into my own apps.</p>

<p>Before I demonstrate how TipKit works and how you can incorporate it into your own apps, here is a really key piece of advice from Ellie Gattozzi in the “<a href="https://developer.apple.com/wwdc23/10229">Make features discoverable with TipKit</a>” talk from WWDC 2023:</p>

<blockquote>
  <p><em>Useful tips have direct action phrases as titles that say what the feature is and messages with easy to remember benefit info or instructions so users know why they’d want to use the feature and are later able to accomplish the task on their own.</em></p>
</blockquote>

<p>With that said, let’s create our first tip!</p>

<p><em>Note: I’ve included code for both SwiftUI and UIKit below but Apple also provided a way to display tips in AppKit. It should be noted that the UIKit versions are not available on watchOS or tvOS. It’s also worth noting that there are a few bugs in the TipKit framework in beta 5, particularly around actions which I’ve documented below.</em></p>

<h2 id="1-creating-a-tip">1. Creating a Tip</h2>

<p>First we need to initiate the Tips system when our app launches using <code class="language-plaintext highlighter-rouge">Tips.configure()</code><sup id="fnref:tipsconfigure" role="doc-noteref"><a href="#fn:tipsconfigure" class="footnote" rel="footnote">1</a></sup>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// SwiftUI</span>
<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Scene</span> <span class="p">{</span>
    <span class="kt">WindowGroup</span> <span class="p">{</span>
        <span class="kt">ContentView</span><span class="p">()</span>
        <span class="o">.</span><span class="n">task</span> <span class="p">{</span>
            <span class="k">try</span><span class="p">?</span> <span class="n">await</span> <span class="kt">Tips</span><span class="o">.</span><span class="nf">configure</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// UIKit</span>
<span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">LaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="kt">Task</span> <span class="p">{</span>
        <span class="k">try</span><span class="p">?</span> <span class="n">await</span> <span class="kt">Tips</span><span class="o">.</span><span class="nf">configure</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span></code></pre></figure>

<p>Next, we create the struct that defines our tip:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">SearchTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">Text</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"Add a new game"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">Text</span><span class="p">?</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"Search for new games to play via IGDB."</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">asset</span><span class="p">:</span> <span class="kt">Image</span><span class="p">?</span> <span class="p">{</span>
        <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"magnifyingglass"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Finally, we display our tip:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// SwiftUI</span>
<span class="kt">ExampleView</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">toolbar</span><span class="p">(</span><span class="nv">content</span><span class="p">:</span> <span class="p">{</span>
        <span class="kt">ToolbarItem</span><span class="p">(</span><span class="nv">placement</span><span class="p">:</span> <span class="o">.</span><span class="n">primaryAction</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">Button</span> <span class="p">{</span>
                <span class="n">displayingSearch</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="p">}</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"magnifyingglass"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">popoverTip</span><span class="p">(</span><span class="kt">SearchTip</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">})</span>


<span class="c1">// UIKit</span>
<span class="kd">class</span> <span class="kt">ExampleViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">searchButton</span><span class="p">:</span> <span class="kt">UIButton</span>
    <span class="k">var</span> <span class="nv">searchTip</span> <span class="o">=</span> <span class="kt">SearchTip</span><span class="p">()</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">_</span> <span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
        <span class="kt">Task</span> <span class="p">{</span> <span class="kd">@MainActor</span> <span class="k">in</span>
            <span class="k">for</span> <span class="n">await</span> <span class="n">shouldDisplay</span> <span class="k">in</span> <span class="n">searchTip</span><span class="o">.</span><span class="n">shouldDisplayUpdates</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">shouldDisplay</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">controller</span> <span class="o">=</span> <span class="kt">TipUIPopoverViewController</span><span class="p">(</span><span class="n">searchTip</span><span class="p">,</span> <span class="nv">sourceItem</span><span class="p">:</span> <span class="n">searchButton</span><span class="p">)</span>
                    <span class="nf">present</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">presentedViewController</span> <span class="k">is</span> <span class="kt">TipUIPopoverViewController</span> <span class="p">{</span>
                    <span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This code is all that is required to display our provided tip the first time the view appears:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/popover-tip-tipkit.jpg" width="800" height="450" alt="A popover tip using TipKit" />
    <figure>A popover tip using TipKit</figure>
</div>

<p>There are two kinds of tip views:</p>

<ul>
  <li>Popover: appears as an overlay on the app’s UI which lets you direct users without changing the view</li>
  <li>In-line: temporarily adjusts the app’s UI around it so nothing is covered (this is not available on tvOS)</li>
</ul>

<p>If we wanted to display an in-line tip instead, our code would look like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// SwiftUI</span>
<span class="kt">VStack</span> <span class="p">{</span>
    <span class="kt">TipView</span><span class="p">(</span><span class="kt">LongPressTip</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// UIKit</span>
<span class="kd">class</span> <span class="kt">ExampleViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">longPressGameTip</span> <span class="o">=</span> <span class="kt">LongPressGameTip</span><span class="p">()</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">_</span> <span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
        <span class="kt">Task</span> <span class="p">{</span> <span class="kd">@MainActor</span> <span class="k">in</span>
            <span class="k">for</span> <span class="n">await</span> <span class="n">shouldDisplay</span> <span class="k">in</span> <span class="n">longPressGameTip</span><span class="o">.</span><span class="n">shouldDisplayUpdates</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">shouldDisplay</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">tipView</span> <span class="o">=</span> <span class="kt">TipUIView</span><span class="p">(</span><span class="n">longPressGameTip</span><span class="p">)</span>
                    <span class="n">view</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">tipView</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">tipView</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">subviews</span><span class="o">.</span><span class="nf">first</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="k">is</span> <span class="kt">TipUIView</span> <span class="p">})</span> <span class="p">{</span>
                    <span class="n">tipView</span><span class="o">.</span><span class="nf">removeFromSuperview</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/inline-tip-tipkit.jpg" width="800" height="450" alt="An in-line tip using TipKit" />
    <figure>An in-line tip using TipKit</figure>
</div>

<p>UIKit also has a <a href="https://developer.apple.com/documentation/tipkit/tipuicollectionviewcell"><code class="language-plaintext highlighter-rouge">TipUICollectionViewCell</code></a> for displaying tips within a collection view which should be the route used for table-based interfaces as well. The SwiftUI code is definitely less verbose 🤣</p>

<h2 id="2-making-your-tips-look-tip-top-">2. Making your tips look tip-top 🎩</h2>

<p>You can customise your tips with changes to text colour and fonts along with background colour, corner radius, and icons. The tip views are also fully compatible with dark mode.</p>

<h3 id="fonts-and-text-colour">Fonts and text colour</h3>

<p>These are customised within the Tip structs themselves as you are returning instances of <code class="language-plaintext highlighter-rouge">SwiftUI.Text</code> even if you are ultimately rendering your tip in UIKit or AppKit.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">LongPressTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">Text</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"Add to list"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">foregroundStyle</span><span class="p">(</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">fontDesign</span><span class="p">(</span><span class="o">.</span><span class="n">serif</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">bold</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">Text</span><span class="p">?</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"Long press on a game to add it to a list."</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">foregroundStyle</span><span class="p">(</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">fontDesign</span><span class="p">(</span><span class="o">.</span><span class="n">monospaced</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">asset</span><span class="p">:</span> <span class="kt">Image</span><span class="p">?</span> <span class="p">{</span>
        <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"hand.point.up.left"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>As the title and message both use <code class="language-plaintext highlighter-rouge">Text</code>, you can use any modifiers that return a Text instance such as <code class="language-plaintext highlighter-rouge">foregroundStyle</code>, <code class="language-plaintext highlighter-rouge">font</code>, and convenience methods like <code class="language-plaintext highlighter-rouge">bold()</code>. The icon is returned as an <code class="language-plaintext highlighter-rouge">Image</code> so if we want to change anything like the icon colour we have to do this from the Tip view itself:</p>

<h3 id="icon-colour-background-colour-and-dismiss-button-colour">Icon colour, background colour, and dismiss button colour</h3>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// SwiftUI</span>
<span class="kt">TipView</span><span class="p">(</span><span class="kt">LongPressGameTip</span><span class="p">())</span>
    <span class="o">.</span><span class="nf">tipBackground</span><span class="p">(</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">tint</span><span class="p">(</span><span class="o">.</span><span class="n">yellow</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">foregroundStyle</span><span class="p">(</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>

<span class="c1">// UIKit</span>
<span class="k">let</span> <span class="nv">tipView</span> <span class="o">=</span> <span class="kt">TipUIView</span><span class="p">(</span><span class="kt">LongPressGameTip</span><span class="p">())</span>
<span class="n">tipView</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">black</span>
<span class="n">tipView</span><span class="o">.</span><span class="n">tintColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">yellow</span></code></pre></figure>

<p>A method is provided to change the colour of the tip background itself but to change the icon colour we need to use a global tint whilst the dismiss button colour is affected by the <code class="language-plaintext highlighter-rouge">foregroundStyle</code>; note that this button appears to be 50% opaque so if you are using a dark background you’ll struggle to see anything other than white. There does not appear to be a way to alter this button with UIKit.</p>

<p>Whilst there are no Human Interface Guidelines for tips yet, looking through the iOS 17 beta and the <a href="https://developer.apple.com/wwdc23/10229">WWDC 2023 talk</a> shows that Apple uses un-filled SF Symbols for all of their tips. For this reason, I’d suggest doing the same!</p>

<h3 id="corner-radius">Corner Radius</h3>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// SwiftUI</span>
<span class="kt">TipView</span><span class="p">(</span><span class="kt">LongPressGameTip</span><span class="p">())</span>
    <span class="o">.</span><span class="nf">tipCornerRadius</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span></code></pre></figure>

<p>The default corner radius for tips on iOS is 13. If you want to change this to match other curved elements within your app, you can do this with <code class="language-plaintext highlighter-rouge">tipCornerRadius()</code> in SwiftUI. UIKit does not have a way to change the corner radius of tip views.</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/customised-tip-tipkit.jpg" width="600" height="190" alt="A customised tip view with new colours and fonts" />
    <figure>A customised tip view with new colours and fonts. I know it's not pretty!</figure>
</div>

<p>I was pleasantly surprised by how flexible the design was for this first version of TipKit. However, I’d urge caution in customising tips too far as having them match the default system tips is surely a boon in terms of user experience.</p>

<h2 id="3-lights-cameras-actions">3. Lights, Cameras, Actions!</h2>

<p>Tips allow you to add multiple buttons known as actions which can be used to take users to a relevant setting or a more in-depth tutorial. This feature is not available on tvOS.</p>

<p>To add an action, you first need to adjust your Tip struct with some identifying details:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// SwiftUI</span>
<span class="kd">struct</span> <span class="kt">LongPressGameTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    
    <span class="c1">// [...] title, message, asset</span>
    
    <span class="k">var</span> <span class="nv">actions</span><span class="p">:</span> <span class="p">[</span><span class="kt">Action</span><span class="p">]</span> <span class="p">{</span>
        <span class="p">[</span><span class="kt">Action</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"learn-more"</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"Learn More"</span><span class="p">)]</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Note that the <code class="language-plaintext highlighter-rouge">Action</code> initialiser also has an option to use a <code class="language-plaintext highlighter-rouge">Text</code> block rather than a <code class="language-plaintext highlighter-rouge">String</code> which allows for all of the colour and font customisations mentioned earlier.</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/action-tip-tipkit.jpg" width="800" height="450" alt="An action button within a Tip View" />
    <figure>An action button within a Tip View</figure>
</div>

<p>With this in place, we can alter our tip view to perform an action once the button has been pressed:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// SwiftUI</span>
<span class="kt">Button</span> <span class="p">{</span>
    <span class="n">displayingSearch</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
    <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"magnifyingglass"</span><span class="p">)</span>
<span class="p">}</span>
    <span class="o">.</span><span class="nf">popoverTip</span><span class="p">(</span><span class="kt">LongPressGameTip</span><span class="p">())</span> <span class="p">{</span> <span class="n">action</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">action</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s">"learn-more"</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="n">displayingLearnMore</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>

<span class="c1">// UIKit</span>
<span class="k">let</span> <span class="nv">tipView</span> <span class="o">=</span> <span class="kt">TipUIView</span><span class="p">(</span><span class="kt">LongPressGameTip</span><span class="p">())</span> <span class="p">{</span> <span class="n">action</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="n">action</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s">"learn-more"</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="k">let</span> <span class="nv">controller</span> <span class="o">=</span> <span class="kt">TutorialViewController</span><span class="p">()</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>Alternatively, we can add action handlers directly to the Tip struct:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">var</span> <span class="nv">actions</span><span class="p">:</span> <span class="p">[</span><span class="kt">Action</span><span class="p">]</span> <span class="p">{</span>
    <span class="p">[</span><span class="kt">Action</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"learn-more"</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"Learn More"</span><span class="p">,</span> <span class="nv">perform</span><span class="p">:</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"'Learn More' pressed"</span><span class="p">)</span>
    <span class="p">})]</span>
<span class="p">}</span></code></pre></figure>

<p><strong>Important:</strong> Whilst you can add actions in Xcode 15 beta 5, the handlers do not currently trigger when pressing the button regardless of whether you use the struct or view method to attach them.</p>

<p>One final thing to note on actions is that they can be disabled if you wish to grey them out for some reason (i.e. if a user isn’t signed in or subscribed to a premium feature):</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">var</span> <span class="nv">actions</span><span class="p">:</span> <span class="p">[</span><span class="kt">Action</span><span class="p">]</span> <span class="p">{</span>
    <span class="p">[</span><span class="kt">Action</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"pro-feature"</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"Add a new list"</span><span class="p">,</span> <span class="nv">disabled</span><span class="p">:</span> <span class="kc">true</span><span class="p">)]</span>
<span class="p">}</span></code></pre></figure>

<h2 id="4-laying-down-the-rules">4. Laying down the rules</h2>

<p>By default, tips appear as soon as the view they are attached to appears on screen. However, you may not want to show a tip in a certain view until some condition has been met (i.e. the user is logged in) or you may want a user to have to interact with a feature a certain number of times before the tip is displayed. Luckily Apple has thought of this and added a concept known as “rules” to let you limit when tips will appear.</p>

<p>There are two types of rules:</p>

<ul>
  <li>Parameter-based: These are persistent and are matched to Swift value types such as booleans</li>
  <li>Event-based: Defines an action that must be performed before a tip is eligible for display</li>
</ul>

<p><strong>Important</strong>: In Xcode 15 beta 5 there is a bug which will prevent the <code class="language-plaintext highlighter-rouge">@Parameter</code> macro from compiling for simulators or for macOS apps. The workaround is to add the following to the “Other Swift Flags” build setting:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nt">-external-plugin-path</span> <span class="si">$(</span>SYSTEM_DEVELOPER_DIR<span class="si">)</span>/Platforms/iPhoneOS.platform/Developer/usr/lib/swift/host/plugins#<span class="si">$(</span>SYSTEM_DEVELOPER_DIR<span class="si">)</span>/Platforms/iPhoneOS.platform/Developer/usr/bin/swift-plugin-server</code></pre></figure>

<h3 id="parameter-based-rules">Parameter-based Rules</h3>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">LongPressGameTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    
    <span class="kd">@Parameter</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">isLoggedIn</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>
    
    <span class="k">var</span> <span class="nv">rules</span><span class="p">:</span> <span class="p">[</span><span class="kt">Rule</span><span class="p">]</span> <span class="p">{</span>
        <span class="cp">#Rule(Self.$isLoggedIn) { $0 == true }</span>
    <span class="p">}</span>
    
    <span class="c1">// [...] title, message, asset, actions, etc.</span>
    
<span class="p">}</span></code></pre></figure>

<p>The syntax is relativelty straightforward thanks to the new Macro support in Xcode 15. We first define a static variable for the condition, in this case a boolean detailing if the user is logged in or not. Next we provide a rule based on that condition being true.</p>

<p>If we ran our app now, the tip would no longer be displayed on launch. However, once we mark the static property as true the tip will show up the next time the relevant view is displayed:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kt">LongPressGameTip</span><span class="o">.</span><span class="n">isLoggedIn</span> <span class="o">=</span> <span class="kc">true</span></code></pre></figure>

<h3 id="event-based-rules">Event-based Rules</h3>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">LongPressGameTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">appOpenedCount</span> <span class="o">=</span> <span class="kt">Event</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"appOpenedCount"</span><span class="p">)</span>
        
    <span class="k">var</span> <span class="nv">rules</span><span class="p">:</span> <span class="p">[</span><span class="kt">Rule</span><span class="p">]</span> <span class="p">{</span>
        <span class="cp">#Rule(Self.appOpenedCount) { $0.donations.count &gt;= 3 }</span>
    <span class="p">}</span>
    
    <span class="c1">// [...] title, message, asset, actions, etc.</span>
    
<span class="p">}</span></code></pre></figure>

<p>The event-based rules are slightly different in that instead of a parameter we use an <code class="language-plaintext highlighter-rouge">Event</code> object with an identifier of our choosing. The rule then checks the <code class="language-plaintext highlighter-rouge">donations</code> property of this event to determine if the app has been opened three or more times. In order for this to work, we need to be able to “donate” when this event has occured. We do this by using the <code class="language-plaintext highlighter-rouge">donate</code> method on the event itself:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kt">SomeView</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">onAppear</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">LongPressTip</span><span class="o">.</span><span class="n">appOpenedCount</span><span class="o">.</span><span class="nf">donate</span><span class="p">()</span>
    <span class="p">}</span></code></pre></figure>

<p>The donation on an event contains a date property that is set to the time at which the event was donated. This means you can add rules to check if somebody has opened the app three times or more today:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">LongPressGameTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">appOpenedCount</span><span class="p">:</span> <span class="kt">Event</span> <span class="o">=</span> <span class="kt">Event</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="s">"appOpenedCount"</span><span class="p">)</span>
        
    <span class="k">var</span> <span class="nv">rules</span><span class="p">:</span> <span class="p">[</span><span class="kt">Rule</span><span class="p">]</span> <span class="p">{</span>
        <span class="cp">#Rule(Self.appOpenedCount) {</span>
            <span class="nv">$0</span><span class="o">.</span><span class="n">donations</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span>
                <span class="kt">Calendar</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="nf">isDateInToday</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// [...] title, message, asset, actions, etc.</span>
    
<span class="p">}</span></code></pre></figure>

<p><strong>Important</strong>: Whilst this code should be possible according to the WWDC 2023 talk, it gives a “the filter function is not supported in this rule” when run on Xcode 15 beta 5.</p>

<h2 id="5-to-display-or-not-to-display">5. To display, or not to display?</h2>

<p>Whilst rules can limit our tips to displaying at the optimal time, there is always the possibility that multiple tips might try to display at the <em>same</em> time. It may also be that we no longer want to display a tip if the user interacts with our feature before our tip was displayed. To get around this, Apple provides us with ways to manage frequency, display count, and to invalidate tips. They also provide a mechanism for syncing the display status of your tips across multiple devices.</p>

<h3 id="frequency">Frequency</h3>

<p>By default, tips appear as soon as they are allowed to. We can change this by setting a <code class="language-plaintext highlighter-rouge">DisplayFrequency</code> when initiating our Tips store on app launch:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">try</span><span class="p">?</span> <span class="n">await</span> <span class="kt">Tips</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="p">{</span>
    <span class="kt">DisplayFrequency</span><span class="p">(</span><span class="o">.</span><span class="n">daily</span><span class="p">)</span>
<span class="p">})</span></code></pre></figure>

<p>With this in place, only one tip will be able to appear each day.</p>

<p>There are several predefined values for <code class="language-plaintext highlighter-rouge">DisplayFrequency</code> such as <code class="language-plaintext highlighter-rouge">.daily</code> and <code class="language-plaintext highlighter-rouge">.hourly</code> but you can also provide a <code class="language-plaintext highlighter-rouge">TimeInterval</code> if you need something custom. Alternatively, you can restore the default behaviour by using <code class="language-plaintext highlighter-rouge">.immediate</code>.</p>

<p>If you have set a non-immediate display frequency but have a tip that you want to display immediately, you can do so by using the <code class="language-plaintext highlighter-rouge">IgnoresDisplayFrequency()</code> option on the Tip struct:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">LongPressGameTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">TipOption</span><span class="p">]</span> <span class="p">{</span>
        <span class="p">[</span><span class="kt">Tip</span><span class="o">.</span><span class="kt">IgnoresDisplayFrequency</span><span class="p">(</span><span class="kc">true</span><span class="p">)]</span>
    <span class="p">}</span>
    
    <span class="c1">// [...] title, message, asset, actions, etc.</span>
    
<span class="p">}</span></code></pre></figure>

<h3 id="display-count">Display Count</h3>

<p>If a tip is not manually dismissed by the user then it will be reshown the next time the relevant view appears even after app launches. To avoid a tip being shown repeatedly to a user, you can set a <code class="language-plaintext highlighter-rouge">MaxDisplayCount</code> which will limit the number of appearances until the tip is no longer displayed:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">LongPressGameTip</span><span class="p">:</span> <span class="kt">Tip</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">TipOption</span><span class="p">]</span> <span class="p">{</span>
        <span class="p">[</span><span class="kt">Tip</span><span class="o">.</span><span class="kt">MaxDisplayCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="p">}</span>
    
    <span class="c1">// [...] title, message, asset, actions, etc.</span>
    
<span class="p">}</span></code></pre></figure>

<h3 id="invalidation">Invalidation</h3>

<p>Depending on our rules and display frequency, it may be that a user interacts with a feature before our tip has been displayed. In this case, we would want to invalidate our tip so that it is not displayed at a later date:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="n">longPressGameTip</span><span class="o">.</span><span class="nf">invalidate</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="o">.</span><span class="n">userPerformedAction</span><span class="p">)</span></code></pre></figure>

<p>There are three possible reasons for a tip to be invalidated:</p>

<ul>
  <li>maxDisplayCountExceeded</li>
  <li>userClosedTip</li>
  <li>userPerformedAction</li>
</ul>

<p>The first two are performed by the system depending on whether the display count or the user caused the tip to be dismissed. This means you will always want to use <code class="language-plaintext highlighter-rouge">.userPerformedAction</code> when invalidating your tips.</p>

<h3 id="icloud-sync">iCloud Sync</h3>

<p>During the “<a href="https://developer.apple.com/wwdc23/10229">Make features discoverable with TipKit</a>”, Charlie Parks mentions:</p>

<blockquote>
  <p>TipKit can also sync tip status via iCloud to ensure that tips seen on one device won’t be seen on the other. For instance, if someone using the app has it installed on both an iPad and an iPhone, and the features are identical on both of those devices, it’s probably best to not educate them on both devices about the feature.</p>
</blockquote>

<p>This feature appears to be enabled by default with no options for disabling it meaning you’ll need to provide custom identiers for each tip on the platforms you support if you want to make sure tips are re-displayed on every device for some reason (i.e. if the UI is significantly different between devices).</p>

<h2 id="6-debugging">6. Debugging</h2>

<p>TipKit provides convenient APIs for testing, allowing you to show or hide tips as needed, inspect all the tips without satisfying their rules, or purge all info in the TipKit data store for a pristine app build state.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// Show all defined tips in the app</span>
<span class="kt">Tips</span><span class="o">.</span><span class="nf">showAllTips</span><span class="p">()</span>

<span class="c1">// Show the specified tips</span>
<span class="kt">Tips</span><span class="o">.</span><span class="nf">showTips</span><span class="p">([</span><span class="n">searchTip</span><span class="p">,</span> <span class="n">longPressGameTip</span><span class="p">])</span>

<span class="c1">// Hide the specified tips</span>
<span class="kt">Tips</span><span class="o">.</span><span class="nf">hideTips</span><span class="p">([</span><span class="n">searchTip</span><span class="p">,</span> <span class="n">longPressGameTip</span><span class="p">])</span>

<span class="c1">// Hide all tips defined in the app</span>
<span class="kt">Tips</span><span class="o">.</span><span class="nf">hideAllTips</span><span class="p">()</span></code></pre></figure>

<p>If we want to purge all TipKit related data, we need to use the <code class="language-plaintext highlighter-rouge">DatastoreLocation</code> modifier when initialising the Tips framework on app launch:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">try</span><span class="p">?</span> <span class="n">await</span> <span class="kt">Tips</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="p">{</span>
    <span class="kt">DatastoreLocation</span><span class="p">(</span><span class="o">.</span><span class="n">applicationDefault</span><span class="p">,</span> <span class="nv">shouldReset</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">})</span></code></pre></figure>

<h2 id="conclusion">Conclusion</h2>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/tvos-tip-tipkit.jpg" width="800" height="450" alt="A tip displayed on tvOS" />
    <figure>A tip displayed in my "Chaise Longue to 5K" tvOS app</figure>
</div>

<p>Tips are instrumental in helping users discover features in your app be it on iOS, iPadOS, macOS, watchOS, or tvOS. Remember to keep your tips short, instructional, and actionable, and make use of the rules system, display frequency, and invalidation to ensure tips are only shown when they need to be.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:tipsconfigure" role="doc-endnote">
      <p>Note that this differs from the <code class="language-plaintext highlighter-rouge">TipsCenter.shared.configure()</code> that was previewed in the WWDC 2023 talk “<a href="https://developer.apple.com/wwdc23/10229">Make features discoverable with TipKit</a>”. <a href="#fnref:tipsconfigure" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2023/05/10/connecting-a-tvos-app-to-ios-ipados-and-watchos-with-devicediscoveryui/">Attempting to connect a tvOS app to an iOS app with DeviceDiscoveryUI</a></h1>
			
			<time datetime="2023-05-10" pubdate=""><a href="/weblog/2023/05/10/connecting-a-tvos-app-to-ios-ipados-and-watchos-with-devicediscoveryui/">May 10, 2023</a></time>
    	</header>
    	<div>
			<p>As we get to the final month before WWDC 2023, I’m reminded of all the new APIs that were released at WWDC 2022 that I haven’t made use of yet. One of those new APIs was the <a href="https://developer.apple.com/documentation/devicediscoveryui">DeviceDiscoveryUI framework</a> which allows an Apple TV app to connect and communicate with an iPhone, iPad, or Apple Watch.</p>

<p>A good example of this would be how the Apple Watch communicates with the Apple Fitness app:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/Apple-Fitness-Plus-HIIT-workout-lifestyle-220907.jpg" width="800" height="450" />
    <figure><a href="https://www.apple.com/uk/newsroom/2022/09/apple-fitness-plus-available-to-all-iphone-users-in-21-countries-later-this-fall/">Image &copy; 2022 Apple</a></figure>
</div>

<p>It’s not necessarily a fair comparison as whilst you might expect them to be the same, the DeviceDiscoveryUI framework has a number of restrictions:</p>

<ul>
  <li>It only works on tvOS (so you can’t communicate between an Apple Watch and an iPad like Apple Fitness can)</li>
  <li>It only works on Apple TV 4K (Apple Fitness can work with Apple TV HD)</li>
  <li>The tvOS app can only connect to one device at a time (i.e. you couldn’t make a game with this that used two iPhones as controllers)</li>
  <li>The tvOS app can only connect to other versions of your app that share the same bundle identifier (and are thus sold with Universal Purchase)</li>
  <li>This will not work on either the tvOS or iOS simulators. You must use physical devices.</li>
</ul>

<p>The UI for the connection setup is also different to Apple Fitness as we will see shortly.</p>

<p>My use case for this technology is a bit convoluted as I was really looking for an excuse to use it rather than the best fit. I have a personal app named <em><a href="https://bendodson.com/weblog/2021/03/10/stoutness/">Stoutness</a></em> that I use on my Apple TV every morning to give me a briefing on my day whilst I do my chiropractic stretches. Using shortcuts and various apps on my iPhone, I send a ton of data to my server which the Apple TV app then fetches and uses. The app also communicates directly with some 3rd party APIs such as YouTube and Pocket.</p>

<p>One of the main reasons for the app is to get me to work through my backlogs of games, books, videos, and articles by having the app randomly pick from my various lists and presenting them to me; I then know “out of the 4 books I’m currently reading, I should read <em>x</em> today”. The problem is that later in the day I often forget what the app had decided I should use, a particular problem when it suggests 5 articles for me to read from a backlog of about 200 😬. Whilst I cache this information daily in the Apple TV app, it’s a bit of a pain to fire it up just to skip through a few screens and remember what I should be reading. Surely this information would be better on my phone?</p>

<p>The obvious way to do this would be for the server to make the calls to Pocket and YouTube and then store the daily cache in my database along with the random choices of games and books. An iOS app could then download that in the same way the tvOS app does. This is true, but it’s not as fun as learning a new framework and having my phone connect to the Apple TV to a) send all the data that my shortcuts used to do directly and b) have the cache be sent back in response ready to be used on iOS.</p>

<p>After a brief look at the docs, I naively assumed this would be done in an hour as it looked vaguely similar to the way in which an iPhone app can talk to an embedded Apple Watch app or a Safari extension via two way messaging. After 4 hours, I finally got something working but it does not feel as solid as I would like…</p>

<p>Apple provide a developer article titled “<a href="https://developer.apple.com/documentation/devicediscoveryui/connecting_a_tvos_app_to_other_devices_over_the_local_network?changes=late__6__8">Connecting a tvOS app to other devices over the local network</a>” that sounds like it should be exactly what we need. It details how we present the connection UI (in both SwiftUI and UIKit), how to listen for the connection on iOS / iPadOS / watchOS, and how to initiate the connection. However, there are two issues with this article.</p>

<p>First of all, most of the code in it doesn’t actually compile or is being used incorrectly. The SwiftUI code references a “device name” variable which isn’t present<sup id="fnref:devicename" role="doc-noteref"><a href="#fn:devicename" class="footnote" rel="footnote">1</a></sup>, fails to include the required “fallback” view block (for displaying on unsupported devices like the Apple TV HD), and presents the device picker behind a connect button failing to notice that the picker itself has it’s own connect button which sits transparently above the one you just pressed.</p>

<p><img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/DevicePicker-SwiftUI-Overlay.gif" width="800" height="450" /></p>

<p>For the UIKit code, it references an <code class="language-plaintext highlighter-rouge">NWEndpointPickerViewController</code> which doesn’t exist. The correct name is <a href="https://developer.apple.com/documentation/devicediscoveryui/dddevicepickerviewcontroller"><code class="language-plaintext highlighter-rouge">DDDevicePickerViewController</code></a>.</p>

<p>Once the actual picker is presented, things start to look very promising. You get a fullscreen view that shows your app icon with a privacy string that you define within Info.plist on the left hand side whilst any applicable devices are listed on the right hand side:</p>

<p><img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/DeviceDiscoveryUI-tvOS.jpg" width="800" height="450" /></p>

<p>An important thing to note here is that the devices do not necessarily have your app installed, they are merely devices <em>potentially capable</em> of running your app.</p>

<p>When we initiate a connection to an iPhone, a notification is displayed. The wording can’t be controlled and will be different depending on whether the corresponding app is installed or not:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/DevicePicker-Notifications-iOS.jpg" width="800" height="200" />
    <figure>Connection notification request for iOS from tvOS both with and without the app installed. If the app is installed, the notification uses the Apple TV name for the title (“Office” in this case).</figure>
</div>

<p>You seem to have around 30 seconds to accept the connection otherwise the tvOS interface goes back a step and you need to send a new request. If you do not have the app installed, tapping the notification will take you to the App Store page.</p>

<p>We now come to the second problem in Apple’s documentation:</p>

<blockquote>
  <p>As soon as the user selects a device, the system passes you an <code class="language-plaintext highlighter-rouge">NWEndpoint</code>. Use this endpoint to connect to the selected device. Create an <code class="language-plaintext highlighter-rouge">NWConnection</code>, passing it both the endpoint and the parameters that you used to create the device picker view. <strong>You can then use this connection to send or receive messages to the connected device.</strong></p>
</blockquote>

<p>The emphasis above is mine. This is the extent of the documentation on how to actually use the connection to send and receive messages. It turns out that the connection uses classes from the <a href="https://developer.apple.com/documentation/networkextension/hotspot_helper/in-provider_networking?changes=late__6__8">In-Provider Networking</a> that was introduced in iOS 9 specifically for network extensions. In fact, this is still the case according to the documentation:</p>

<blockquote>
  <p>These APIs have the following key characteristics:</p>

  <ul>
    <li>They aren’t general-purpose APIs; they can only be used in the context of a NetworkExtension provider or hotspot helper.</li>
  </ul>
</blockquote>

<p>There is zero documentation on how to use these APIs in the context of Apple TV to iOS / iPadOS / WatchOS communication 🤦🏻‍♂.</p>

<p>In terms of sending messages, there is only one method aptly named <code class="language-plaintext highlighter-rouge">send(content:contentContext:isComplete:completion:)</code>. This allows us to send any arbitrary Data such as a JSON-encoded string.</p>

<p>The real problem is how to receive those messages. There is a method named <code class="language-plaintext highlighter-rouge">receiveMessage(completion:)</code> which, based on my work with watchOS and iOS extensions, sounds promising. Apple describes it as “<em>schedules a single receive completion handler for a complete message, as opposed to a range of bytes</em>”. Perfect!</p>

<p>Except it isn’t called, at least not when a message is sent. In a somewhat frustrating act, the messages only appear once the connection is terminated either because the tvOS app stops or because I cancel the connection. I tried for multiple hours but could not get that endpoint to fire unless the entire connection was dropped (at which point any messages that were sent during that time would come through as one single piece of data). I can only assume the messages are being cached locally without being delivered yet when the connection drops it suddenly decides to unload them 🤷🏻‍♂.</p>

<p>It turns out you need to use the more complex <code class="language-plaintext highlighter-rouge">receive(minimumIncompleteLength:maximumLength:completion:)</code> which requires you to say how big you want batches of data to be. You also need to resubscribe to this handler every time data appears on it. The problem here is that whilst there is a “completion” flag to tell you if the whole message has arrived this is never true when sending from tvOS, even if you use the corresponding flag on the send method. In the end, I limited the app to 1MB of data at a time as everything I send is well below that. I’ve never run into a problem with only partial data being sent but it is a potential risk to be aware of.</p>

<p>If you were using this for critical data, I’d probably suggest only sending encoded text and providing your own delimiter to look for i.e. for each string that comes in batch them together until one ends in a “|||” at which point you will know that was the end of a message from tvOS.</p>

<p>On the positive side, the connection setup and data sending are near instantaneous and the user facing UI works well. However, as there were already low-level network solutions to send data between devices (including non-Apple devices) it’s incredibly odd to me that Apple went to the effort of creating a beautiful device pairing API and UI for both SwiftUI and UIKit but didn’t extend that to the basics of sending data. Local networking is hard. I have no interest in diving into the minutia of handling UDP packets; I just want to send some basic strings between devices!</p>

<p>In order to get this all working for my own app, I created a class named <a href="https://github.com/bendodson/LocalDeviceManager/blob/main/LocalDeviceManager.swift"><code class="language-plaintext highlighter-rouge">LocalDeviceManager</code></a> that handles this all for you along with a <a href="https://github.com/bendodson/LocalDeviceManager/">SwiftUI demo project</a> for both tvOS and iOS that demonstrates how it works. The call site on tvOS is very simple:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@ObservedObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">deviceManager</span> <span class="o">=</span> <span class="kt">LocalDeviceManager</span><span class="p">(</span><span class="nv">applicationService</span><span class="p">:</span> <span class="s">"remote"</span><span class="p">,</span> <span class="nv">didReceiveMessage</span><span class="p">:</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"Message: </span><span class="se">\(</span><span class="n">string</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">},</span> <span class="nv">errorHandler</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"ERROR: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">showDevicePicker</span> <span class="o">=</span> <span class="kc">false</span>

<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kt">VStack</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">deviceManager</span><span class="o">.</span><span class="n">isConnected</span> <span class="p">{</span>
            <span class="kt">Button</span><span class="p">(</span><span class="s">"Send"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">deviceManager</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"Hello from tvOS!"</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="kt">Button</span><span class="p">(</span><span class="s">"Disconnect"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">deviceManager</span><span class="o">.</span><span class="nf">disconnect</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kt">DevicePicker</span><span class="p">(</span><span class="o">.</span><span class="nf">applicationService</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"remote"</span><span class="p">))</span> <span class="p">{</span> <span class="n">endpoint</span> <span class="k">in</span>
                <span class="n">deviceManager</span><span class="o">.</span><span class="nf">connect</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">)</span>
            <span class="p">}</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"Connect to a local device."</span><span class="p">)</span>
            <span class="p">}</span> <span class="nv">fallback</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"Device browsing is not supported on this device"</span><span class="p">)</span>
            <span class="p">}</span> <span class="nv">parameters</span><span class="p">:</span> <span class="p">{</span>
                <span class="o">.</span><span class="n">applicationService</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
    
<span class="p">}</span></code></pre></figure>

<p>Similarly, it’s trivial to set up an iOS app to communicate with the tvOS app:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@ObservedObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">deviceManager</span> <span class="o">=</span> <span class="kt">LocalDeviceManager</span><span class="p">(</span><span class="nv">applicationService</span><span class="p">:</span> <span class="s">"remote"</span><span class="p">,</span> <span class="nv">didReceiveMessage</span><span class="p">:</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"Message: </span><span class="se">\(</span><span class="n">string</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">},</span> <span class="nv">errorHandler</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"ERROR: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kt">VStack</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">deviceManager</span><span class="o">.</span><span class="n">isConnected</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Connected!"</span><span class="p">)</span>
            <span class="kt">Button</span> <span class="p">{</span>
                <span class="n">deviceManager</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"Hello from iOS!"</span><span class="p">)</span>
            <span class="p">}</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"Send"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="kt">Button</span> <span class="p">{</span>
                <span class="n">deviceManager</span><span class="o">.</span><span class="nf">disconnect</span><span class="p">()</span>
            <span class="p">}</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"Disconnect"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Not Connected"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
    <span class="o">.</span><span class="n">onAppear</span> <span class="p">{</span>
        <span class="k">try</span><span class="p">?</span> <span class="n">deviceManager</span><span class="o">.</span><span class="nf">createListener</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>There are more details on how this works on <a href="https://github.com/bendodson/LocalDeviceManager/">GitHub</a>.</p>

<p>Judging by the complete lack of 3rd party apps using this feature or articles detailing how to use this API I’m going to go out on a limb and say it’s unlikely we’ll see any improvements to this system in tvOS 17. Regardless, I’ve filed a few bug reports in the hopes that the documentation can be tidied up a bit. Just be aware that this is not the robust solution I was hoping it would be!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:devicename" role="doc-endnote">
      <p>I have been unable to divine a way to get the name of the device you are connected to. <a href="#fnref:devicename" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2023/03/14/postmortem-of-a-top-10-paid-ios-app/">Postmortem of the launch of a Top 10 Paid iOS App</a></h1>
			
			<time datetime="2023-03-14" pubdate=""><a href="/weblog/2023/03/14/postmortem-of-a-top-10-paid-ios-app/">March 14, 2023</a></time>
    	</header>
    	<div>
			<p>It’s been 4 weeks since the v2.0 update for <a href="https://dodoapps.io/music-library-tracker/">Music Library Tracker</a> launched so I thought now was a good time for a retrospective to detail how I promoted the app and how well it performed.</p>

<p>By way of a bit of background, the app originally launched back in January 2016 at a $0.99 price point making $1368 in it’s first month before dropping off significantly to roughly $20 a month. In January 2021, I was accepted into the <a href="https://developer.apple.com/app-store/small-business-program/">App Store Small Business Program</a> which meant the amount Apple took from sales fell from 30% to 15%; I had also increased the price and released a few more updates so the average profit for the half year prior to the v2.0 update in February was sitting at around $80 a month<sup id="fnref:historic" role="doc-noteref"><a href="#fn:historic" class="footnote" rel="footnote">1</a></sup>. This is by no means an income (especially as I have to pay corporation tax on it in the UK and then if I want to actually take the money for myself rather than my business I’ll have to pay some more tax) but it was fine for an app that didn’t have any running costs nor require much maintenance.</p>

<p>And then v2.0 happened.</p>

<p>With a new feature set built around Spatial Audio, v2.0 was released on 13th February 2023 after a 9 month development period, 3 months of which was open development via <a href="https://www.thedododeveloper.com/">my newsletter</a>. It was reported on by a couple of tech sites (I’ll detail how shortly) and ended up being the #8 Paid app in the US!</p>

<p>So how much money does an app need to make to be in the Top 10 of all paid apps on the App Store?</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/music-library-tracker-sales-chart.png" width="800" height="361" />
    <figure>Daily profit in USD over the past 28 days peaking at $1534 on February 15th</figure>
</div>

<p>Not as much as you might think! You can <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/music-library-tracker-v2-sales.csv">download a full breakdown</a> but the key figures are:</p>

<ul>
  <li>Profit of $82 on 13th Feb (launch day), $1449 on 14th Feb, $1534 on 15th Feb, and $414 on 16th Feb</li>
  <li>Total profit of $5351 over 28 days</li>
  <li>An average daily profit of $191</li>
  <li>Only a single sale on March 6th 😭</li>
</ul>

<p>I use <a href="https://www.dailysalesemail.com">Daily Sales Email</a> to find out how much I’ve made each day but the figures typically arrive around lunchtime on the following day. That meant I could see the app in the Top 10 of all paid apps but had no idea what that would translate into<sup id="fnref:analytics" role="doc-noteref"><a href="#fn:analytics" class="footnote" rel="footnote">2</a></sup>. I’ll confess that whilst I was pleased with the numbers, I was a little disappointed that I’d made less than what I charge for 2 days as a freelance iOS developer.</p>

<p>That said, the app has settled down into making roughly $40 per day which works out at around $1200 per month, not bad for something that will hopefully only need minor maintenance.</p>

<p>With the financial breakdown out of the way, I thought it might be interesting to detail exactly how I promoted the app. I will be completely honest and say it is not my strong suit at all. I hate doing app promotion work; it is abhorrent to me. I’m not sure if it’s the Englishman in me or something else but I absolutely hate having to email people saying “please look at my app” followed by the waiting and hoping that somebody will feature it. However, that’s what I had to do as an app of this nature likely isn’t going to generate enough revenue to make hiring a marketing person cost effective.</p>

<h2 id="reviews">Reviews</h2>

<p>The key thing for an app like this is for it to be written about by a tech site. I’ve had a couple articles in the past from sites like <a href="https://9to5mac.com/2016/03/15/music-tracker-large-libraries/">9to5mac</a> and <a href="https://www.macrumors.com/2016/01/20/music-tracker-apple-music-library-monitoring/">MacRumors</a> so my first port of call was to send them an email. As previously mentioned, I hate doing this stuff but I felt on slightly firmer ground with these sites as they’d written about the app before so that seemed like a good “in”:</p>

<blockquote>
  <p>Hello,</p>
</blockquote>

<blockquote>
  <p>Back in 2016 you were kind enough to review an app of mine, Music Library Tracker (https://9to5mac.com/2016/03/15/music-tracker-large-libraries/).</p>

  <p>I’m getting in touch as I’ve just released a large v2.0 update to the app which includes some features around Spatial Audio. In short, the app can quickly scan your library and show you exactly which songs have been upgraded to Spatial Audio and generate a playlist containing just those tracks; it will then run in the background periodically and notify you as and when tracks are upgraded and keep that playlist up to date.</p>

  <p>This is all possible due to a database of Dolby Atmos and Dolby Audio tracks I’ve created over the past 9 months to run my Spatial Audio Finder website (https://bendodson.com/projects/spatial-audio-finder/) and the @NewSpatialAudio Twitter account (https://twitter.com/NewSpatialAudio) which tweets whenever a new track is upgraded. This database is sourced from a minor update to the Apple Music API at WWDC 22 - you can see how this all works in a blog post I wrote last year (https://bendodson.com/weblog/2022/06/27/spatial-audio-finder/) but suffice to say I do not believe there is anyone outside of Apple with a dataset such as this.</p>

  <p>Apple Music does not yet have a clear strategy for displaying Spatial Audio tracks. Whilst they have some playlists and collections that get updated weekly, the only way to tell which tracks in your own library are upgraded is to play them and see. This is obviously not ideal and not a great way to showcase what is a genuine leap in musical quality and the hundreds of thousands of tracks that have been upgraded. I created this feature as I was determined to find a way to see which tracks had been updated. From the response I’ve received via @NewSpatialAudio it seems I’m not alone!</p>

  <p>The app is still a single cost download (25% off for the next week) with no in-app purchases, subscriptions, or adverts so anybody who downloaded the app in the past 7 years will get this new feature for free. I’ve provided a few promo codes below in case you or anyone at the MacRumors team are interested in taking a look:</p>

  <p>CODE1<br />
CODE2<br />
CODE3</p>

  <p>You can see some more information about the app at https://dodoapps.io/music-library-tracker/ and there is a full media kit with screenshots, etc, at https://dodoapps.io/music-library-tracker/media-kit/</p>

  <p>The update is available now on the App Store at https://apple.co/3XtdAga</p>

  <p>If you have any questions at all about the app, my Spatial Audio database, or anything else relating to Spatial Audio then just let me know.</p>

  <p>All the best,</p>

  <p>Ben</p>
</blockquote>

<p>I sent this email on the 13th February to the reviews@9to5mac.com address (as my previous contact had since moved elsewhere) and a very similar version with a different link directly to the Senior Editor at MacRumors who wrote a previous article. I got a <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/9to5mac-bounceback.png">very strange bounceback email</a> from 9to5mac and I didn’t get a reply at all from MacRumors. As the bounceback was so odd, I waited a day and then sent a follow up email to tips@9to5mac.com; it was a good thing I did as Chance Miller got in touch within 30 minutes and shortly afterwards there was an <a href="https://9to5mac.com/2023/02/14/apple-music-spatial-audio-songs/">article published</a>. This is undoubtedly what led to the spike in sales on the 14th and afterwards.</p>

<p>In addition to those two outlets, I sent similar emails to:</p>

<ul>
  <li>TechRadar (via news@techradar.com): their Entertainment Editor replied after a couple of hours and we had a few emails back and forth discussing various aspects of Spatial Audio such as how Apple bans AI upscaling. They <a href="https://www.techradar.com/opinion/finding-dolby-atmos-tracks-on-apple-music-is-hell-this-app-fixes-that">published an article</a> the next day but it didn’t show up in their RSS feed and is not visible on their website unless you follow the direct link (which was tweeted but had practically zero engagement)</li>
  <li>AppleInsider (direct to one of their writers who had written a recent article about Spatial Audio): I didn’t get a reply and there hasn’t been an article</li>
  <li>MacStories (direct email to John and Federico): I didn’t get a reply but it was listed in the “App Debuts” section of the Club MacStories newsletter for paid subscribers</li>
</ul>

<p>The following week I sent an email to iMore as I’d noticed an <a href="https://www.imore.com/music-movies-tv/apple-music/apple-is-showcasing-non-spatial-audio-albums-in-the-spatial-audio-page">interesting article</a> relating to Spatial Audio. I couldn’t find an email address for the author, Tammy Rogers, so instead sent an email direct to the Features Editor, Daryl Baxter, who was listed as a contributor:</p>

<blockquote>
  <p>Hi Daryl,</p>

  <p>I came across a recent article you contributed to, “Apple Music is showcasing non-Spatial Audio albums in it’s Spatial Audio page”, and had two things that may be of interest to you and Tammy (I couldn’t find an email address for her so my apologies for not including her as well).</p>

  <p>First of all, the reason that those albums are being listed within Apple Music’s Spatial Audio playlists is because they have some tracks on them that are available in Spatial Audio. The referenced No Pressure by Logic has two tracks that have been upgraded (GP4 and Perfect) whilst McCartney (2011) remaster has the first 13 tracks available in Spatial Audio. I know this because I created something called the Spatial Audio Finder which lets you find which tracks have been updated for a particular artist (I’ve got a blog post at https://bendodson.com/weblog/2022/06/27/spatial-audio-finder/ which explains how that all works). I also publish when tracks are upgraded to the @NewSpatialAudio Twitter feed.</p>

  <p>You also mentioned in the article that it’s quite hard to find Spatial Audio tracks within Apple Music. This is a huge bugbear of mine and so I recently updated an app of mine, Music Library Tracker, with some new features around Spatial Audio. The app was originally designed to help notify you when Apple changes your music (i.e. if a song is deleted due to licensing changes, etc) but it can now scan your library and show you which tracks you have that are available in Spatial Audio along with creating a playlist in Apple Music containing only those tracks. It can then keep monitoring your library and send you notifications as and when new tracks are updated.</p>
</blockquote>

<blockquote>
  <p><em>The rest of the email is similar to the initial one above</em></p>
</blockquote>

<p>I received a reply a few days later and then after 2 weeks <a href="https://www.imore.com/music-movies-tv/apple-music/this-app-makes-finding-your-apple-music-spatial-audio-tracks-easier-than-ever">an article appeared</a>.</p>

<p>In addition to the sites I reached out to, a few sites published articles organically including:</p>

<ul>
  <li><a href="https://appadvice.com/post/music-library-tracker-is-perfect-for-fans-of-spatial-audio-tracks-on-apple-music/776748">AppAdvice</a></li>
  <li><a href="https://www.whathifi.com/news/you-can-now-find-out-when-apple-music-songs-get-spatial-audio-fied">What Hi-Fi</a></li>
  <li><a href="https://www.tomsguide.com/news/how-to-discover-spatial-audio-tracks-in-your-apple-music-library">Tom’s Guide</a></li>
</ul>

<p>I’d like to give a big thank you to all of the people who did get back to me or wrote about the app - I’m very grateful! However, the experience of doing this is easily the worst part of being an independent app developer. I absolutely hate having to hawk the app around and then have the long period of waiting and hoping for an article to appear. I always try and craft my emails to be very specific to something the site has covered before or to provide some kind of story so it’s a bit easier to form a narrative other than “please talk about my app”. It’s incredibly disappointing when you don’t even get an email back. As I hated doing it, I’d typically send an email and then think “that’ll do” and by the time I realised a site wasn’t going to pick it up then the launch window had passed and it felt even more awkward to email in (especially as it had already been covered by 9to5mac so other sites could have potentially already seen that article and not wanted to cover something which is now old news).</p>

<p>A few things I should have done differently:</p>

<ol>
  <li>
    <p>I should have contacted people before the launch of the app rather than afterward. I don’t like contacting anyone before Apple have approved an app as that can lead to all sorts of problems. I’d already public committed to a date and didn’t give myself much room between approval and release so just sent the messages out post-launch. In an ideal world, I should have had a week or even two with the app approved within which I could have sent out promo codes or TestFlight invites so the app could be reviewed and embargoed. That would lead to a much bigger “splash” and also avoids the issue of sites potentially not wanting to promote an app that has already been promoted elsewhere.</p>
  </li>
  <li>
    <p>I should have written to more sites rather than just the ones I typically read. I did do some research to find sites that had talked about Spatial Audio (as I wanted some kind of an “in” when writing to someone who’d never heard of me before) but I probably should have just gone with a scattergun approach to anybody that is even vaguely app adjacent.</p>
  </li>
  <li>
    <p>I had no idea if the promo codes I was sending out were being used so couldn’t really tell if my emails were getting through. Once you’ve generated a promo code within App Store Connect, the only way to see if it has been redeemed or not is to try and redeem it (which is obviously not a good idea). I could easily just provide a link to my site which, when accessed, gives out a promo code and can then tell me that has happened but it just doesn’t sit right with me and I’d be afraid it would be something that would put people off.</p>
  </li>
  <li>
    <p>I should have followed up with the sites that didn’t reply to me. I did that with 9to5mac which definitely paid off but I felt more comfortable doing that as it seemed clear there was a technical error; sending a “sorry but did you get my email?” shouldn’t really be anxiety inducing but I couldn’t bring myself to do it.</p>
  </li>
</ol>

<p>If you are a writer for a tech site with any insight or a developer that has had any success stories with this then I’d absolutely love to hear from you!</p>

<h2 id="getting-featured-on-the-app-store-form">Getting Featured on the App Store Form</h2>

<p>When you’re looking at ways to promote an app, getting featured by Apple on the App Store is obviously a high priority goal. There have been <a href="https://nemecek.be/blog/169/how-to-get-featured-on-the-app-store">several articles recently</a> about using the <a href="https://developer.apple.com/contact/app-store/promote/">dedicated form</a> on the Apple Developer website with the key takeaway being to submit the form for every app update.</p>

<p>I have never used this form before, mostly because my apps tend to either be very niche or are something like this app which I’m always somewhat surprised makes it through App Review in one piece 😆. However I did it use it and something unexpected happened… I got an email from the Apple Services Performance Partnership Team<sup id="fnref:appleservicesteam" role="doc-noteref"><a href="#fn:appleservicesteam" class="footnote" rel="footnote">3</a></sup>:</p>

<blockquote>
  <p>We are currently recruiting new partners to promote the latest of Apple’s products to join the programme: Apple MusicKit.</p>

  <p>MusicKit lets users play Apple Music and their local music library from your app or website. So, when your users provide permission to access their Apple Music account, they can use your app or website to create playlists, add songs to their library, and play any of the millions of songs in the Apple Music catalog! If your app detects that the user is not yet an Apple Music member, you can offer a trial membership from within your app. The Apple Music Affiliate Program allows you to earn a commission on eligible referred Music memberships (new sign-ups only)! You can find more detailed information here as well as in the document attached.</p>

  <p>We have noticed that you already use the Apple Music API and we believe adding in MusicKit would be an easy process for you and a great benefit! We offer generous compensation models and would like to talk you through this opportunity in more detail.</p>

  <p>Please let us know your avails, so we can go ahead and schedule a call with you. 😊</p>
</blockquote>

<p>I did take the call<sup id="fnref:teams" role="doc-noteref"><a href="#fn:teams" class="footnote" rel="footnote">4</a></sup> and it is effectively outreach to try and get developers to promote Apple Music within their apps in exchange for a commission on any new subscriptions. You can already <a href="https://partners.applemediaservices.com/other-partners">apply for this directly</a> but I guess Apple saw that I was using MusicKit on the form I filled out and so set this up. Unfortunately it’s not really a good fit for this app (you’re likely not using it if you don’t have Apple Music) but it may be useful for another app I have in the pipeline in which I’d already added the <a href="https://developer.apple.com/documentation/storekit/skcloudservicesetupviewcontroller/offering_apple_music_subscription_in_your_app">“Subscribe to Apple Music” interstitial</a> that this hooks into.</p>

<p>Going back to the form, the app has not been featured anywhere on the App Store but I had very little expectation of that happening.</p>

<h2 id="app-store-ads">App Store Ads</h2>

<p>I took a look at promoting the app using Apple Search Ads and found that it was recommending a suggested “Cost-per-Install” of £5.61. This is not ideal bearing in mind the app cost £2.49 at the time 🤣</p>

<p>After I posted that on Twitter the developer of the excellent <a href="https://apps.apple.com/us/app/marvis-pro/id1447768809">Marvis Pro</a> music app, Aditya Rajveer, <a href="https://twitter.com/AdityaRajveer/status/1625523289321005057">reached out</a> and said “It almost never reached the suggested amount per install for my app, not even close”. That pushed me to give it a try and they were right! I’ve had it running for a few weeks now and have had 22 installs on an average Cost-Per-Install of £0.89. That’s not exactly setting my sales alight but it’s better than nothing. On a more positive note, I’m not actually being charged for these installs as I have a promotional balance apparently. I seem to remember I claimed a free $100 of advertising years and years ago so evidently that is still in use 🤷🏻‍♂</p>

<h2 id="app-store-in-app-events">App Store In-App Events</h2>

<p>I created an In-App Event on the App Store to coincide with the release of the update which ran for 1 week:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/music-library-tracker-in-app-event.jpg" width="645" height="548" />
    <figure>The irony is that you can't listen to Spatial Audio on those headphones but it was the only decent royalty-free image I could find...</figure>
</div>

<p>This had 4700 impressions leading to 9 downloads and 24 app opens. Again, not terribly exciting but extra sales are extra sales.</p>

<h2 id="other-promotions">Other Promotions</h2>

<p>I obviously promoted the app on my own <a href="https://mastodon.bendodson.com/@ben">Mastodon</a> and <a href="https://twitter.com/bendodson/">Twitter accounts</a> but I also tweeted about it on the <a href="https://twitter.com/newspatialaudio">@NewSpatialAudio</a> account which I believe led to the article on Tom’s Guide. There’s also <a href="https://www.thedododeveloper.com/">my newsletter</a> and <a href="https://bendodson.com/">my website</a> which mentioned the app. Finally, it was mentioned in both the <a href="https://indiedevmonday.com/issue-134">Indie Dev Monday</a> and <a href="https://swiftlyrush.curated.co/issues/62">SwiftlyRush</a> newsletters.</p>

<h2 id="so-what-actually-worked">So what actually worked?</h2>

<p>App Store Connect provides a metrics panel which roughly details where your downloads have come from. Rather astonishingly, it turns out that 43.4% of all my downloads in the past month came from “App Store Browse”. This is followed by “Web Referer” at 28.3%, “App Store Search” at 13.4%, and “App Referer” at 12.8%.</p>

<p>If I dig into that a little more I can see that most of the app referer traffic was either Facebook, Google, or Google Chrome (so likely clicking on links from one of the published articles). With web referer, the vast majority is 9to5mac.com followed by my own <a href="https://dodoapps.io/music-library-tracker/">Dodo Apps website</a>. Everything else is single digits.</p>

<p>My assumption is that the 9to5mac article created enough downloads to catapult the app up the Paid App charts and it was there that it was discovered by those just browsing the App Store who then made up the majority of my sales. This seems incredibly backwards to me as I’d assume the technical readership for whom this app is more likely aimed at would be the majority of downloaders but I suspect that with the billions of iOS devices in the world even a fractional percentage of users browsing the App Store is going to be magnitudes larger than the number of followers that the tech sites have.</p>

<p>In terms of next steps, I’m at a slight loss as to what to do as I don’t have any big splashy features that would merit the coverage that is clearly key to increasing the number of downloads. Having looked at what other developers are doing, it looks like I should try finding an influencer on TikTok but I know absolutely nothing about that world. I could also look at direct advertising on some of the tech sites or podcasts that would be relevant but doing so is likely going to be thousands of pounds worth of investment and feels like a bit of a gamble given this is a low-cost paid app rather than a subscription based service that can recoup large advertising costs over months of later usage.</p>

<p>If you’ve got any thoughts or insights then I’d <a href="https://bendodson.com/contact/">love to hear from you</a>. I’d also love it if you <a href="https://itunes.apple.com/us/app/music-tracker-automatic-tracking/id1062583712?ls=1&amp;mt=8">downloaded the app</a> 😉</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:historic" role="doc-endnote">
      <p>You can <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/music-library-tracker-v1-sales.csv">download</a> my historic monthly breakdown if you’re interested. With the change from a 70/30 split to an 85/15 split for the last 2 years, the actual amount I’ve given to Apple over the past 7 years has been around 26% leaving an average monthly profit of $59.83. <a href="#fnref:historic" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:analytics" role="doc-endnote">
      <p>I don’t use any analytics in my apps so I couldn’t see any realtime usage information. <a href="#fnref:analytics" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:appleservicesteam" role="doc-endnote">
      <p>It definitely came as a result of submitting that form as the email was sent to my personal address which I’d used on the form, not my Apple Developer account email address. <a href="#fnref:appleservicesteam" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:teams" role="doc-endnote">
      <p>I nearly didn’t as they inexplicably used Microsoft Teams 🤣 <a href="#fnref:teams" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2023/01/17/back-seat-shuffle/">Side Project: Back Seat Shuffle</a></h1>
			
			<time datetime="2023-01-17" pubdate=""><a href="/weblog/2023/01/17/back-seat-shuffle/">January 17, 2023</a></time>
    	</header>
    	<div>
			<p><span class="prelude">This is part of a <a href="/sideprojects/">series of blog posts</a> in which I showcase some of the side projects I work on for my own use. As with all of my side projects, I’m not focused on perfect code or UI; <a href="https://bendodson.s3.amazonaws.com/butitdoesrun.jpg">it just needs to run</a>!</span></p>

<p>If I’m going on a long drive with my two young children, I’ll load up an iPad with some videos and stick it in a pouch on the back of a seat to keep them entertained. Initially this started as a few films and a couple of their TV series on a USB-C stick but I’ve gradually started putting a few shows directly onto the iPad so they can be played via VLC. Why? Well, when using an external drive you’re limited to using the Files app which uses Quick View for video playback; this is fine for a film but for TV you have to go and start a new episode after the previous one finishes (and that involves my wife precariously leaning into the back without a seatbelt which isn’t ideal). I moved to using VLC for TV shows as they then play sequentially avoiding that problem but it can’t play from an external drive so I have to put things directly onto the limited storage of the device.</p>

<p>For a couple of weeks I’ve been toying with the idea of whether I could build a better app, one that would let me:</p>

<ul>
  <li>Plug in an external drive</li>
  <li>Show each series with a nice image</li>
  <li>Play episodes randomly without needing to copy the video to the device</li>
</ul>

<p>After a 3 hour drive to visit my mother, the priority for this has now increased exponentially 😂</p>

<p>To begin with, I needed to know if it is even possible to view external files within an app on iOS. It is, and has been since the introduction of <code class="language-plaintext highlighter-rouge">UIDocumentPickerViewController</code> in iOS 13 however the documentation left me a little confused:</p>

<blockquote>
  <p>Both the open and export operations grant access to documents outside your app’s sandbox. This access gives users an unprecedented amount of flexibility when working with their documents. However, it also adds a layer of complexity to your file handling. External documents have the following additional requirements:</p>

  <ul>
    <li>The open and move operations provide security-scoped URLs for all external documents. Call the startAccessingSecurityScopedResource() method to access or bookmark these documents, and the stopAccessingSecurityScopedResource() method to release them. If you’re using a UIDocumentsubclass to manage your document, it automatically manages the security-scoped URL for you.</li>
    <li>Always use file coordinators (see NSFileCoordinator) to read and write to external documents.</li>
    <li>Always use a file presenter (see NSFilePresenter) when displaying the contents of an external document.</li>
    <li>Don’t save URLs that the open and move operations provide. You can, however, save a bookmark to these URLs after calling startAccessingSecurityScopedResource() to ensure you have access. Call the bookmarkData(options:includingResourceValuesForKeys:relativeTo:) method and pass in the withSecurityScope option, creating a bookmark that contains a security-scoped URL.</li>
  </ul>
</blockquote>

<p>External files can only be accessed via a security-scoped URL and all of the tutorials I’d seen online relating to this were demonstrating how you could access a file and then copy it locally before removing that scope. I was therefore unsure how it would work in terms of streaming video (as it would go out of scope and lose security clearance) nor if I’d be able to retain access after displaying a directory and then wanting to start playback.</p>

<p>It turns out that it is all possible using a system known as “bookmarks”. In practice, a user will be shown their external drive in an OS controlled modal view and can select a folder, the URL of which is returned to my app. I then call the “start accessing security scoped resource” and convert that URL to a bookmark which is stored locally on my device and then close the security scoped resource. That bookmark can be used at any point to gain access to the drive (so long as it hasn’t been disconnected in which case the bookmark tells the app it is “stale” and therefore no longer working) and you can then interact with the URL the bookmark provides in the same way as you would with a local file.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">func</span> <span class="nf">documentPicker</span><span class="p">(</span><span class="n">_</span> <span class="nv">controller</span><span class="p">:</span> <span class="kt">UIDocumentPickerViewController</span><span class="p">,</span> <span class="n">didPickDocumentsAt</span> <span class="nv">urls</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">urls</span><span class="o">.</span><span class="n">first</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="c1">// make sure we stop accessing the resource once we exit scope (which will be as soon as the video starts playing)</span>
    <span class="k">defer</span> <span class="p">{</span> <span class="n">url</span><span class="o">.</span><span class="nf">stopAccessingSecurityScopedResource</span><span class="p">()</span> <span class="p">}</span>

    <span class="c1">// we don't care about the return value for this as we'll try to create a bookmark anyway</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="nf">startAccessingSecurityScopedResource</span><span class="p">()</span>

    <span class="c1">// store the bookmark data locally or silently fail</span>
    <span class="n">bookmark</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">url</span><span class="o">.</span><span class="nf">bookmarkData</span><span class="p">()</span>

    <span class="c1">// try to play the video; if there is an error, display an alert</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">try</span> <span class="nf">playVideos</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">controller</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Error"</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">,</span> <span class="nv">preferredStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">alert</span><span class="p">)</span>
        <span class="n">controller</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"OK"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">))</span>
        <span class="nf">present</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">playVideos</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">bookmark</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="c1">// get the local url from our bookmark; if the bookmark is stale (i.e. access has expired), then return</span>
    <span class="k">var</span> <span class="nv">stale</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="k">let</span> <span class="nv">directoryUrl</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">resolvingBookmarkData</span><span class="p">:</span> <span class="n">bookmark</span><span class="p">,</span> <span class="nv">bookmarkDataIsStale</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">stale</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="n">directoryUrl</span><span class="o">.</span><span class="n">path</span>
    <span class="k">guard</span> <span class="o">!</span><span class="n">stale</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">BSSError</span><span class="o">.</span><span class="n">staleBookmark</span>
    <span class="p">}</span>

    <span class="c1">// get the contents of the folder; only return mp4 and mkv files; if no files, throw an error</span>
    <span class="k">let</span> <span class="nv">contents</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">contentsOfDirectory</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">urls</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">"mp4"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">"mkv"</span><span class="p">)</span> <span class="p">})</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="k">guard</span> <span class="n">urls</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">BSSError</span><span class="o">.</span><span class="n">noFiles</span>
    <span class="p">}</span>

    <span class="c1">// present the video player with the videos in a random order</span>
    <span class="nf">presentPlayer</span><span class="p">(</span><span class="n">urls</span><span class="o">.</span><span class="nf">shuffled</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">presentPlayer</span><span class="p">(</span><span class="n">_</span> <span class="nv">urls</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// set the audio session so video audio is heard even if device is muted</span>
    <span class="k">try</span><span class="p">?</span> <span class="kt">AVAudioSession</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()</span><span class="o">.</span><span class="nf">setCategory</span><span class="p">(</span><span class="o">.</span><span class="n">playback</span><span class="p">)</span>

    <span class="c1">// create a queue of player items from the provided urls</span>
    <span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="n">urls</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">AVPlayerItem</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">player</span> <span class="o">=</span> <span class="kt">AVQueuePlayer</span><span class="p">(</span><span class="nv">items</span><span class="p">:</span> <span class="n">items</span><span class="p">)</span>

    <span class="c1">// present the player</span>
    <span class="k">let</span> <span class="nv">playerController</span> <span class="o">=</span> <span class="kt">AVPlayerViewController</span><span class="p">()</span>
    <span class="n">playerController</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
    <span class="nf">present</span><span class="p">(</span><span class="n">playerController</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">player</span><span class="p">?</span><span class="o">.</span><span class="nf">play</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This would also work in other contexts such as local files or even cloud-based services that work with the Files app such as iCloud or Dropbox.</p>

<p>I had originally planned on reading the contents of the USB stick and using a single .jpg file in each directory to render a nice thumbnail. In the end I abandoned that as it would have meant building the whole interface when in fact it works perfectly well just using <code class="language-plaintext highlighter-rouge">UIDocumentPickerViewController</code> to pick the show I’m interested in:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/back-seat-shuffle-sandd.gif" width="800" height="559" />
    <figure>Selecting a directory of videos in Back Seat Shuffle</figure>
</div>

<p>In the end the only extra code I added was to strip out any files that were not in the .mp4 or .mkv format and to have it automatically return to the file selection screen once the full queue of randomised videos had finished.</p>

<p>Whilst I could potentially put it on the App Store, this is one of those weird edge cases that likely wouldn’t get through App Review as they’ll look at it and say “this is just the Files app” and completely miss the point. As this would be a free app, it’s not worth the hassle of doing screenshots, App Store description, etc, only to have it be rejected by App Review.</p>

<p>The full app code is available on <a href="https://github.com/bendodson/back-seat-shuffle">GitHub</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/12/15/return-to-dark-tower-assistant/">Return to Dark Tower Assistant</a></h1>
			
			<time datetime="2022-12-15" pubdate=""><a href="/weblog/2022/12/15/return-to-dark-tower-assistant/">December 15, 2022</a></time>
    	</header>
    	<div>
			<p><a href="https://restorationgames.com/return-to-dark-tower/">Return to Dark Tower</a> is a really cool app-driven board game that comes with a physical tower that you connect via Bluetooth to an iPad. The tower lights up, makes sounds, and spins internally to shoot little skulls you place into it over the outlying map.</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/return-to-dark-tower.jpg" width="800" height="600" />
    <figure>You put little skulls in the top of the tower to end your turn...</figure>
</div>

<p>As much as I love it, there are a ton of cards in the game so you can easily forget what abilities you have available to you or miss crucial triggers at key phases in the game. You can also take most actions in any order so it’s easy to forget what you’ve done in the current turn, especially if you’re playing solo. To that end, I built myself a very niche app to keep track of all of the cards I had and all of the moves I’d made. It’s called <a href="https://apps.apple.com/us/app/return-to-dark-tower-assistant/id1659406816">Return to Dark Tower Assistant</a> and is optimised for use in an iPad Slide Over panel so you can use it on top of the app you use to run the game:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/rtdta.jpg" width="800" height="600" />
    <figure>Running the assistant in a Slide Over panel so you can still access the board game app beneath!</figure>
</div>

<p>There’s a very slim chance that any of you reading this have a copy of this board game and even if you do it’s likely a small minority that would find utility in this app. That said, I think it demonstrates what I’ve said for over a decade about making apps for yourself; build things for yourself on the off-chance that somebody else finds it as useful as you do. I spent far too much time matching the colours to the player boards, getting the fonts just right, and doing things like perfectly embedding the right icons for warrior and spirit tokens but I did that because I want it to look good when <em>I’m</em> playing. It will likely only get single-digit downloads, but it’s an app I’m proud of.</p>

<p>The assistant is available now on the <a href="https://apps.apple.com/us/app/return-to-dark-tower-assistant/id1659406816">App Store</a>. You can also read more about it on my <a href="https://dodoapps.io/return-to-dark-tower-assistant/">Dodo Apps website</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/12/08/stream-deck-ios-development/">Using a Stream Deck for iOS development</a></h1>
			
			<time datetime="2022-12-08" pubdate=""><a href="/weblog/2022/12/08/stream-deck-ios-development/">December 08, 2022</a></time>
    	</header>
    	<div>
			<p>The <a href="https://www.elgato.com/en/stream-deck">Elgato Stream Deck</a> is a fun device with 15 LED buttons that can be programmed to do whatever you want through an app that runs on PC and Mac. It was designed for streamers to be able to quickly switch scenes or present overlays but it has quickly become popular in other areas thanks to its flexible design. I picked one up in 2018 when I was dabbling with streaming but then mostly used it as control box for my Cessna 152 in Flight Simulator 2020 thanks to <a href="https://flightdeck.to/product/flightdeck/">FlightDeck</a>. I eventually replaced this with a bigger flight sim setup<sup id="fnref:flightsim" role="doc-noteref"><a href="#fn:flightsim" class="footnote" rel="footnote">1</a></sup> so the Stream Deck was sitting idle until I had the idea to integrate it into my app development workflow.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-mac-studio.jpg" width="800" height="450" />
    <figure>The Stream Deck running alongside my Mac Studio.</figure>
</div>

<p>I typically work on multiple projects per day as I have a number of active client projects at any one time along with my own independent apps. This means I often waste time getting set up for each project so my initial idea was to have a single button press to get my workspace configured.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-start.jpg" width="400" height="250" />
    <figure>A single button per platform to start a project.</figure>
</div>

<p>For example, I may want to start a specific Toggl timer, open a Jira board, and open the Xcode project. To do this, I created a single AppleScript file that is opened by the Stream Deck that will look something like this:</p>

<figure class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"Timery"</span><span class="w">
	</span><span class="nb">activate</span><span class="w">
	</span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">keystroke</span><span class="w"> </span><span class="s2">"1"</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="nv">command</span><span class="w"> </span><span class="nv">down</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">

</span><span class="nb">do shell script</span><span class="w"> </span><span class="s2">"open https://example.com/jira-board/"</span><span class="w">

</span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">tell</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="s2">"Safari"</span><span class="w">
	</span><span class="k">set</span><span class="w"> </span><span class="na">frontmost</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">true</span><span class="w">
	</span><span class="k">if</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Move to DELL P2415Q"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Window"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nb">exists</span><span class="w"> </span><span class="k">then</span><span class="w">
		</span><span class="nv">click</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Move to DELL P2415Q"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Window"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="mi">1</span><span class="w">
	</span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
	</span><span class="k">set</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">attribute</span><span class="w"> </span><span class="s2">"AXFullScreen"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">window</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">true</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">

</span><span class="nb">do shell script</span><span class="w"> </span><span class="s2">"open ~/Files/Clients/UKTV/iOS/App\\ Files/UKTV.xcodeproj"</span></code></pre></figure>

<p>In the first block I activate the Timery app and tell it to perform the keyboard shortcut ⌘+<em>n</em> where <em>n</em> is the project as it appears in Timery’s list. This will start a timer going for the project so I can track my time. I typically only use this for clients that I’m working with on a large project or have a regular maintenance contract with; for smaller ad hoc work I’ll instead throw an alert to remind me to start a timer manually.</p>

<p>The second block will open a URL in Safari to any website I might find relevant. This is typically a Jira or Trello board but can sometimes be to some API documentation, a GitHub issue pages, or even a local URL to open up a list in Things.</p>

<p>The third block is very specific to my hardware setup. I have an ultrawide monitor that I use as my primary display and then a 4K Dell monitor in portrait orientation to the side that I typically use for browsing and iOS simulators. This code tells Safari to move to that portrait monitor and then switch to full screen mode.</p>

<p>The final line opens up the Xcode project. I usually work in fullscreen mode on my primary monitor so it’ll typically move to a new space automatically without me needing to program that in.</p>

<p>With this simple script, I can press a single button to get everything configured. It’s probably only saving me 20 seconds of time but psychologically it lets me jump immediately into a project.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-finder.jpg" width="400" height="250" />
    <figure>Opening a project directory.</figure>
</div>

<p>Another minor hassle I encounter on a daily basis is opening up the directory where all of a project’s files are stored. I’ll typically do this if I need to look at some artwork I’ve saved or some documentation so I have a very simple script to open up the current project directory:</p>

<figure class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="nb">do shell script</span><span class="w"> </span><span class="s2">"open ~/Files/Clients/UKTV/"</span></code></pre></figure>

<p>This is again a psychological improvement as I hate wasting time digging down through Finder to get to the location I need.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-build.jpg" width="400" height="250" />
    <figure>Building and exporting iOS / tvOS apps.</figure>
</div>

<p>So far I’ve only made minor improvements to my productivity but this last button saves me a huge amount of time; automated building. Whilst many developers will handle this task with some form of Continuous Integration or using the new Xcode Cloud feature, this typically doesn’t work well for me due to the number of projects I’m involved with at any one time. Instead, I use <a href="https://fastlane.tools">Fastlane</a> to perform a wide array of tasks at once such as increasing build numbers, pushing to GitHub, building, and uploading to TestFlight.</p>

<p>Here is a typical Fastfile<sup id="fnref:fastfile" role="doc-noteref"><a href="#fn:fastfile" class="footnote" rel="footnote">2</a></sup> for one of my client projects:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Config</span>
<span class="n">xcode_version</span> <span class="o">=</span> <span class="s2">"14.1.0"</span>
<span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"UKTV"</span><span class="p">,</span> <span class="s2">"NotificationServiceExtension"</span><span class="p">]</span>
<span class="n">git_remote</span> <span class="o">=</span> <span class="s2">"origin/main"</span>

<span class="c1"># Import shared Fastfile</span>
<span class="n">import</span> <span class="s2">"~/Files/Scripts/SharedFastfile.rb"</span>

<span class="n">lane</span> <span class="ss">:distribute</span> <span class="k">do</span>

  <span class="n">ensure_git_status_clean</span><span class="p">()</span>

  <span class="n">xcode_select</span><span class="p">(</span><span class="s2">"/Applications/Xcode-"</span> <span class="o">+</span> <span class="n">xcode_version</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">)</span>

  <span class="n">shared_increase_version</span><span class="p">(</span>
    <span class="ss">targets: </span><span class="n">targets</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">","</span><span class="p">),</span>
    <span class="ss">push_to: </span><span class="n">git_remote</span>
  <span class="p">)</span>

  <span class="n">version</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"shared-tmp.txt"</span><span class="p">)</span>
  <span class="no">UI</span><span class="p">.</span><span class="nf">important</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

  <span class="n">build_app</span><span class="p">(</span>
    <span class="ss">output_directory: </span><span class="s2">"builds"</span><span class="p">,</span>
    <span class="ss">output_name: </span><span class="n">version</span>
  <span class="p">)</span>

  <span class="n">upload_to_testflight</span><span class="p">(</span>
    <span class="ss">ipa: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">".ipa"</span><span class="p">,</span>
    <span class="ss">skip_submission: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">skip_waiting_for_build_processing: </span><span class="kp">true</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="n">upload_symbols_to_crashlytics</span><span class="p">(</span><span class="ss">dsym_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">".app.dSYM.zip"</span><span class="p">,</span> <span class="ss">binary_path: </span><span class="s1">'scripts/upload-symbols'</span><span class="p">)</span>

<span class="k">end</span></code></pre></figure>

<p>To start with I specify the Xcode version I want to use, the targets of the project, and the name of the remote git repository. I then import a Ruby file which I’ll come to shortly.</p>

<p>The only lane is <code class="language-plaintext highlighter-rouge">distribute</code> and the first check is to ensure the Git repository is clean. If there are any uncommitted changes, the script will exit out and present an error. I then select the correct version of Xcode<sup id="fnref:xcode" role="doc-noteref"><a href="#fn:xcode" class="footnote" rel="footnote">3</a></sup>.</p>

<p>The next section includes a <code class="language-plaintext highlighter-rouge">shared_increase_version()</code> function which comes from the imported Ruby file:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">##</span>
<span class="c1"># INCREASE_VERSION</span>
<span class="c1"># </span>
<span class="c1"># Prompts the user for a version number. If new provided, update all targets and reset</span>
<span class="c1"># builder number to 1. Otherwise, just bump the build number.</span>

<span class="n">private_lane</span> <span class="ss">:shared_increase_version</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>

  <span class="c1"># Fetch all targets as comma-separated string and convert to array</span>
  <span class="k">if</span> <span class="o">!</span><span class="n">options</span><span class="p">[</span><span class="ss">:targets</span><span class="p">]</span>
    <span class="no">UI</span><span class="p">.</span><span class="nf">user_error!</span><span class="p">(</span><span class="s2">"You must provide at least one target in 'targets'"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">targets</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:targets</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span>

  <span class="c1"># Fetch current version using default Fastlane action with the first target</span>
  <span class="n">version</span> <span class="o">=</span> <span class="n">get_version_number</span><span class="p">(</span><span class="ss">target: </span><span class="n">targets</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

  <span class="c1"># Prompt for new marketing version</span>
  <span class="n">new_version</span> <span class="o">=</span> <span class="no">UI</span><span class="p">.</span><span class="nf">input</span><span class="p">(</span><span class="s2">"New marketing version? &lt;press enter to keep it at v</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">new_version</span><span class="p">.</span><span class="nf">strip</span> <span class="o">==</span> <span class="s2">""</span>
    <span class="c1"># No change to version so just increase build number</span>
    <span class="n">increment_build_number</span><span class="p">()</span> 
  <span class="k">else</span>
    <span class="c1"># Loop through each target and increment version number with "versioning" plugin</span>
    <span class="c1"># The native 'increment_version_number' action does not work with recent versions of Xcode</span>
    <span class="n">targets</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span>
      <span class="n">increment_version_number_in_plist</span><span class="p">(</span><span class="ss">version_number: </span><span class="n">new_version</span><span class="p">,</span> <span class="ss">target: </span><span class="n">target</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">new_version</span>

    <span class="c1"># Set build number to 1 using default Fastlane action (shows a warning about ${SRCROOT} but it does work)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:alwaysIncrementBuildNumber</span><span class="p">]</span>
      <span class="n">increment_build_number</span><span class="p">()</span>
    <span class="k">else</span> 
      <span class="n">increment_build_number</span><span class="p">(</span><span class="ss">build_number: </span><span class="mi">1</span><span class="p">)</span>  
    <span class="k">end</span>
    
  <span class="k">end</span>

  <span class="c1"># Fetch build number</span>
  <span class="n">build_number</span> <span class="o">=</span> <span class="n">get_build_number</span><span class="p">()</span>

  <span class="c1"># Write the new version number to the shared-tmp.txt file so calling lane can pick it up</span>
  <span class="c1"># This is a limitation of Fastlane not being able to return values in a shared lane</span>
  <span class="n">version_string</span> <span class="o">=</span> <span class="s2">"v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">"-b"</span> <span class="o">+</span> <span class="n">build_number</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">"shared-tmp.txt"</span><span class="p">,</span> <span class="n">version_string</span><span class="p">)</span>

  <span class="c1"># Message to the user to show the new version and build number</span>
  <span class="no">UI</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="s2">"App Version Updated: v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">" (build "</span> <span class="o">+</span> <span class="n">build_number</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">)</span>

  <span class="c1"># If there is no git remote to push to, then exit the lane</span>
  <span class="k">if</span> <span class="o">!</span><span class="n">options</span><span class="p">[</span><span class="ss">:push_to</span><span class="p">]</span> <span class="o">||</span> <span class="n">options</span><span class="p">[</span><span class="ss">:push_to</span><span class="p">].</span><span class="nf">strip</span> <span class="o">==</span> <span class="s2">""</span>
    <span class="no">UI</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="s2">"Skipping git"</span><span class="p">)</span>
    <span class="k">next</span>
  <span class="k">end</span>

  <span class="c1"># Commit the version change</span>
  <span class="n">commit_version_bump</span><span class="p">(</span><span class="ss">message: </span><span class="s2">"v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">" (build "</span> <span class="o">+</span> <span class="n">build_number</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">,</span> <span class="ss">force: </span><span class="kp">true</span><span class="p">)</span>

  <span class="c1"># Add a git tag in the format "builds/v1.1-b3"</span>
  <span class="n">add_git_tag</span><span class="p">(</span><span class="ss">includes_lane: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">prefix: </span><span class="s2">"v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">"-b"</span><span class="p">,</span> <span class="ss">build_number: </span><span class="n">build_number</span><span class="p">)</span>

  <span class="c1"># Push to specified remote</span>
  <span class="n">git_remote</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:push_to</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
  <span class="n">remote</span> <span class="o">=</span> <span class="n">git_remote</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">branch</span> <span class="o">=</span> <span class="n">git_remote</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">push_to_git_remote</span><span class="p">(</span><span class="ss">remote: </span><span class="n">remote</span><span class="p">,</span> <span class="ss">remote_branch: </span><span class="n">branch</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>I won’t go through this line by line but the basic idea is that it will prompt me to ask whether this is a new version of the app or a new build; if the former, the version is updated to the one specified and the build number set to 1 across all targets; if the latter, then I just bump the build number. Once that is done, a version string is created that looks something like <em>v1.2.3-b2</em> which I will use later in the workflow; this string is saved to a temporary file so the original Fastfile can reference it.</p>

<p>With the version and build number updated, the script then commits the changes to Git, tags them, and pushes them to the remote branch if one was specified.</p>

<p>The code resumes in the Fastfile with an Xcode build command (which stores the build and it’s dSYMs in a local directory), an upload to TestFlight, and the uploading of the dSYMs to the Crashlytics service.</p>

<p>With this system in place, I can press one button to have the entire build process execute in the background. This is hugely important to me as I can start work on another project whilst this process plays out; on the Mac Studio I don’t even notice anything is happening as the build process doesn’t come close to maxing out the CPU.</p>

<p>The nice thing about this Fastlane system is that I can make it bespoke for projects that need something a little different. Here, for example, is the file for a Catalyst project I work on:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Config</span>
<span class="n">xcode_version</span> <span class="o">=</span> <span class="s2">"14.1.0"</span>
<span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ATPDigital7"</span><span class="p">]</span>
<span class="n">git_remote</span> <span class="o">=</span> <span class="s2">"origin/master"</span>

<span class="c1"># Import shared Fastfile</span>
<span class="n">import</span> <span class="s2">"~/Files/Scripts/SharedFastfile.rb"</span>

<span class="c1">##</span>
<span class="c1"># LANES</span>
<span class="c1">##</span>

<span class="n">lane</span> <span class="ss">:distribute</span> <span class="k">do</span>

  <span class="n">xcode_select</span><span class="p">(</span><span class="s2">"/Applications/Xcode-"</span> <span class="o">+</span> <span class="n">xcode_version</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">)</span>

  <span class="n">ensure_git_status_clean</span><span class="p">()</span>

  <span class="n">shared_increase_version</span><span class="p">(</span>
    <span class="ss">targets: </span><span class="n">targets</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">","</span><span class="p">),</span>
    <span class="ss">push_to: </span><span class="n">git_remote</span><span class="p">,</span>
    <span class="ss">alwaysIncrementBuildNumber: </span><span class="kp">true</span>
  <span class="p">)</span>

  <span class="nb">system</span><span class="p">(</span><span class="s2">"git push helastel HEAD:develop"</span><span class="p">)</span>

  <span class="n">version</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"shared-tmp.txt"</span><span class="p">)</span>
  <span class="no">UI</span><span class="p">.</span><span class="nf">important</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

  <span class="n">ios_export</span> <span class="o">=</span> <span class="s2">"ios-"</span> <span class="o">+</span> <span class="n">version</span>
  <span class="n">mac_export</span> <span class="o">=</span> <span class="s2">"mac-"</span> <span class="o">+</span> <span class="n">version</span>

  <span class="c1"># Build the macOS app</span>
  <span class="n">build_app</span><span class="p">(</span>
    <span class="ss">catalyst_platform: </span><span class="s2">"macos"</span><span class="p">,</span>
    <span class="ss">output_directory: </span><span class="s2">"builds"</span><span class="p">,</span>
    <span class="ss">output_name: </span><span class="n">mac_export</span>
  <span class="p">)</span>

  <span class="c1"># Rename the macOS app export to mac-v1.0-b1.app</span>
  <span class="no">FileUtils</span><span class="p">.</span><span class="nf">mv</span><span class="p">(</span><span class="s2">"../builds/ATPdigital 8.app"</span><span class="p">,</span> <span class="s2">"../builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">)</span>

  <span class="c1"># Zip the macOS app and then upload it to S3</span>
  <span class="n">zip</span><span class="p">(</span>
    <span class="ss">path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">,</span>
    <span class="ss">output_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".zip"</span>
  <span class="p">)</span>
  <span class="n">s3_upload</span><span class="p">(</span>
    <span class="ss">access_key_id: </span><span class="s2">"IMNOTTHATSILLY"</span><span class="p">,</span>
    <span class="ss">secret_access_key: </span><span class="s2">"Uhuhuhyoudidntsaythemagicword"</span><span class="p">,</span>
    <span class="ss">bucket: </span><span class="s2">"bucketname"</span><span class="p">,</span>
    <span class="ss">content_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".zip"</span><span class="p">,</span>
    <span class="ss">name: </span><span class="s2">"clients/bgs/builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".zip"</span>
  <span class="p">)</span>

  <span class="c1"># Build the iOS app</span>
  <span class="n">build_app</span><span class="p">(</span>
    <span class="ss">catalyst_platform: </span><span class="s2">"ios"</span><span class="p">,</span>
    <span class="ss">output_directory: </span><span class="s2">"builds"</span><span class="p">,</span>
    <span class="ss">output_name: </span><span class="n">ios_export</span>
  <span class="p">)</span>

  <span class="n">upload_symbols_to_crashlytics</span><span class="p">(</span><span class="ss">dsym_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".app.dSYM.zip"</span><span class="p">,</span> <span class="ss">binary_path: </span><span class="s1">'scripts/upload-symbols'</span><span class="p">)</span>
  <span class="n">upload_symbols_to_crashlytics</span><span class="p">(</span><span class="ss">dsym_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">ios_export</span> <span class="o">+</span> <span class="s2">".app.dSYM.zip"</span><span class="p">,</span> <span class="ss">binary_path: </span><span class="s1">'scripts/upload-symbols'</span><span class="p">)</span>

  <span class="c1"># Upload macOS app to TestFlight</span>
  <span class="n">upload_to_testflight</span><span class="p">(</span>
    <span class="ss">pkg: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".pkg"</span><span class="p">,</span>
    <span class="ss">skip_submission: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">skip_waiting_for_build_processing: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">app_platform: </span><span class="s2">"osx"</span>
  <span class="p">)</span>

  <span class="c1"># Upload iOS app to TestFlight</span>
  <span class="n">upload_to_testflight</span><span class="p">(</span>
    <span class="ss">ipa: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">ios_export</span> <span class="o">+</span> <span class="s2">".ipa"</span><span class="p">,</span>
    <span class="ss">skip_submission: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">skip_waiting_for_build_processing: </span><span class="kp">true</span><span class="p">,</span>
  <span class="p">)</span>

<span class="k">end</span></code></pre></figure>

<p>This one is a lot more involved but the basic steps are very similar:</p>

<ol>
  <li>Set up the configuration that is needed</li>
  <li>Select Xcode, check the repo is clean, and bump the version number</li>
  <li>Do another Git push to a different repo</li>
  <li>Build the macOS version of the app, zip it, and upload it to an Amazon S3 instance</li>
  <li>Build the iOS version of the app</li>
  <li>Upload the dSYMs to Crashlytics for both versions</li>
  <li>Upload each version to TestFlight</li>
</ol>

<p>The process typically takes about 20 minutes to run but would take longer if I were doing it manually as there are multiple points that would require user interaction. That I can press one button and have this run seamlessly in the background is of huge benefit to me, especially if I’m doing multiple builds in a single day.</p>

<p>I also have a client that has 6 apps that all come from the same codebase. Again, I can press one button and have all 6 of those apps compiled and uploaded; it also automatically submits each app to the App Store once the builds have finished processing!</p>

<p>I’m planning on extending this further in the future as I create a HTML page for some clients which gives a changelog for each build based on the commit messages. At the moment I do this manually but I could easily automate that with AppleScript and hook it into this process.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-stop.jpg" width="400" height="250" />
    <figure>My Stream Deck homescreen</figure>
</div>

<p>The final thing to mention is the Stream Deck homescreen itself. I have a folder for each project denoted by their app icon which then goes into the start / build commands detailed above. There is also a STOP button will stop any Toggl timer that is currently running and a sleep button that will turn off the Stream Deck display.</p>

<p>I have been incredibly impressed with the Stream Deck as an input device and think it can be an incredibly valuable tool for any app developer that works on multiple projects. All of the above can be achieved by just running an AppleScript file (as that is what the Stream Deck is doing) but I find the tactile nature of the device to be incredibly rewarding and I know there is a ton more I’m going to do with it over time.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:flightsim" role="doc-endnote">
      <p>The <a href="https://flyhoneycomb.com/products/bravo-throttle-quadrant">Bravo Throttle Quadrant</a> has physical buttons on it for dealing with auto pilot settings and flaps which were my main use cases with FlightDeck. <a href="#fnref:flightsim" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:fastfile" role="doc-endnote">
      <p>All of the magic works in the Fastfile but the Stream Deck still needs to be able to start the command so I use an AppleScript to open Terminal and kick off <code class="language-plaintext highlighter-rouge">fastlane distribute</code> in the correct directory. <a href="#fnref:fastfile" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:xcode" role="doc-endnote">
      <p>I have 3-4 versions of Xcode installed at any one time as different clients will be on different release schedules so I may still need to build something with an older version. I’ll likely change this portion of the script to always use the latest version unless I manually specify one as it’s a pain to edit my script files whenever a new Xcode update comes out. <a href="#fnref:xcode" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/11/21/the-dodo-developer/">The Dodo Developer</a></h1>
			
			<time datetime="2022-11-21" pubdate=""><a href="/weblog/2022/11/21/the-dodo-developer/">November 21, 2022</a></time>
    	</header>
    	<div>
			<p>For the past few months I’ve been meaning to start a newsletter; partially as a way of motivating me to finish some of my many projects, partially as a way of building up a mailing list so I can market my own apps better. The priority for this has only increased as the long-term future for Twitter (my main source of referrals to my various apps and websites) has moved to shakier ground<sup id="fnref:twitterpessimism" role="doc-noteref"><a href="#fn:twitterpessimism" class="footnote" rel="footnote">1</a></sup>.</p>

<p>Today I finally took that step by creating <em><a href="https://www.thedododeveloper.com/">The Dodo Developer</a></em><sup id="fnref:dododeveloper" role="doc-noteref"><a href="#fn:dododeveloper" class="footnote" rel="footnote">2</a></sup> on Substack.</p>

<iframe src="https://www.thedododeveloper.com/embed" width="100%" height="320" style="border:1px solid #EEE; background: white; margin: 0 auto; display: block; border-radius: 16px;" frameborder="0" scrolling="no"></iframe>

<p>I’ve created an <a href="https://www.thedododeveloper.com/p/1-the-setup">initial introductory post</a> going through some of the motivations for this move and listing some of the items on my “To do” list but the aim is to produce a new issue every 2 weeks.</p>

<p>I like to use my main website for either announcing new releases or providing code-level tutorials; the newsletter will be slightly different in that it will be showcasing things <em>way</em> before they are necessarily ready for prime time. This has two main benefits in that working akin to a 2-week sprint cycle will hopefully motivate me to proceed with the numerous app ideas that are half-finished on my hard drive; on the flip side, it will also hopefully generate some much needed feedback during the development process as I’m planning to invite subscribers to early access betas of new apps and major updates to existing apps. This all begins next week when I’ll be going into detail with the <a href="https://itunes.apple.com/us/app/music-tracker-automatic-tracking/id1062583712?ls=1&amp;mt=8">Music Library Tracker</a> upgrade that introduces Spatial Audio matching as well as showing off a new dice-based game mechanic I’ve created for a “Choose your own Adventure” style game.</p>

<p>As we head into 2023 I’m determined to try and spend more of my time on my independent projects. By subscribing to the newsletter, you’ll be directly boosting my motivation towards that aim and hopefully getting an insight into how a developer forms an idea into a digital reality.</p>

<p>I’ll be landing in your inbox for the first issue next week!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:twitterpessimism" role="doc-endnote">
      <p>I don’t necessarily share the pessimism of others with regards to Twitter’s future but there is a non-zero chance that it shuts down without warning one night in the near future so best to be prepared. I won’t be moving to any other social media network. <a href="#fnref:twitterpessimism" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:dododeveloper" role="doc-endnote">
      <p>I can’t remember if I’ve mentioned my affinity for dodos on this blog before but the reason for the name comes from two things: my surname contains the same letters as “dodo” and when I was at school I loved the dodo character in Disney’s <em>Alice in Wonderland</em> (“you there, stop kicking that mackeral”). When I developed my first piece of software, a database system for the management of choral robes (honestly), I used “Dodo Apps” as the name and it’s kind of stuck! <a href="#fnref:dododeveloper" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/07/12/chaise-longue-to-5k/">'Chaise Longue to 5K' and porting a tvOS app built with UIKit to iOS, iPadOS, and macOS</a></h1>
			
			<time datetime="2022-07-12" pubdate=""><a href="/weblog/2022/07/12/chaise-longue-to-5k/">July 12, 2022</a></time>
    	</header>
    	<div>
			<p>A little while ago, my chiropractor recommended that I take up the “<a href="https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/">Couch to 5K</a>” program in order to improve my fitness in a way that wouldn’t see me literally running before I could walk. It was a huge success and I was able to lose a significant amount of weight and improve my overall health. Unfortunately, the 2020 lockdowns and the birth of a new child meant most of that effort was undone and I found myself once again needing to embark on a gradual increase in exercise.</p>

<p>One of the key features of Couch to 5K is that you do intermittent bursts of running and walking; for example, in the first week you’ll do three runs consisting of alternating 60 seconds of running (x8) and 90 seconds of walking (x7) sandwiched between a 5 minute warm up and cool down. To keep track of this, I used the <a href="https://apps.apple.com/gb/app/one-you-couch-to-5k/id1082307672">free NHS Couch to 5K app</a> which tells you what to do at each stage via an audio voiceover which also offers encouragement throughout your run. This worked well for me as I listened to music whilst doing my runs, but nowadays I prefer to run whilst watching TV shows or YouTube videos on an Apple TV in front of my treadmill. For this use case, audio interruption wasn’t necessarily what I wanted, especially as I was already vaguely familiar with the different run timings. Instead, I wanted an app on my Apple TV that could show me my run progress in a Picture in Picture window.</p>

<p>Introducing “<a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">Chaise Longue to 5K</a>” (after all, couches are <em>so</em> common):</p>

<div class="gofigure">
    <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">
        <img src="https://bendodson.s3.amazonaws.com/weblog/2022/chaise-longue-to-5k-niles.jpg" width="800" height="450" />
    </a>
    <figure>Frasier, the discerning runner's choice.</figure>
</div>

<p>The idea is straightforward enough; you open the app to a grid showing all of the available runs<sup id="fnref:wireframe" role="doc-noteref"><a href="#fn:wireframe" class="footnote" rel="footnote">1</a></sup> and then navigate to a fullscreen running page with a timer and coloured blocks that show what you should be doing. This can then be shrunk down into a Picture in Picture window so you can see the critical information whilst you watch something else.</p>

<p>Originally I’d planned to use the new <code class="language-plaintext highlighter-rouge">AVPictureInPictureController.init(contentSource:)</code> API that was introduced with tvOS 15.0 as that would allow me to fairly easily render the <code class="language-plaintext highlighter-rouge">UIView</code> of the run screen into the PiP window; unfortunately, there is a <a href="https://github.com/jazzychad/PiPBugDemo">bug with tvOS</a> which prevents that from working and is still present in the tvOS 16 betas.</p>

<p>My next plan was to have the app render a video of the run on the fly. Essentially I would display the running UI, snapshot it with <code class="language-plaintext highlighter-rouge">UIView.drawHierarchy(in rect: CGRect, afterScreenUpdates afterUpdates: Bool)</code>, and then pipe the <code class="language-plaintext highlighter-rouge">UIImage</code> into an <code class="language-plaintext highlighter-rouge">AVAssetWriter</code> at 1 second intervals to generate a video. Unfortunately that proved too intensive for the Apple TV hardware (especially the non-4K model) with the render taking a couple of minutes for each video. However, as I’d already built the render pipeline, I instead updated the system to generate all of the videos sequentially and store them; I then ran that in the tvOS Simulator to generate the 12 videos<sup id="fnref:chaisevideos" role="doc-noteref"><a href="#fn:chaisevideos" class="footnote" rel="footnote">2</a></sup> and then bundled them in the app. Much easier 🤣</p>

<p>The final part was to add a button to the top of the run selector page that would show you your next run. To do this, I store the week and number of the last run that was completed<sup id="fnref:cooldown" role="doc-noteref"><a href="#fn:cooldown" class="footnote" rel="footnote">3</a></sup> within <code class="language-plaintext highlighter-rouge">NSUbiquitousKeyValueStore</code>; this is a similar API to <code class="language-plaintext highlighter-rouge">UserDefaults</code> with the advantage that it is synced through the user’s iCloud account meaning it’ll survive reinstallations or switching to a new Apple TV without restoring from backup.</p>

<p>However, that led to an interesting idea. Could I port this to other platforms? And if I could, would I be able to <a href="https://twitter.com/bendodson/status/1544599673943609345">do it in a single day</a>?</p>

<p>Yes.</p>

<div class="gofigure">  
    <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">
        <img src="https://bendodson.s3.amazonaws.com/dodo/chaise-longue-to-5k-sync.jpg" width="800" height="450" />
    </a>
</div>

<p>Despite using UIKit rather than SwiftUI, I was able to port everything over to iPhone, iPad, and Mac within 5 hours or so. I started by rejigging the project files so shared code would be separate from the xib files I use for the interface. I then added a new target for iOS and went through the laborious process of recreating the xib files; unfortunately tvOS and iOS xibs are incompatible even so far as you can’t copy and paste standard elements like <code class="language-plaintext highlighter-rouge">UILabel</code> between them.</p>

<p>The design was such that it was quite easy to make it work for iPhone. The run page itself just needed some font size adjustments whilst the grid view showing all of the runs had some stack views tweaked so they were shown vertically rather than horizontally.</p>

<p>The next step was to optimise the design for iPad. Again, this mostly worked out of the box as I use AutoLayout for everything. I just needed to monitor trait changes and update the code to render slightly differently depending on whether we were in compact or regular width mode. This had the nice side effect of enabling the three column layout on an iPhone 13 Pro Max in landscape and also working across the various split screen views that are available on iPad.</p>

<p>Finally, I checked the box for Catalyst support for macOS and was surprised to find that everything pretty much worked out of the box. I only needed to add the following code to get the app looking just fine on the Mac:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="cp">#if targetEnvironment(macCatalyst)</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">titlebar</span> <span class="o">=</span> <span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="n">windowScene</span><span class="p">?</span><span class="o">.</span><span class="n">titlebar</span> <span class="p">{</span>
        <span class="n">titlebar</span><span class="o">.</span><span class="n">titleVisibility</span> <span class="o">=</span> <span class="o">.</span><span class="n">hidden</span>
        <span class="n">titlebar</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="n">windowScene</span><span class="p">?</span><span class="o">.</span><span class="n">sizeRestrictions</span><span class="p">?</span><span class="o">.</span><span class="n">minimumSize</span> <span class="o">=</span> <span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">768</span><span class="p">)</span>
<span class="cp">#endif</span></code></pre></figure>

<p>That code effectively hides the toolbar so the traffic light window management buttons blend into the app view and then restricting the minimum view size to that of a regular iPad so you can’t break the layout<sup id="fnref:catalyst" role="doc-noteref"><a href="#fn:catalyst" class="footnote" rel="footnote">4</a></sup>.</p>

<p>With that done, I then went through the app and added a few quality of life improvements such as a native menu bar on the Mac, keyboard shortcuts for Mac and iPad, and adding the ability for PiP to automatically engage when you leave the app during a run on iPhone and iPad.</p>

<p>SwiftUI would undoubtedly have made the UI faster to port, but I still think the platform is too immature for full app development. As <a href="https://twitter.com/richturton/status/1469320087844933638">Richard Turton put it</a>:</p>

<blockquote>
  <p>SwiftUI allows you to move so incredibly fast that by the time you realise what you want isn’t yet possible, you’re already off the edge of the cliff, like Wile E Coyote</p>
</blockquote>

<p>That certainly matches my experience 🤣. Whilst it can be a phenomenally quick tool for building UI, it can’t quite match the smooth experience that users expect when it comes to the small but crucial details.</p>

<div class="gofigure">  
    <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">
        <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/chaise-longue-to-5k-iphone.jpg" width="800" height="450" />
    </a>
</div>

<h3 id="in-conclusion">In Conclusion</h3>

<p>As I’ve said many times before, one of the great joys of being a software developer is that you can build apps bespoke for your own needs and interests. I’ve massively enjoyed having Chaise Longue to 5K on my Apple TV whilst doing my runs, but I also really enjoyed the challenge of porting the app across to all the other Apple platforms that support Picture in Picture<sup id="fnref:applewatchchaise" role="doc-noteref"><a href="#fn:applewatchchaise" class="footnote" rel="footnote">5</a></sup>. As ever, there are a number of small details that I’d like to highlight:</p>

<ul>
  <li>Whilst adding extra platforms didn’t take that long from a development point of view, it massively increased the amount of time preparing for App Store submission as I had to create a lot more screenshots, text, etc. Trying to work out the best way to show PiP on macOS was an <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/chaise-longue-macos-pip.png">interesting challenge</a>! It was also difficult to work out a way to <a href="https://bendodson.s3.amazonaws.com/dodo/chaise-longue-to-5k-pip.jpg">show it on tvOS</a> without using copyrighted video content.</li>
  <li>A nice side effect of using the same bundle identifier for all three versions of the app (Apple TV, iOS/iPadOS, Mac) is that if you buy it on one platform you get it on all of them! As I’m selling it for £1.79 currently, that makes it a pretty sweet deal…</li>
  <li>I spent quite a lot of time on a little animation effect that happens when you first complete a 5K run. Confetti in front of and behind a real time blur that animates seamlessly. <a href="https://twitter.com/bendodson/status/1543969870810857477">Beautiful</a>.</li>
  <li>I’m really pleased with how the Apple TV app icon <a href="https://twitter.com/bendodson/status/1542450900622626819">came out</a> as I’m always a big fan of the parallax effects you can create. I found a very cheap designer on Fiverr who created a <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/chaise-longue-fiverr.png">first pass</a> and then I tweaked it to match my needs; I can’t draw to save my life but I can recompose and recolor objects pretty well!</li>
  <li>I was amazed that all of the Picture in Picture stuff just worked across all the platforms; I didn’t have to change any code whatsoever and whilst the videos were rendered from the tvOS app UI they look good on all platforms.</li>
  <li>Thanks to using <code class="language-plaintext highlighter-rouge">NSUbiquitousKeyValueStore</code> coupled with <code class="language-plaintext highlighter-rouge">.didChangeExternallyNotification</code>, completing a run on one device will see the UI automatically update on all other devices within seconds. No 3rd party frameworks or private data collection required!</li>
</ul>

<p>I’d love it if you would give <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">Chaise Longue to 5K</a> a try. It’s available now on tvOS 14 and above, iOS / iPadOS 14 and above, and macOS Big Sur (11.0) and above. One low price unlocks it across all platforms.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:wireframe" role="doc-endnote">
      <p>Here’s a <a href="https://twitter.com/bendodson/status/1542528144241856513/photo/1">rough drawing I did in Notes</a> compared with the <a href="https://twitter.com/bendodson/status/1542528144241856513/photo/2">final product</a>. <a href="#fnref:wireframe" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:chaisevideos" role="doc-endnote">
      <p>Even though there are 27 runs, that only equates to 12 videos as most weeks the three runs are identical so they can use the same video. Generating those on my M1 Ultra Mac Studio took less than 3 minutes and means I can easily update them should I want to update the UI in future. Each video is rendered at 720p and weighs in at around 3mb leaving the overall app size at under 40mb. <a href="#fnref:chaisevideos" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:cooldown" role="doc-endnote">
      <p>Which is defined as getting to the cool down section. <a href="#fnref:cooldown" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:catalyst" role="doc-endnote">
      <p>Views in Catalyst always seem to be of the “Regular / Regular” size regardless of what tiny windows you create so it isn’t possible to have the view seamlessly change between iPad and iPhone style sizes when resizing hence the need for a sensible minimum size. <a href="#fnref:catalyst" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:applewatchchaise" role="doc-endnote">
      <p>I did not bother porting the app to Apple Watch as there are loads of Couch to 5K apps that will serve you better on that platform; this app is predominantly about the Picture in Picture experience. <a href="#fnref:applewatchchaise" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	
</section>


<section id="pagination">
     
    	<a href="/weblog/page/2/" title="Previous Page" class="pagination-previous">&laquo; Older Entries</a>
     
	
    
</section>

		
		<footer>
			<p>I perform all freelance work through my company <strong>Dodo Apps Ltd</strong> (07856552) registered at The Bristol Office, 2nd Floor, 5 High Street, Westbury on Trym, Bristol, England, BS9 3BY</p>
		</footer>

	</div>


</body>
</html>