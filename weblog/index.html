<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	
	

	


	<link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'>
	<link rel="alternate" type="application/rss+xml" title="Ben Dodson, iOS Developer" href="https://bendodson.com/rss.xml" />
	<link rel="stylesheet" href="/styles-2023-01-18.css" />
	<link rel="stylesheet" href="/highlight-2018-02-23.css" />
	<link rel="icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/favicon.ico">
	<link rel="apple-touch-icon" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-iphone-retina.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://bendodson.s3.amazonaws.com/bendodson.com/touch-icon-ipad-retina.png">
	<title>Ben Dodson's Blog &mdash; Freelance Swift and Apple Platforms Developer</title>
</head>
<body>

	<div id="wrapper">

		<header>
			<hgroup>
				<h1><a href="/">Ben Dodson</a></h1>
				<h2>Freelance iOS, macOS, Apple Watch, and Apple TV Developer</h2>
			</hgroup>
			<nav>
				<ul>
					<li><a href="/">Home</a></li><li><a href="/weblog/">Blog</a></li><li><a href="/about/">About</a></li><li><a href="/clients/">Portfolio</a></li><li><a href="/apps/">My Apps</a></li><li><a href="/projects/">Projects</a></li><li><a href="/contact/">Contact</a></li>
				</ul>
				<div class="divider"></div>
			</nav>
		</header>

		<section id="posts">

	
	<article>
		<header>
     		
				<h1><a href="/weblog/2023/01/17/back-seat-shuffle/">Side Project: Back Seat Shuffle</a></h1>
			
			<time datetime="2023-01-17" pubdate=""><a href="/weblog/2023/01/17/back-seat-shuffle/">January 17, 2023</a></time>
    	</header>
    	<div>
			<p><span class="prelude">This is part of a <a href="/sideprojects/">series of blog posts</a> in which I showcase some of the side projects I work on for my own use. As with all of my side projects, I‚Äôm not focused on perfect code or UI; <a href="https://bendodson.s3.amazonaws.com/butitdoesrun.jpg">it just needs to run</a>!</span></p>

<p>If I‚Äôm going on a long drive with my two young children, I‚Äôll load up an iPad with some videos and stick it in a pouch on the back of a seat to keep them entertained. Initially this started as a few films and a couple of their TV series on a USB-C stick but I‚Äôve gradually started putting a few shows directly onto the iPad so they can be played via VLC. Why? Well, when using an external drive you‚Äôre limited to using the Files app which uses Quick View for video playback; this is fine for a film but for TV you have to go and start a new episode after the previous one finishes (and that involves my wife precariously leaning into the back without a seatbelt which isn‚Äôt ideal). I moved to using VLC for TV shows as they then play sequentially avoiding that problem but it can‚Äôt play from an external drive so I have to put things directly onto the limited storage of the device.</p>

<p>For a couple of weeks I‚Äôve been toying with the idea of whether I could build a better app, one that would let me:</p>

<ul>
  <li>Plug in an external drive</li>
  <li>Show each series with a nice image</li>
  <li>Play episodes randomly without needing to copy the video to the device</li>
</ul>

<p>After a 3 hour drive to visit my mother, the priority for this has now increased exponentially üòÇ</p>

<p>To begin with, I needed to know if it is even possible to view external files within an app on iOS. It is, and has been since the introduction of <code class="language-plaintext highlighter-rouge">UIDocumentPickerViewController</code> in iOS 13 however the documentation left me a little confused:</p>

<blockquote>
  <p>Both the open and export operations grant access to documents outside your app‚Äôs sandbox. This access gives users an unprecedented amount of flexibility when working with their documents. However, it also adds a layer of complexity to your file handling. External documents have the following additional requirements:</p>

  <ul>
    <li>The open and move operations provide security-scoped URLs for all external documents. Call the startAccessingSecurityScopedResource() method to access or bookmark these documents, and the stopAccessingSecurityScopedResource() method to release them. If you‚Äôre using a UIDocumentsubclass to manage your document, it automatically manages the security-scoped URL for you.</li>
    <li>Always use file coordinators (see NSFileCoordinator) to read and write to external documents.</li>
    <li>Always use a file presenter (see NSFilePresenter) when displaying the contents of an external document.</li>
    <li>Don‚Äôt save URLs that the open and move operations provide. You can, however, save a bookmark to these URLs after calling startAccessingSecurityScopedResource() to ensure you have access. Call the bookmarkData(options:includingResourceValuesForKeys:relativeTo:) method and pass in the withSecurityScope option, creating a bookmark that contains a security-scoped URL.</li>
  </ul>
</blockquote>

<p>External files can only be accessed via a security-scoped URL and all of the tutorials I‚Äôd seen online relating to this were demonstrating how you could access a file and then copy it locally before removing that scope. I was therefore unsure how it would work in terms of streaming video (as it would go out of scope and lose security clearance) nor if I‚Äôd be able to retain access after displaying a directory and then wanting to start playback.</p>

<p>It turns out that it is all possible using a system known as ‚Äúbookmarks‚Äù. In practice, a user will be shown their external drive in an OS controlled modal view and can select a folder, the URL of which is returned to my app. I then call the ‚Äústart accessing security scoped resource‚Äù and convert that URL to a bookmark which is stored locally on my device and then close the security scoped resource. That bookmark can be used at any point to gain access to the drive (so long as it hasn‚Äôt been disconnected in which case the bookmark tells the app it is ‚Äústale‚Äù and therefore no longer working) and you can then interact with the URL the bookmark provides in the same way as you would with a local file.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">func</span> <span class="nf">documentPicker</span><span class="p">(</span><span class="n">_</span> <span class="nv">controller</span><span class="p">:</span> <span class="kt">UIDocumentPickerViewController</span><span class="p">,</span> <span class="n">didPickDocumentsAt</span> <span class="nv">urls</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">urls</span><span class="o">.</span><span class="n">first</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="c1">// make sure we stop accessing the resource once we exit scope (which will be as soon as the video starts playing)</span>
    <span class="k">defer</span> <span class="p">{</span> <span class="n">url</span><span class="o">.</span><span class="nf">stopAccessingSecurityScopedResource</span><span class="p">()</span> <span class="p">}</span>

    <span class="c1">// we don't care about the return value for this as we'll try to create a bookmark anyway</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="nf">startAccessingSecurityScopedResource</span><span class="p">()</span>

    <span class="c1">// store the bookmark data locally or silently fail</span>
    <span class="n">bookmark</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">url</span><span class="o">.</span><span class="nf">bookmarkData</span><span class="p">()</span>

    <span class="c1">// try to play the video; if there is an error, display an alert</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">try</span> <span class="nf">playVideos</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">controller</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Error"</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">,</span> <span class="nv">preferredStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">alert</span><span class="p">)</span>
        <span class="n">controller</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"OK"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">))</span>
        <span class="nf">present</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">playVideos</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">bookmark</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

    <span class="c1">// get the local url from our bookmark; if the bookmark is stale (i.e. access has expired), then return</span>
    <span class="k">var</span> <span class="nv">stale</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="k">let</span> <span class="nv">directoryUrl</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">resolvingBookmarkData</span><span class="p">:</span> <span class="n">bookmark</span><span class="p">,</span> <span class="nv">bookmarkDataIsStale</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">stale</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="n">directoryUrl</span><span class="o">.</span><span class="n">path</span>
    <span class="k">guard</span> <span class="o">!</span><span class="n">stale</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">BSSError</span><span class="o">.</span><span class="n">staleBookmark</span>
    <span class="p">}</span>

    <span class="c1">// get the contents of the folder; only return mp4 and mkv files; if no files, throw an error</span>
    <span class="k">let</span> <span class="nv">contents</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">contentsOfDirectory</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">urls</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">"mp4"</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">"mkv"</span><span class="p">)</span> <span class="p">})</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">filePath</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="k">guard</span> <span class="n">urls</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">BSSError</span><span class="o">.</span><span class="n">noFiles</span>
    <span class="p">}</span>

    <span class="c1">// present the video player with the videos in a random order</span>
    <span class="nf">presentPlayer</span><span class="p">(</span><span class="n">urls</span><span class="o">.</span><span class="nf">shuffled</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">func</span> <span class="nf">presentPlayer</span><span class="p">(</span><span class="n">_</span> <span class="nv">urls</span><span class="p">:</span> <span class="p">[</span><span class="kt">URL</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// set the audio session so video audio is heard even if device is muted</span>
    <span class="k">try</span><span class="p">?</span> <span class="kt">AVAudioSession</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()</span><span class="o">.</span><span class="nf">setCategory</span><span class="p">(</span><span class="o">.</span><span class="n">playback</span><span class="p">)</span>

    <span class="c1">// create a queue of player items from the provided urls</span>
    <span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="n">urls</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">AVPlayerItem</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">player</span> <span class="o">=</span> <span class="kt">AVQueuePlayer</span><span class="p">(</span><span class="nv">items</span><span class="p">:</span> <span class="n">items</span><span class="p">)</span>

    <span class="c1">// present the player</span>
    <span class="k">let</span> <span class="nv">playerController</span> <span class="o">=</span> <span class="kt">AVPlayerViewController</span><span class="p">()</span>
    <span class="n">playerController</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
    <span class="nf">present</span><span class="p">(</span><span class="n">playerController</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">player</span><span class="p">?</span><span class="o">.</span><span class="nf">play</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This would also work in other contexts such as local files or even cloud-based services that work with the Files app such as iCloud or Dropbox.</p>

<p>I had originally planned on reading the contents of the USB stick and using a single .jpg file in each directory to render a nice thumbnail. In the end I abandoned that as it would have meant building the whole interface when in fact it works perfectly well just using <code class="language-plaintext highlighter-rouge">UIDocumentPickerViewController</code> to pick the show I‚Äôm interested in:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2023/back-seat-shuffle-sandd.gif" width="800" height="559" />
    <figure>Selecting a directory of videos in Back Seat Shuffle</figure>
</div>

<p>In the end the only extra code I added was to strip out any files that were not in the .mp4 or .mkv format and to have it automatically return to the file selection screen once the full queue of randomised videos had finished.</p>

<p>Whilst I could potentially put it on the App Store, this is one of those weird edge cases that likely wouldn‚Äôt get through App Review as they‚Äôll look at it and say ‚Äúthis is just the Files app‚Äù and completely miss the point. As this would be a free app, it‚Äôs not worth the hassle of doing screenshots, App Store description, etc, only to have it be rejected by App Review.</p>

<p>The full app code is available on <a href="https://github.com/bendodson/back-seat-shuffle">GitHub</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/12/15/return-to-dark-tower-assistant/">Return to Dark Tower Assistant</a></h1>
			
			<time datetime="2022-12-15" pubdate=""><a href="/weblog/2022/12/15/return-to-dark-tower-assistant/">December 15, 2022</a></time>
    	</header>
    	<div>
			<p><a href="https://restorationgames.com/return-to-dark-tower/">Return to Dark Tower</a> is a really cool app-driven board game that comes with a physical tower that you connect via Bluetooth to an iPad. The tower lights up, makes sounds, and spins internally to shoot little skulls you place into it over the outlying map.</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/return-to-dark-tower.jpg" width="800" height="600" />
    <figure>You put little skulls in the top of the tower to end your turn...</figure>
</div>

<p>As much as I love it, there are a ton of cards in the game so you can easily forget what abilities you have available to you or miss crucial triggers at key phases in the game. You can also take most actions in any order so it‚Äôs easy to forget what you‚Äôve done in the current turn, especially if you‚Äôre playing solo. To that end, I built myself a very niche app to keep track of all of the cards I had and all of the moves I‚Äôd made. It‚Äôs called <a href="https://apps.apple.com/us/app/return-to-dark-tower-assistant/id1659406816">Return to Dark Tower Assistant</a> and is optimised for use in an iPad Slide Over panel so you can use it on top of the app you use to run the game:</p>

<div class="gofigure">
    <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/rtdta.jpg" width="800" height="600" />
    <figure>Running the assistant in a Slide Over panel so you can still access the board game app beneath!</figure>
</div>

<p>There‚Äôs a very slim chance that any of you reading this have a copy of this board game and even if you do it‚Äôs likely a small minority that would find utility in this app. That said, I think it demonstrates what I‚Äôve said for over a decade about making apps for yourself; build things for yourself on the off-chance that somebody else finds it as useful as you do. I spent far too much time matching the colours to the player boards, getting the fonts just right, and doing things like perfectly embedding the right icons for warrior and spirit tokens but I did that because I want it to look good when <em>I‚Äôm</em> playing. It will likely only get single-digit downloads, but it‚Äôs an app I‚Äôm proud of.</p>

<p>The assistant is available now on the <a href="https://apps.apple.com/us/app/return-to-dark-tower-assistant/id1659406816">App Store</a>. You can also read more about it on my <a href="https://dodoapps.io/return-to-dark-tower-assistant/">Dodo Apps website</a>.</p>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/12/08/stream-deck-ios-development/">Using a Stream Deck for iOS development</a></h1>
			
			<time datetime="2022-12-08" pubdate=""><a href="/weblog/2022/12/08/stream-deck-ios-development/">December 08, 2022</a></time>
    	</header>
    	<div>
			<p>The <a href="https://www.elgato.com/en/stream-deck">Elgato Stream Deck</a> is a fun device with 15 LED buttons that can be programmed to do whatever you want through an app that runs on PC and Mac. It was designed for streamers to be able to quickly switch scenes or present overlays but it has quickly become popular in other areas thanks to its flexible design. I picked one up in 2018 when I was dabbling with streaming but then mostly used it as control box for my Cessna 152 in Flight Simulator 2020 thanks to <a href="https://flightdeck.to/product/flightdeck/">FlightDeck</a>. I eventually replaced this with a bigger flight sim setup<sup id="fnref:flightsim" role="doc-noteref"><a href="#fn:flightsim" class="footnote" rel="footnote">1</a></sup> so the Stream Deck was sitting idle until I had the idea to integrate it into my app development workflow.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-mac-studio.jpg" width="800" height="450" />
    <figure>The Stream Deck running alongside my Mac Studio.</figure>
</div>

<p>I typically work on multiple projects per day as I have a number of active client projects at any one time along with my own independent apps. This means I often waste time getting set up for each project so my initial idea was to have a single button press to get my workspace configured.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-start.jpg" width="400" height="250" />
    <figure>A single button per platform to start a project.</figure>
</div>

<p>For example, I may want to start a specific Toggl timer, open a Jira board, and open the Xcode project. To do this, I created a single AppleScript file that is opened by the Stream Deck that will look something like this:</p>

<figure class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"Timery"</span><span class="w">
	</span><span class="nb">activate</span><span class="w">
	</span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">keystroke</span><span class="w"> </span><span class="s2">"1"</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="nv">command</span><span class="w"> </span><span class="nv">down</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">

</span><span class="nb">do shell script</span><span class="w"> </span><span class="s2">"open https://example.com/jira-board/"</span><span class="w">

</span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">tell</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="s2">"Safari"</span><span class="w">
	</span><span class="k">set</span><span class="w"> </span><span class="na">frontmost</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">true</span><span class="w">
	</span><span class="k">if</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Move to DELL P2415Q"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Window"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nb">exists</span><span class="w"> </span><span class="k">then</span><span class="w">
		</span><span class="nv">click</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Move to DELL P2415Q"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Window"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="mi">1</span><span class="w">
	</span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
	</span><span class="k">set</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">attribute</span><span class="w"> </span><span class="s2">"AXFullScreen"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">window</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">true</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">

</span><span class="nb">do shell script</span><span class="w"> </span><span class="s2">"open ~/Files/Clients/UKTV/iOS/App\\ Files/UKTV.xcodeproj"</span></code></pre></figure>

<p>In the first block I activate the Timery app and tell it to perform the keyboard shortcut ‚åò+<em>n</em> where <em>n</em> is the project as it appears in Timery‚Äôs list. This will start a timer going for the project so I can track my time. I typically only use this for clients that I‚Äôm working with on a large project or have a regular maintenance contract with; for smaller ad hoc work I‚Äôll instead throw an alert to remind me to start a timer manually.</p>

<p>The second block will open a URL in Safari to any website I might find relevant. This is typically a Jira or Trello board but can sometimes be to some API documentation, a GitHub issue pages, or even a local URL to open up a list in Things.</p>

<p>The third block is very specific to my hardware setup. I have an ultrawide monitor that I use as my primary display and then a 4K Dell monitor in portrait orientation to the side that I typically use for browsing and iOS simulators. This code tells Safari to move to that portrait monitor and then switch to full screen mode.</p>

<p>The final line opens up the Xcode project. I usually work in fullscreen mode on my primary monitor so it‚Äôll typically move to a new space automatically without me needing to program that in.</p>

<p>With this simple script, I can press a single button to get everything configured. It‚Äôs probably only saving me 20 seconds of time but psychologically it lets me jump immediately into a project.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-finder.jpg" width="400" height="250" />
    <figure>Opening a project directory.</figure>
</div>

<p>Another minor hassle I encounter on a daily basis is opening up the directory where all of a project‚Äôs files are stored. I‚Äôll typically do this if I need to look at some artwork I‚Äôve saved or some documentation so I have a very simple script to open up the current project directory:</p>

<figure class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="nb">do shell script</span><span class="w"> </span><span class="s2">"open ~/Files/Clients/UKTV/"</span></code></pre></figure>

<p>This is again a psychological improvement as I hate wasting time digging down through Finder to get to the location I need.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-build.jpg" width="400" height="250" />
    <figure>Building and exporting iOS / tvOS apps.</figure>
</div>

<p>So far I‚Äôve only made minor improvements to my productivity but this last button saves me a huge amount of time; automated building. Whilst many developers will handle this task with some form of Continuous Integration or using the new Xcode Cloud feature, this typically doesn‚Äôt work well for me due to the number of projects I‚Äôm involved with at any one time. Instead, I use <a href="https://fastlane.tools">Fastlane</a> to perform a wide array of tasks at once such as increasing build numbers, pushing to GitHub, building, and uploading to TestFlight.</p>

<p>Here is a typical Fastfile<sup id="fnref:fastfile" role="doc-noteref"><a href="#fn:fastfile" class="footnote" rel="footnote">2</a></sup> for one of my client projects:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Config</span>
<span class="n">xcode_version</span> <span class="o">=</span> <span class="s2">"14.1.0"</span>
<span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"UKTV"</span><span class="p">,</span> <span class="s2">"NotificationServiceExtension"</span><span class="p">]</span>
<span class="n">git_remote</span> <span class="o">=</span> <span class="s2">"origin/main"</span>

<span class="c1"># Import shared Fastfile</span>
<span class="n">import</span> <span class="s2">"~/Files/Scripts/SharedFastfile.rb"</span>

<span class="n">lane</span> <span class="ss">:distribute</span> <span class="k">do</span>

  <span class="n">ensure_git_status_clean</span><span class="p">()</span>

  <span class="n">xcode_select</span><span class="p">(</span><span class="s2">"/Applications/Xcode-"</span> <span class="o">+</span> <span class="n">xcode_version</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">)</span>

  <span class="n">shared_increase_version</span><span class="p">(</span>
    <span class="ss">targets: </span><span class="n">targets</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">","</span><span class="p">),</span>
    <span class="ss">push_to: </span><span class="n">git_remote</span>
  <span class="p">)</span>

  <span class="n">version</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"shared-tmp.txt"</span><span class="p">)</span>
  <span class="no">UI</span><span class="p">.</span><span class="nf">important</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

  <span class="n">build_app</span><span class="p">(</span>
    <span class="ss">output_directory: </span><span class="s2">"builds"</span><span class="p">,</span>
    <span class="ss">output_name: </span><span class="n">version</span>
  <span class="p">)</span>

  <span class="n">upload_to_testflight</span><span class="p">(</span>
    <span class="ss">ipa: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">".ipa"</span><span class="p">,</span>
    <span class="ss">skip_submission: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">skip_waiting_for_build_processing: </span><span class="kp">true</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="n">upload_symbols_to_crashlytics</span><span class="p">(</span><span class="ss">dsym_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">".app.dSYM.zip"</span><span class="p">,</span> <span class="ss">binary_path: </span><span class="s1">'scripts/upload-symbols'</span><span class="p">)</span>

<span class="k">end</span></code></pre></figure>

<p>To start with I specify the Xcode version I want to use, the targets of the project, and the name of the remote git repository. I then import a Ruby file which I‚Äôll come to shortly.</p>

<p>The only lane is <code class="language-plaintext highlighter-rouge">distribute</code> and the first check is to ensure the Git repository is clean. If there are any uncommitted changes, the script will exit out and present an error. I then select the correct version of Xcode<sup id="fnref:xcode" role="doc-noteref"><a href="#fn:xcode" class="footnote" rel="footnote">3</a></sup>.</p>

<p>The next section includes a <code class="language-plaintext highlighter-rouge">shared_increase_version()</code> function which comes from the imported Ruby file:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">##</span>
<span class="c1"># INCREASE_VERSION</span>
<span class="c1"># </span>
<span class="c1"># Prompts the user for a version number. If new provided, update all targets and reset</span>
<span class="c1"># builder number to 1. Otherwise, just bump the build number.</span>

<span class="n">private_lane</span> <span class="ss">:shared_increase_version</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>

  <span class="c1"># Fetch all targets as comma-separated string and convert to array</span>
  <span class="k">if</span> <span class="o">!</span><span class="n">options</span><span class="p">[</span><span class="ss">:targets</span><span class="p">]</span>
    <span class="no">UI</span><span class="p">.</span><span class="nf">user_error!</span><span class="p">(</span><span class="s2">"You must provide at least one target in 'targets'"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">targets</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:targets</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span>

  <span class="c1"># Fetch current version using default Fastlane action with the first target</span>
  <span class="n">version</span> <span class="o">=</span> <span class="n">get_version_number</span><span class="p">(</span><span class="ss">target: </span><span class="n">targets</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

  <span class="c1"># Prompt for new marketing version</span>
  <span class="n">new_version</span> <span class="o">=</span> <span class="no">UI</span><span class="p">.</span><span class="nf">input</span><span class="p">(</span><span class="s2">"New marketing version? &lt;press enter to keep it at v</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">&gt;"</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">new_version</span><span class="p">.</span><span class="nf">strip</span> <span class="o">==</span> <span class="s2">""</span>
    <span class="c1"># No change to version so just increase build number</span>
    <span class="n">increment_build_number</span><span class="p">()</span> 
  <span class="k">else</span>
    <span class="c1"># Loop through each target and increment version number with "versioning" plugin</span>
    <span class="c1"># The native 'increment_version_number' action does not work with recent versions of Xcode</span>
    <span class="n">targets</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span>
      <span class="n">increment_version_number_in_plist</span><span class="p">(</span><span class="ss">version_number: </span><span class="n">new_version</span><span class="p">,</span> <span class="ss">target: </span><span class="n">target</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">new_version</span>

    <span class="c1"># Set build number to 1 using default Fastlane action (shows a warning about ${SRCROOT} but it does work)</span>
    <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:alwaysIncrementBuildNumber</span><span class="p">]</span>
      <span class="n">increment_build_number</span><span class="p">()</span>
    <span class="k">else</span> 
      <span class="n">increment_build_number</span><span class="p">(</span><span class="ss">build_number: </span><span class="mi">1</span><span class="p">)</span>  
    <span class="k">end</span>
    
  <span class="k">end</span>

  <span class="c1"># Fetch build number</span>
  <span class="n">build_number</span> <span class="o">=</span> <span class="n">get_build_number</span><span class="p">()</span>

  <span class="c1"># Write the new version number to the shared-tmp.txt file so calling lane can pick it up</span>
  <span class="c1"># This is a limitation of Fastlane not being able to return values in a shared lane</span>
  <span class="n">version_string</span> <span class="o">=</span> <span class="s2">"v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">"-b"</span> <span class="o">+</span> <span class="n">build_number</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">"shared-tmp.txt"</span><span class="p">,</span> <span class="n">version_string</span><span class="p">)</span>

  <span class="c1"># Message to the user to show the new version and build number</span>
  <span class="no">UI</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="s2">"App Version Updated: v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">" (build "</span> <span class="o">+</span> <span class="n">build_number</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">)</span>

  <span class="c1"># If there is no git remote to push to, then exit the lane</span>
  <span class="k">if</span> <span class="o">!</span><span class="n">options</span><span class="p">[</span><span class="ss">:push_to</span><span class="p">]</span> <span class="o">||</span> <span class="n">options</span><span class="p">[</span><span class="ss">:push_to</span><span class="p">].</span><span class="nf">strip</span> <span class="o">==</span> <span class="s2">""</span>
    <span class="no">UI</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="s2">"Skipping git"</span><span class="p">)</span>
    <span class="k">next</span>
  <span class="k">end</span>

  <span class="c1"># Commit the version change</span>
  <span class="n">commit_version_bump</span><span class="p">(</span><span class="ss">message: </span><span class="s2">"v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">" (build "</span> <span class="o">+</span> <span class="n">build_number</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">,</span> <span class="ss">force: </span><span class="kp">true</span><span class="p">)</span>

  <span class="c1"># Add a git tag in the format "builds/v1.1-b3"</span>
  <span class="n">add_git_tag</span><span class="p">(</span><span class="ss">includes_lane: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">prefix: </span><span class="s2">"v"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">"-b"</span><span class="p">,</span> <span class="ss">build_number: </span><span class="n">build_number</span><span class="p">)</span>

  <span class="c1"># Push to specified remote</span>
  <span class="n">git_remote</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:push_to</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
  <span class="n">remote</span> <span class="o">=</span> <span class="n">git_remote</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">branch</span> <span class="o">=</span> <span class="n">git_remote</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">push_to_git_remote</span><span class="p">(</span><span class="ss">remote: </span><span class="n">remote</span><span class="p">,</span> <span class="ss">remote_branch: </span><span class="n">branch</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>I won‚Äôt go through this line by line but the basic idea is that it will prompt me to ask whether this is a new version of the app or a new build; if the former, the version is updated to the one specified and the build number set to 1 across all targets; if the latter, then I just bump the build number. Once that is done, a version string is created that looks something like <em>v1.2.3-b2</em> which I will use later in the workflow; this string is saved to a temporary file so the original Fastfile can reference it.</p>

<p>With the version and build number updated, the script then commits the changes to Git, tags them, and pushes them to the remote branch if one was specified.</p>

<p>The code resumes in the Fastfile with an Xcode build command (which stores the build and it‚Äôs dSYMs in a local directory), an upload to TestFlight, and the uploading of the dSYMs to the Crashlytics service.</p>

<p>With this system in place, I can press one button to have the entire build process execute in the background. This is hugely important to me as I can start work on another project whilst this process plays out; on the Mac Studio I don‚Äôt even notice anything is happening as the build process doesn‚Äôt come close to maxing out the CPU.</p>

<p>The nice thing about this Fastlane system is that I can make it bespoke for projects that need something a little different. Here, for example, is the file for a Catalyst project I work on:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Config</span>
<span class="n">xcode_version</span> <span class="o">=</span> <span class="s2">"14.1.0"</span>
<span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ATPDigital7"</span><span class="p">]</span>
<span class="n">git_remote</span> <span class="o">=</span> <span class="s2">"origin/master"</span>

<span class="c1"># Import shared Fastfile</span>
<span class="n">import</span> <span class="s2">"~/Files/Scripts/SharedFastfile.rb"</span>

<span class="c1">##</span>
<span class="c1"># LANES</span>
<span class="c1">##</span>

<span class="n">lane</span> <span class="ss">:distribute</span> <span class="k">do</span>

  <span class="n">xcode_select</span><span class="p">(</span><span class="s2">"/Applications/Xcode-"</span> <span class="o">+</span> <span class="n">xcode_version</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">)</span>

  <span class="n">ensure_git_status_clean</span><span class="p">()</span>

  <span class="n">shared_increase_version</span><span class="p">(</span>
    <span class="ss">targets: </span><span class="n">targets</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">","</span><span class="p">),</span>
    <span class="ss">push_to: </span><span class="n">git_remote</span><span class="p">,</span>
    <span class="ss">alwaysIncrementBuildNumber: </span><span class="kp">true</span>
  <span class="p">)</span>

  <span class="nb">system</span><span class="p">(</span><span class="s2">"git push helastel HEAD:develop"</span><span class="p">)</span>

  <span class="n">version</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"shared-tmp.txt"</span><span class="p">)</span>
  <span class="no">UI</span><span class="p">.</span><span class="nf">important</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

  <span class="n">ios_export</span> <span class="o">=</span> <span class="s2">"ios-"</span> <span class="o">+</span> <span class="n">version</span>
  <span class="n">mac_export</span> <span class="o">=</span> <span class="s2">"mac-"</span> <span class="o">+</span> <span class="n">version</span>

  <span class="c1"># Build the macOS app</span>
  <span class="n">build_app</span><span class="p">(</span>
    <span class="ss">catalyst_platform: </span><span class="s2">"macos"</span><span class="p">,</span>
    <span class="ss">output_directory: </span><span class="s2">"builds"</span><span class="p">,</span>
    <span class="ss">output_name: </span><span class="n">mac_export</span>
  <span class="p">)</span>

  <span class="c1"># Rename the macOS app export to mac-v1.0-b1.app</span>
  <span class="no">FileUtils</span><span class="p">.</span><span class="nf">mv</span><span class="p">(</span><span class="s2">"../builds/ATPdigital 8.app"</span><span class="p">,</span> <span class="s2">"../builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">)</span>

  <span class="c1"># Zip the macOS app and then upload it to S3</span>
  <span class="n">zip</span><span class="p">(</span>
    <span class="ss">path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".app"</span><span class="p">,</span>
    <span class="ss">output_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".zip"</span>
  <span class="p">)</span>
  <span class="n">s3_upload</span><span class="p">(</span>
    <span class="ss">access_key_id: </span><span class="s2">"IMNOTTHATSILLY"</span><span class="p">,</span>
    <span class="ss">secret_access_key: </span><span class="s2">"Uhuhuhyoudidntsaythemagicword"</span><span class="p">,</span>
    <span class="ss">bucket: </span><span class="s2">"bucketname"</span><span class="p">,</span>
    <span class="ss">content_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".zip"</span><span class="p">,</span>
    <span class="ss">name: </span><span class="s2">"clients/bgs/builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".zip"</span>
  <span class="p">)</span>

  <span class="c1"># Build the iOS app</span>
  <span class="n">build_app</span><span class="p">(</span>
    <span class="ss">catalyst_platform: </span><span class="s2">"ios"</span><span class="p">,</span>
    <span class="ss">output_directory: </span><span class="s2">"builds"</span><span class="p">,</span>
    <span class="ss">output_name: </span><span class="n">ios_export</span>
  <span class="p">)</span>

  <span class="n">upload_symbols_to_crashlytics</span><span class="p">(</span><span class="ss">dsym_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".app.dSYM.zip"</span><span class="p">,</span> <span class="ss">binary_path: </span><span class="s1">'scripts/upload-symbols'</span><span class="p">)</span>
  <span class="n">upload_symbols_to_crashlytics</span><span class="p">(</span><span class="ss">dsym_path: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">ios_export</span> <span class="o">+</span> <span class="s2">".app.dSYM.zip"</span><span class="p">,</span> <span class="ss">binary_path: </span><span class="s1">'scripts/upload-symbols'</span><span class="p">)</span>

  <span class="c1"># Upload macOS app to TestFlight</span>
  <span class="n">upload_to_testflight</span><span class="p">(</span>
    <span class="ss">pkg: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">mac_export</span> <span class="o">+</span> <span class="s2">".pkg"</span><span class="p">,</span>
    <span class="ss">skip_submission: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">skip_waiting_for_build_processing: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">app_platform: </span><span class="s2">"osx"</span>
  <span class="p">)</span>

  <span class="c1"># Upload iOS app to TestFlight</span>
  <span class="n">upload_to_testflight</span><span class="p">(</span>
    <span class="ss">ipa: </span><span class="s2">"builds/"</span> <span class="o">+</span> <span class="n">ios_export</span> <span class="o">+</span> <span class="s2">".ipa"</span><span class="p">,</span>
    <span class="ss">skip_submission: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">skip_waiting_for_build_processing: </span><span class="kp">true</span><span class="p">,</span>
  <span class="p">)</span>

<span class="k">end</span></code></pre></figure>

<p>This one is a lot more involved but the basic steps are very similar:</p>

<ol>
  <li>Set up the configuration that is needed</li>
  <li>Select Xcode, check the repo is clean, and bump the version number</li>
  <li>Do another Git push to a different repo</li>
  <li>Build the macOS version of the app, zip it, and upload it to an Amazon S3 instance</li>
  <li>Build the iOS version of the app</li>
  <li>Upload the dSYMs to Crashlytics for both versions</li>
  <li>Upload each version to TestFlight</li>
</ol>

<p>The process typically takes about 20 minutes to run but would take longer if I were doing it manually as there are multiple points that would require user interaction. That I can press one button and have this run seamlessly in the background is of huge benefit to me, especially if I‚Äôm doing multiple builds in a single day.</p>

<p>I also have a client that has 6 apps that all come from the same codebase. Again, I can press one button and have all 6 of those apps compiled and uploaded; it also automatically submits each app to the App Store once the builds have finished processing!</p>

<p>I‚Äôm planning on extending this further in the future as I create a HTML page for some clients which gives a changelog for each build based on the commit messages. At the moment I do this manually but I could easily automate that with AppleScript and hook it into this process.</p>

<div class="gofigure">
	<img src="https://bendodson.s3.amazonaws.com/weblog/2022/stream-deck-stop.jpg" width="400" height="250" />
    <figure>My Stream Deck homescreen</figure>
</div>

<p>The final thing to mention is the Stream Deck homescreen itself. I have a folder for each project denoted by their app icon which then goes into the start / build commands detailed above. There is also a STOP button will stop any Toggl timer that is currently running and a sleep button that will turn off the Stream Deck display.</p>

<p>I have been incredibly impressed with the Stream Deck as an input device and think it can be an incredibly valuable tool for any app developer that works on multiple projects. All of the above can be achieved by just running an AppleScript file (as that is what the Stream Deck is doing) but I find the tactile nature of the device to be incredibly rewarding and I know there is a ton more I‚Äôm going to do with it over time.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:flightsim" role="doc-endnote">
      <p>The <a href="https://flyhoneycomb.com/products/bravo-throttle-quadrant">Bravo Throttle Quadrant</a> has physical buttons on it for dealing with auto pilot settings and flaps which were my main use cases with FlightDeck.¬†<a href="#fnref:flightsim" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:fastfile" role="doc-endnote">
      <p>All of the magic works in the Fastfile but the Stream Deck still needs to be able to start the command so I use an AppleScript to open Terminal and kick off <code class="language-plaintext highlighter-rouge">fastlane distribute</code> in the correct directory.¬†<a href="#fnref:fastfile" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:xcode" role="doc-endnote">
      <p>I have 3-4 versions of Xcode installed at any one time as different clients will be on different release schedules so I may still need to build something with an older version. I‚Äôll likely change this portion of the script to always use the latest version unless I manually specify one as it‚Äôs a pain to edit my script files whenever a new Xcode update comes out.¬†<a href="#fnref:xcode" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/11/21/the-dodo-developer/">The Dodo Developer</a></h1>
			
			<time datetime="2022-11-21" pubdate=""><a href="/weblog/2022/11/21/the-dodo-developer/">November 21, 2022</a></time>
    	</header>
    	<div>
			<p>For the past few months I‚Äôve been meaning to start a newsletter; partially as a way of motivating me to finish some of my many projects, partially as a way of building up a mailing list so I can market my own apps better. The priority for this has only increased as the long-term future for Twitter (my main source of referrals to my various apps and websites) has moved to shakier ground<sup id="fnref:twitterpessimism" role="doc-noteref"><a href="#fn:twitterpessimism" class="footnote" rel="footnote">1</a></sup>.</p>

<p>Today I finally took that step by creating <em><a href="https://www.thedododeveloper.com/">The Dodo Developer</a></em><sup id="fnref:dododeveloper" role="doc-noteref"><a href="#fn:dododeveloper" class="footnote" rel="footnote">2</a></sup> on Substack.</p>

<iframe src="https://www.thedododeveloper.com/embed" width="100%" height="320" style="border:1px solid #EEE; background: white; margin: 0 auto; display: block; border-radius: 16px;" frameborder="0" scrolling="no"></iframe>

<p>I‚Äôve created an <a href="https://www.thedododeveloper.com/p/1-the-setup">initial introductory post</a> going through some of the motivations for this move and listing some of the items on my ‚ÄúTo do‚Äù list but the aim is to produce a new issue every 2 weeks.</p>

<p>I like to use my main website for either announcing new releases or providing code-level tutorials; the newsletter will be slightly different in that it will be showcasing things <em>way</em> before they are necessarily ready for prime time. This has two main benefits in that working akin to a 2-week sprint cycle will hopefully motivate me to proceed with the numerous app ideas that are half-finished on my hard drive; on the flip side, it will also hopefully generate some much needed feedback during the development process as I‚Äôm planning to invite subscribers to early access betas of new apps and major updates to existing apps. This all begins next week when I‚Äôll be going into detail with the <a href="https://itunes.apple.com/us/app/music-tracker-automatic-tracking/id1062583712?ls=1&amp;mt=8">Music Library Tracker</a> upgrade that introduces Spatial Audio matching as well as showing off a new dice-based game mechanic I‚Äôve created for a ‚ÄúChoose your own Adventure‚Äù style game.</p>

<p>As we head into 2023 I‚Äôm determined to try and spend more of my time on my independent projects. By subscribing to the newsletter, you‚Äôll be directly boosting my motivation towards that aim and hopefully getting an insight into how a developer forms an idea into a digital reality.</p>

<p>I‚Äôll be landing in your inbox for the first issue next week!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:twitterpessimism" role="doc-endnote">
      <p>I don‚Äôt necessarily share the pessimism of others with regards to Twitter‚Äôs future but there is a non-zero chance that it shuts down without warning one night in the near future so best to be prepared. I won‚Äôt be moving to any other social media network.¬†<a href="#fnref:twitterpessimism" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:dododeveloper" role="doc-endnote">
      <p>I can‚Äôt remember if I‚Äôve mentioned my affinity for dodos on this blog before but the reason for the name comes from two things: my surname contains the same letters as ‚Äúdodo‚Äù and when I was at school I loved the dodo character in Disney‚Äôs <em>Alice in Wonderland</em> (‚Äúyou there, stop kicking that mackeral‚Äù). When I developed my first piece of software, a database system for the management of choral robes (honestly), I used ‚ÄúDodo Apps‚Äù as the name and it‚Äôs kind of stuck!¬†<a href="#fnref:dododeveloper" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/07/12/chaise-longue-to-5k/">'Chaise Longue to 5K' and porting a tvOS app built with UIKit to iOS, iPadOS, and macOS</a></h1>
			
			<time datetime="2022-07-12" pubdate=""><a href="/weblog/2022/07/12/chaise-longue-to-5k/">July 12, 2022</a></time>
    	</header>
    	<div>
			<p>A little while ago, my chiropractor recommended that I take up the ‚Äú<a href="https://www.nhs.uk/live-well/exercise/running-and-aerobic-exercises/get-running-with-couch-to-5k/">Couch to 5K</a>‚Äù program in order to improve my fitness in a way that wouldn‚Äôt see me literally running before I could walk. It was a huge success and I was able to lose a significant amount of weight and improve my overall health. Unfortunately, the 2020 lockdowns and the birth of a new child meant most of that effort was undone and I found myself once again needing to embark on a gradual increase in exercise.</p>

<p>One of the key features of Couch to 5K is that you do intermittent bursts of running and walking; for example, in the first week you‚Äôll do three runs consisting of alternating 60 seconds of running (x8) and 90 seconds of walking (x7) sandwiched between a 5 minute warm up and cool down. To keep track of this, I used the <a href="https://apps.apple.com/gb/app/one-you-couch-to-5k/id1082307672">free NHS Couch to 5K app</a> which tells you what to do at each stage via an audio voiceover which also offers encouragement throughout your run. This worked well for me as I listened to music whilst doing my runs, but nowadays I prefer to run whilst watching TV shows or YouTube videos on an Apple TV in front of my treadmill. For this use case, audio interruption wasn‚Äôt necessarily what I wanted, especially as I was already vaguely familiar with the different run timings. Instead, I wanted an app on my Apple TV that could show me my run progress in a Picture in Picture window.</p>

<p>Introducing ‚Äú<a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">Chaise Longue to 5K</a>‚Äù (after all, couches are <em>so</em> common):</p>

<div class="gofigure">
    <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">
        <img src="https://bendodson.s3.amazonaws.com/weblog/2022/chaise-longue-to-5k-niles.jpg" width="800" height="450" />
    </a>
    <figure>Frasier, the discerning runner's choice.</figure>
</div>

<p>The idea is straightforward enough; you open the app to a grid showing all of the available runs<sup id="fnref:wireframe" role="doc-noteref"><a href="#fn:wireframe" class="footnote" rel="footnote">1</a></sup> and then navigate to a fullscreen running page with a timer and coloured blocks that show what you should be doing. This can then be shrunk down into a Picture in Picture window so you can see the critical information whilst you watch something else.</p>

<p>Originally I‚Äôd planned to use the new <code class="language-plaintext highlighter-rouge">AVPictureInPictureController.init(contentSource:)</code> API that was introduced with tvOS 15.0 as that would allow me to fairly easily render the <code class="language-plaintext highlighter-rouge">UIView</code> of the run screen into the PiP window; unfortunately, there is a <a href="https://github.com/jazzychad/PiPBugDemo">bug with tvOS</a> which prevents that from working and is still present in the tvOS 16 betas.</p>

<p>My next plan was to have the app render a video of the run on the fly. Essentially I would display the running UI, snapshot it with <code class="language-plaintext highlighter-rouge">UIView.drawHierarchy(in rect: CGRect, afterScreenUpdates afterUpdates: Bool)</code>, and then pipe the <code class="language-plaintext highlighter-rouge">UIImage</code> into an <code class="language-plaintext highlighter-rouge">AVAssetWriter</code> at 1 second intervals to generate a video. Unfortunately that proved too intensive for the Apple TV hardware (especially the non-4K model) with the render taking a couple of minutes for each video. However, as I‚Äôd already built the render pipeline, I instead updated the system to generate all of the videos sequentially and store them; I then ran that in the tvOS Simulator to generate the 12 videos<sup id="fnref:chaisevideos" role="doc-noteref"><a href="#fn:chaisevideos" class="footnote" rel="footnote">2</a></sup> and then bundled them in the app. Much easier ü§£</p>

<p>The final part was to add a button to the top of the run selector page that would show you your next run. To do this, I store the week and number of the last run that was completed<sup id="fnref:cooldown" role="doc-noteref"><a href="#fn:cooldown" class="footnote" rel="footnote">3</a></sup> within <code class="language-plaintext highlighter-rouge">NSUbiquitousKeyValueStore</code>; this is a similar API to <code class="language-plaintext highlighter-rouge">UserDefaults</code> with the advantage that it is synced through the user‚Äôs iCloud account meaning it‚Äôll survive reinstallations or switching to a new Apple TV without restoring from backup.</p>

<p>However, that led to an interesting idea. Could I port this to other platforms? And if I could, would I be able to <a href="https://twitter.com/bendodson/status/1544599673943609345">do it in a single day</a>?</p>

<p>Yes.</p>

<div class="gofigure">  
    <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">
        <img src="https://bendodson.s3.amazonaws.com/dodo/chaise-longue-to-5k-sync.jpg" width="800" height="450" />
    </a>
</div>

<p>Despite using UIKit rather than SwiftUI, I was able to port everything over to iPhone, iPad, and Mac within 5 hours or so. I started by rejigging the project files so shared code would be separate from the xib files I use for the interface. I then added a new target for iOS and went through the laborious process of recreating the xib files; unfortunately tvOS and iOS xibs are incompatible even so far as you can‚Äôt copy and paste standard elements like <code class="language-plaintext highlighter-rouge">UILabel</code> between them.</p>

<p>The design was such that it was quite easy to make it work for iPhone. The run page itself just needed some font size adjustments whilst the grid view showing all of the runs had some stack views tweaked so they were shown vertically rather than horizontally.</p>

<p>The next step was to optimise the design for iPad. Again, this mostly worked out of the box as I use AutoLayout for everything. I just needed to monitor trait changes and update the code to render slightly differently depending on whether we were in compact or regular width mode. This had the nice side effect of enabling the three column layout on an iPhone 13 Pro Max in landscape and also working across the various split screen views that are available on iPad.</p>

<p>Finally, I checked the box for Catalyst support for macOS and was surprised to find that everything pretty much worked out of the box. I only needed to add the following code to get the app looking just fine on the Mac:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="cp">#if targetEnvironment(macCatalyst)</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">titlebar</span> <span class="o">=</span> <span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="n">windowScene</span><span class="p">?</span><span class="o">.</span><span class="n">titlebar</span> <span class="p">{</span>
        <span class="n">titlebar</span><span class="o">.</span><span class="n">titleVisibility</span> <span class="o">=</span> <span class="o">.</span><span class="n">hidden</span>
        <span class="n">titlebar</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="n">windowScene</span><span class="p">?</span><span class="o">.</span><span class="n">sizeRestrictions</span><span class="p">?</span><span class="o">.</span><span class="n">minimumSize</span> <span class="o">=</span> <span class="kt">CGSize</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">768</span><span class="p">)</span>
<span class="cp">#endif</span></code></pre></figure>

<p>That code effectively hides the toolbar so the traffic light window management buttons blend into the app view and then restricting the minimum view size to that of a regular iPad so you can‚Äôt break the layout<sup id="fnref:catalyst" role="doc-noteref"><a href="#fn:catalyst" class="footnote" rel="footnote">4</a></sup>.</p>

<p>With that done, I then went through the app and added a few quality of life improvements such as a native menu bar on the Mac, keyboard shortcuts for Mac and iPad, and adding the ability for PiP to automatically engage when you leave the app during a run on iPhone and iPad.</p>

<p>SwiftUI would undoubtedly have made the UI faster to port, but I still think the platform is too immature for full app development. As <a href="https://twitter.com/richturton/status/1469320087844933638">Richard Turton put it</a>:</p>

<blockquote>
  <p>SwiftUI allows you to move so incredibly fast that by the time you realise what you want isn‚Äôt yet possible, you‚Äôre already off the edge of the cliff, like Wile E Coyote</p>
</blockquote>

<p>That certainly matches my experience ü§£. Whilst it can be a phenomenally quick tool for building UI, it can‚Äôt quite match the smooth experience that users expect when it comes to the small but crucial details.</p>

<div class="gofigure">  
    <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">
        <img src="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/chaise-longue-to-5k-iphone.jpg" width="800" height="450" />
    </a>
</div>

<h3 id="in-conclusion">In Conclusion</h3>

<p>As I‚Äôve said many times before, one of the great joys of being a software developer is that you can build apps bespoke for your own needs and interests. I‚Äôve massively enjoyed having Chaise Longue to 5K on my Apple TV whilst doing my runs, but I also really enjoyed the challenge of porting the app across to all the other Apple platforms that support Picture in Picture<sup id="fnref:applewatchchaise" role="doc-noteref"><a href="#fn:applewatchchaise" class="footnote" rel="footnote">5</a></sup>. As ever, there are a number of small details that I‚Äôd like to highlight:</p>

<ul>
  <li>Whilst adding extra platforms didn‚Äôt take that long from a development point of view, it massively increased the amount of time preparing for App Store submission as I had to create a lot more screenshots, text, etc. Trying to work out the best way to show PiP on macOS was an <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/chaise-longue-macos-pip.png">interesting challenge</a>! It was also difficult to work out a way to <a href="https://bendodson.s3.amazonaws.com/dodo/chaise-longue-to-5k-pip.jpg">show it on tvOS</a> without using copyrighted video content.</li>
  <li>A nice side effect of using the same bundle identifier for all three versions of the app (Apple TV, iOS/iPadOS, Mac) is that if you buy it on one platform you get it on all of them! As I‚Äôm selling it for ¬£1.79 currently, that makes it a pretty sweet deal‚Ä¶</li>
  <li>I spent quite a lot of time on a little animation effect that happens when you first complete a 5K run. Confetti in front of and behind a real time blur that animates seamlessly. <a href="https://twitter.com/bendodson/status/1543969870810857477">Beautiful</a>.</li>
  <li>I‚Äôm really pleased with how the Apple TV app icon <a href="https://twitter.com/bendodson/status/1542450900622626819">came out</a> as I‚Äôm always a big fan of the parallax effects you can create. I found a very cheap designer on Fiverr who created a <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/chaise-longue-fiverr.png">first pass</a> and then I tweaked it to match my needs; I can‚Äôt draw to save my life but I can recompose and recolor objects pretty well!</li>
  <li>I was amazed that all of the Picture in Picture stuff just worked across all the platforms; I didn‚Äôt have to change any code whatsoever and whilst the videos were rendered from the tvOS app UI they look good on all platforms.</li>
  <li>Thanks to using <code class="language-plaintext highlighter-rouge">NSUbiquitousKeyValueStore</code> coupled with <code class="language-plaintext highlighter-rouge">.didChangeExternallyNotification</code>, completing a run on one device will see the UI automatically update on all other devices within seconds. No 3rd party frameworks or private data collection required!</li>
</ul>

<p>I‚Äôd love it if you would give <a href="https://apps.apple.com/us/app/chaise-longue-to-5k/id1633434180">Chaise Longue to 5K</a> a try. It‚Äôs available now on tvOS 14 and above, iOS / iPadOS 14 and above, and macOS Big Sur (11.0) and above. One low price unlocks it across all platforms.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:wireframe" role="doc-endnote">
      <p>Here‚Äôs a <a href="https://twitter.com/bendodson/status/1542528144241856513/photo/1">rough drawing I did in Notes</a> compared with the <a href="https://twitter.com/bendodson/status/1542528144241856513/photo/2">final product</a>.¬†<a href="#fnref:wireframe" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:chaisevideos" role="doc-endnote">
      <p>Even though there are 27 runs, that only equates to 12 videos as most weeks the three runs are identical so they can use the same video. Generating those on my M1 Ultra Mac Studio took less than 3 minutes and means I can easily update them should I want to update the UI in future. Each video is rendered at 720p and weighs in at around 3mb leaving the overall app size at under 40mb.¬†<a href="#fnref:chaisevideos" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:cooldown" role="doc-endnote">
      <p>Which is defined as getting to the cool down section.¬†<a href="#fnref:cooldown" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:catalyst" role="doc-endnote">
      <p>Views in Catalyst always seem to be of the ‚ÄúRegular / Regular‚Äù size regardless of what tiny windows you create so it isn‚Äôt possible to have the view seamlessly change between iPad and iPhone style sizes when resizing hence the need for a sensible minimum size.¬†<a href="#fnref:catalyst" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:applewatchchaise" role="doc-endnote">
      <p>I did not bother porting the app to Apple Watch as there are loads of Couch to 5K apps that will serve you better on that platform; this app is predominantly about the Picture in Picture experience.¬†<a href="#fnref:applewatchchaise" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/06/27/spatial-audio-finder/">Introducing the Spatial Audio Finder</a></h1>
			
			<time datetime="2022-06-27" pubdate=""><a href="/weblog/2022/06/27/spatial-audio-finder/">June 27, 2022</a></time>
    	</header>
    	<div>
			<p>I love Spatial Audio. The sound quality and the balance of the individual audio elements is truly extraordinary and a huge advantage for Apple Music over other streaming services. But the process of <em>finding</em> supported tracks is‚Ä¶ well, a bit rubbish.</p>

<p>At the moment, there are 3 ways to discover Spatial Audio tracks:</p>

<ol>
  <li>
    <p>Using Apple‚Äôs own <a href="https://music.apple.com/gb/curator/apple-music-spatial-audio/1564180390">curated category</a> which features a number of playlists and a rotating list of songs that have been added to the service. This is only a very small subset of all of the tracks though and requires a lot of scrolling and trying to work out what is new and what isn‚Äôt.</p>
  </li>
  <li>
    <p>Going to an <a href="https://music.apple.com/gb/album/songs-about-jane/1440851650">album page</a> on Apple Music and seeing if it shows the Dolby Atmos logo. This only works if the entire album is available in Spatial Audio; it can‚Äôt tell you if individual tracks are available (something which my <a href="https://bendodson.com/projects/apple-music-artwork-finder/">Apple Music Artwork Finder</a> can do!)</p>
  </li>
  <li>
    <p>Playing songs in your library; if they have Spatial Audio, it‚Äôll kick in and show a Dolby Atmos logo. This obviously only works on a song-by-song basis and is therefore very slow.</p>
  </li>
</ol>

<p>Now there is a better way. Introducing the <a href="https://bendodson.com/projects/spatial-audio-finder/">Spatial Audio Finder</a>, the quickest way to see which tracks by your favourite artists are available in Spatial Audio:</p>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2022/spatial-audio-finder.gif" width="800" height="657" />
</div>

<p>So how does this work? At WWDC 2022, Apple made a small change to the <a href="https://developer.apple.com/documentation/applemusicapi/">Apple Music API</a> such that it is now possible to request <a href="https://developer.apple.com/documentation/applemusicapi/songs/attributes">audioVariants</a> as an extended attribute on songs and albums. Within this are such things as Lossless Audio, Dolby Audio, and Dolby Atmos (which denotes Spatial Audio). Whilst I would like to be able to just see Dolby Atmos as a flag on songs within my library, this new API method at least can get me the information via a fairly laborious process. Essentially, I scrape these data points and build up my own database which I can then query very quickly.</p>

<p>To begin with, I built a system which would accept an Apple Music identifier for a song; it would then fetch the album that song belongs to in order to get a full list of all the tracks along with whether they support Spatial Audio or not<sup id="fnref:examplesong" role="doc-noteref"><a href="#fn:examplesong" class="footnote" rel="footnote">1</a></sup>. I then store this information in my database along with a ‚Äúlast checked‚Äù flag. My script runs continuously and will check to see if there are any songs present that have not been checked in the past 2 weeks and do not have Spatial Audio. If a song or album gains Spatial Audio status, then I tweet it via a new account; <a href="https://twitter.com/NewSpatialAudio">@NewSpatialAudio</a><sup id="fnref:newspatialaudio" role="doc-noteref"><a href="#fn:newspatialaudio" class="footnote" rel="footnote">2</a></sup>.</p>

<p>With this in place, it becomes trivial to build up the database as I just need to throw in a load of song identifiers and the script will churn away fetching all of the information and actually expanding it to more songs as it will gather the entire album. I began by importing my entire music library which is relatively simple thanks to my <a href="https://itunes.apple.com/us/app/music-tracker-automatic-tracking/id1062583712?ls=1&amp;mt=8">Music Library Tracker</a> app which allowed me to collect all of my song identifiers in a matter of milliseconds. I have 7508 songs in my library but as many of them are single tracks from albums, my script expanded this out to over 16000 tracks (of which around 1000 had support for Spatial Audio).</p>

<p>This is obviously skewed to my musical preferences so the next step was to add the various Spatial Audio playlists that Apple curates. I‚Äôve stored the identifiers of all of their playlists from ‚Äú<a href="https://music.apple.com/gb/playlist/made-for-spatial/pl.154af9931b214278a64274c410046e69">Made for Spatial Audio</a>‚Äù and ‚Äú<a href="https://music.apple.com/gb/playlist/hits-in-spatial-audio/pl.ba2404fbc4464b8ba2d60399189cf24e">Hits in Spatial Audio</a>‚Äù to ‚Äú<a href="https://music.apple.com/gb/playlist/jazz-in-spatial-audio/pl.efbd24628ff04ff3b5e416a6e237d753">Jazz in Spatial Audio</a>‚Äù and ‚Äú<a href="https://music.apple.com/gb/playlist/bollywood-in-spatial-audio/pl.74a13ae85e1f48dbb4a2804bd7660cbb">Bollywood in Spatial Audio</a>‚Äù. These playlists helpfully have a ‚Äúlast updated‚Äù flag on them so I check them frequently but only fetch all of their track identifiers if they have changed. This added another 20000 tracks of which most were compatible with Spatial Audio<sup id="fnref:outliers" role="doc-noteref"><a href="#fn:outliers" class="footnote" rel="footnote">3</a></sup>.</p>

<p>At this point I was able to see which songs in my library were updated to Spatial Audio and also see new releases and when my tracks got upgraded thanks to the <a href="https://twitter.com/NewSpatialAudio">@NewSpatialAudio</a> account. As every change thus far had been tweeted, it was possible to search Twitter for specific artists to see what songs or albums were compatible doing something like <code class="language-plaintext highlighter-rouge">from:newspatialaudio "avril lavigne"</code><sup id="fnref:sk8erboi" role="doc-noteref"><a href="#fn:sk8erboi" class="footnote" rel="footnote">4</a></sup>. Unfortunately, it turned out this was only working when I was logged in as @NewSpatialAudio and results were mixed if searching from different accounts. I don‚Äôt know if this is due to spam protection or some form of caching but it meant there was a need for a new tool; <a href="https://bendodson.com/projects/spatial-audio-finder/">Spatial Audio Finder</a>.</p>

<p>Creating the Spatial Audio Finder was relatively easy as I had all the building blocks in place. You enter an artist name and hit search, then I look up all the tracks in my database and list the songs that have been updated. In the end it took a bit longer as I realised I‚Äôd want to have the album artwork and track numbers on the page, and I wasn‚Äôt currently collecting that information; this would need to be added to my data necessitating a full re-fetch of the nearly 40000 tracks. I also decided that it was likely people might search for an artist that was not in my database. To remedy that, if a search is made and there are zero results, I go and fetch the top 25 songs for that artist on Apple Music and add their identifiers to the database which will typically expand out to their most popular albums which are the likeliest candidates for upgraded audio<sup id="fnref:michael" role="doc-noteref"><a href="#fn:michael" class="footnote" rel="footnote">5</a></sup>. In this way, the more that people use this tool, the more Spatial Audio tracks will be discovered.</p>

<p>I hope that the <a href="https://bendodson.com/projects/spatial-audio-finder/">Spatial Audio Finder</a> will be useful to many people, but this is just a stop gap solution. My ultimate goal is to be able to scan your music library and then show you the tracks that have been updated to Spatial Audio then go a step further and generate a Spatial Audio playlist for you that gets updated automatically as new songs get upgraded on the service. The first step of this will be happening very soon as I release a new version of my <a href="https://itunes.apple.com/us/app/music-tracker-automatic-tracking/id1062583712?ls=1&amp;mt=8">Music Library Tracker</a> app that will allow you to opt-in to upload your library to the Spatial Audio database; the next step after that will be showing you what tracks in your library have been updated! This will in turn expand the musical variety being placed into the database and showcase more Spatial Audio tracks. Eventually, I should have the most complete record of Spatial Audio tracks outside of Apple and also the fastest and most useful ways of accessing that data.</p>

<p>If you run into any issues, please do <a href="https://bendodson.com/contact/">contact me</a> so I can improve the service as much as I can.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:examplesong" role="doc-endnote">
      <p>For example, if I fetch the song ‚Äú<a href="https://music.apple.com/gb/album/this-love/1440851650?i=1440851719">This Love</a>‚Äù by Maroon 5 (which has the identifier <code class="language-plaintext highlighter-rouge">1440851719</code>), then that will give me the full album (identifier <code class="language-plaintext highlighter-rouge">1440851650</code>) along with all the tracks so I don‚Äôt need to check each track individually.¬†<a href="#fnref:examplesong" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:newspatialaudio" role="doc-endnote">
      <p>The account will differentiate between individual tracks on an album and full albums that support Spatial Audio. I also distinguish between old tracks being upgraded to Spatial Audio versus new releases by checking if the release date was in the past 2 weeks or not.¬†<a href="#fnref:newspatialaudio" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:outliers" role="doc-endnote">
      <p>They aren‚Äôt <em>all</em> compatible as there might be a single song in a playlist which is the only Spatial Audio song on an album; I fetch the entire album so I can monitor if other tracks get added over time.¬†<a href="#fnref:outliers" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:sk8erboi" role="doc-endnote">
      <p>Yes, ‚ÄúSk8er Boi‚Äù is available in Spatial Audio.¬†<a href="#fnref:sk8erboi" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:michael" role="doc-endnote">
      <p>I can‚Äôt believe there isn‚Äôt a single Michael Jackson song rendered in Spatial Audio yet (although you can get <a href="https://music.apple.com/us/album/i-want-you-back/1440912101?i=1440912105">I Want You Back</a> and <a href="https://music.apple.com/us/album/abc/1440912101?i=1440912109">ABC</a> by the Jackson 5).¬†<a href="#fnref:michael" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/05/17/unlisted-app-distribution-on-the-app-store/">Unlisted App Distribution on the App Store</a></h1>
			
			<time datetime="2022-05-17" pubdate=""><a href="/weblog/2022/05/17/unlisted-app-distribution-on-the-app-store/">May 17, 2022</a></time>
    	</header>
    	<div>
			<p>Back in 2015 I was commissioned to rebuild an iOS app for <a href="https://www.models1.co.uk">models1</a>, the leading modelling agency in Europe. The app performed double duty acting as a personal portfolio for models within the agency and a collection of all of the portfolios for the agents. As it was only for staff and models, the app was distributed via an Enterprise certificate which allowed me to generate a single .ipa and produce a website where users could download the app directly to their devices. Over the years, this process became slightly more arduous as the user would need to manually approve the enterprise certificate within their device settings but it worked.</p>

<p>A little while later I also built a small app that allowed talent scouts to choose multiple photos and fill out some details in a form which was then compiled into an email. This, again, was distributed via an Enterprise account.</p>

<p>Fast forward to 2022 and my client had allowed their developer account to lapse. Upon trying to renew, they were told by Apple that they no longer met the <a href="https://developer.apple.com/programs/enterprise/">current program requirements</a> and that they should seek to distribute via Apple Business Manager, Ad Hoc Distribution, TestFlight, or the App Store. The Apple Business Manager would not have worked well as that is essentially a full MDM system whereby the client would need to manage all devices (which would not be suitable for the models). Similarly, Ad Hoc Distribution would be a pain as we‚Äôd need UDIDs for every device we want to distribute to and TestFlight would require sending out new builds every 90 days; the App Store being public would not be an option given the niche aspect of the app.</p>

<p>Luckily I‚Äôd remembered that Apple had announced a new ‚Äúunlisted‚Äù status back in January which would allow you to upload your app to the App Store but make it available only via a direct link, kind of like the public link system within TestFlight<sup id="fnref:noexpire" role="doc-noteref"><a href="#fn:noexpire" class="footnote" rel="footnote">1</a></sup>. I browsed around App Store Connect but could find no mention of it within the ‚ÄúPricing and Availability‚Äù tab which only allowed me to go down the business route. It turns out you have to <a href="https://developer.apple.com/support/unlisted-app-distribution/">apply for unlisted status</a> via a form:</p>

<blockquote>
  <p>You‚Äôll need to submit a request to receive a link to your unlisted app. <strong>If your app hasn‚Äôt been submitted for review or was already approved for public download on the App Store, simply complete the request form</strong>. If your app was already approved for private download on Apple Business Manager or Apple School Manager, you‚Äôll need to create a new app record in App Store Connect, upload your binary, and set the distribution method to Public before completing the request form.</p>
</blockquote>

<p>To start with, I uploaded a build and filled out all of the metadata on App Store Connect including screenshots, description, review notes, etc. I then attempted to fill out <a href="https://developer.apple.com/contact/request/unlisted-app/">the form</a> but was denied access, despite being an admin, as it is only available to the account holder. For reference, the questions they ask are:</p>

<ul>
  <li>App Name</li>
  <li>Apple ID of App</li>
  <li>Describe in detail the business problem your app solves</li>
  <li>Why do you prefer to distribute this app unlisted on the App Store instead of privately to specific organizations on Apple Business Manager or Apple School Manager?</li>
  <li>What is the estimated size of your app‚Äôs user base?</li>
  <li>Who is the audience for your app?</li>
  <li>In what regions will your app be available?</li>
</ul>

<p>My client filled this out and within 24 hours they had a reply:</p>

<blockquote>
  <p>After careful review, we regret that we‚Äôre unable to approve your request for unlisted app distribution at this time.</p>

  <p>In order to evaluate your app, please complete all the required metadata in App Store Connect, including app name, description, keywords, and screenshots and submit for review.</p>
</blockquote>

<p>This was a surprise as everything was set up on App Store Connect. After another email back and forth, Apple replied with:</p>

<blockquote>
  <p>I will reiterate the note below, and say that all unlisted apps must be submitted for App Store review.</p>
</blockquote>

<p>So it turns out you <em>do</em> need to still submit the app via App Store Connect but also fill in a request form. Obviously we did not want the app to go live publicly so I set everything to ‚ÄúManual release‚Äù and then added an extra line to the review notes that read:</p>

<blockquote>
  <p>IMPORTANT: We will request ‚Äúunlisted‚Äù status for this app, it is not for general release but we were told by unlistedapp_request@apple.com that we needed to submit this to App Review before requesting this status.</p>
</blockquote>

<p>I submitted the app and my client filled out the request form again. The next day, I received notification that both apps had been rejected by App Review for <em>Guideline 2.1 - Information Needed</em>:</p>

<blockquote>
  <p>We need more information about your business model and your users to help you find the best distribution option for your app</p>

  <p>Please review the following questions and provide as much detailed information as you can for each question.</p>

  <ol>
    <li>Is your app restricted to users who are part of a single company? This may include users of the company‚Äôs partners, employees, and contractors.</li>
    <li>Is your app designed for use by a limited or specific group of companies?
      <ul>
        <li>If yes, which companies use this app?</li>
        <li>If not, can any company become a client and utilize this app?</li>
      </ul>
    </li>
    <li>What features in the app, if any, are intended for use by the general public?</li>
    <li>Identify the specific countries or regions where you plan to distribute your app.</li>
    <li>How do users obtain an account?</li>
    <li>Is there are any paid content in the app? For example, do users pay for opening an account or using certain features in the app?</li>
    <li>Who pays for the paid content and how do users access it?</li>
  </ol>
</blockquote>

<p>You‚Äôll note that a lot of this is similar to the form that was already filled out ü§î</p>

<p>I was out of the office for the day so had not gotten around to replying to these questions when out of the blue I got two notifications to say the apps had been approved for the App Store! It looks like App Review had rejected the app as they were not suitable for App Store release (hence the questions above) but had completely ignored my note about the unlisted status. Then, later that day, the team that deals with unlisted apps looked at them and approved them.</p>

<p>When I went back to App Store Connect, it now showed a new ‚ÄúUnlisted App URL‚Äù within the ‚ÄúApp Distribution Methods‚Äù on the Pricing and Availability page<sup id="fnref:manual" role="doc-noteref"><a href="#fn:manual" class="footnote" rel="footnote">2</a></sup>.</p>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2022/unlisted-app-url.jpg" width="600" height="150" />
</div>

<p>A few thoughts:</p>

<ol>
  <li>This process is not great and I‚Äôm not sure why they‚Äôve decided to split it across two separate systems. It would surely make more sense to have ‚ÄúUnlisted‚Äù be an option within App Store Connect and then App Review can have the correct team contact you to ask whatever questions they need, especially as the distribution is done through App Store Connect.</li>
  <li>The documentation clearly says you only need to fill out the form if the app hasn‚Äôt been submitted for review. I‚Äôm not sure why we needed to submit the app only for it to be rejected by a different team?</li>
  <li>The ‚ÄúUnlisted App URL‚Äù you get is actually the same as what the public URL would be. This strikes me as odd, especially as you can convert an already public app into an unlisted one (though you can‚Äôt go back to being public). Those URLs are going to be cached by search engines, etc, so seems like a bit of a flaw. This wasn‚Äôt an issue for us but worth mentioning.</li>
  <li>Viewing the app on the App Store is exactly the same as if you‚Äôd shared any public URL; the store page is identical with screenshots, description, ratings, App Privacy, etc. There is no indication whatsoever that this is a private page.</li>
</ol>

<p>Overall I like that this system exists and that there is a way to get apps to a very specific small audience without paying 3x the cost for an enterprise account or going through the Apple Business Manager. I was also pleasantly surprised that the very basic app for talent scouts was approved as I did not think it would be; it looks like the App Store Guidelines are much less strictly enforced than they are for a public release<sup id="fnref:lucky" role="doc-noteref"><a href="#fn:lucky" class="footnote" rel="footnote">3</a></sup>. However, there are clearly some teething problems that need to be ironed out.</p>

<p>In any case, if you‚Äôre looking to get an unlisted app on the App Store, just be aware that a rejection may not necessarily be all it seems!</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:noexpire" role="doc-endnote">
      <p>Similar, but App Store apps don‚Äôt typically expire so a single build would be enough until iOS changes necessitate another build.¬†<a href="#fnref:noexpire" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:manual" role="doc-endnote">
      <p>As the app was still set to ‚ÄúManual release‚Äù I had to press the release button. I was a bit nervous of this as the language is still ‚ÄúAre you sure you want to release this to the App Store‚Äù but it did not make it publicly available; once you have the unlisted URL there is no way to make the app public.¬†<a href="#fnref:manual" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:lucky" role="doc-endnote">
      <p>Or we got lucky üòÇ¬†<a href="#fnref:lucky" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/04/13/web-inspector-on-ios-devices-simulators/">Web Inspector on iOS devices and Simulators</a></h1>
			
			<time datetime="2022-04-13" pubdate=""><a href="/weblog/2022/04/13/web-inspector-on-ios-devices-simulators/">April 13, 2022</a></time>
    	</header>
    	<div>
			<p>Over the past few weeks I‚Äôve worked on a number of projects that have necessitated me working with HTML and JavaScript be that via Safari on iOS, an SFSafariViewController, or in an embedded WKWebView. In all of these cases, I‚Äôve needed to dive into the DOM to see what styles are being applied to certain elements or dig into a JavaScript Console to work out why some code isn‚Äôt working. On desktop, this is trivial as Safari has a Web Inspector panel built in similar to other browsers. It turns out it is also trivial on mobile as the exact same tool can be used with both iOS simulators and physical devices.</p>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2022/ios-simulator-web-inspector.jpg" width="800" height="536" />
    <figure>Activating the Web Inspector for Safari in an iOS Simulator. Note that it is also possible to look at the "Extension Background Page" for the Browser Note Safari Extension that is also installed and running.</figure>
</div>

<p>If you select the ‚ÄòDevelop‚Äô tab from the menu bar of Safari on macOS, you‚Äôll see a list of all of your connected devices and actively running simulators<sup id="fnref:naming" role="doc-noteref"><a href="#fn:naming" class="footnote" rel="footnote">1</a></sup>. Drilling into this will then show all of the active web instances you can interact with; notice how the content within Safari has highlighted blue within the Simulator as I‚Äôve moused over the twitter.com web instance above. When you click, a web inspector panel is then produced which allows you to make all the usual interrogations and changes you can within desktop Safari such as interacting with the console or changing CSS values of elements to see how they would look in realtime.</p>

<p>Here‚Äôs an example using a WKWebView within one of my client projects, <a href="https://spanish.yabla.com">Yabla Spanish</a>:</p>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2022/ios-device-web-inspector.jpg" width="800" height="400" />
    <figure>As I hover over the DOM in the web inspector, the same highlighting that appears in desktop Safari appears within the WKWebView on my physical device (note the green box showing the 24px padding within that div).</figure>
</div>

<p>Discovering that simulators and devices could be interacted with in this way has been a huge timesaver for me. Whilst <a href="/weblog/2022/03/11/browser-note/">developing Browser Note</a>, I was constantly needing to tweak CSS values and investigate the current state of the DOM as websites have various tricks to try and make ads or cookie notices appear on top of all content (and the note needed to be on top at all times - you should totally take a look at <a href="https://apps.apple.com/us/app/browser-note/id1613527249">Browser Note</a> whilst you‚Äôre here). In doing this, I was then able to put this knowledge to use on no less than 3 client projects in the past month; this validates my theory that by working on your own <a href="/sideprojects/">side projects</a> you can improve your efficiency when it comes to work projects.</p>

<p>There are a few caveats to be aware of when using the Web Inspector with an iOS device or simulator:</p>

<ul>
  <li>If you want to use this on an actual device you‚Äôll first need to enable the Web Inspector on iOS. To do this, go to the Settings app and then Safari &gt; Advanced and toggle the Web Inspector on.</li>
  <li>Whilst the Web Inspector can interrogate WKWebView, it can only do this for apps you are running via Xcode. You cannot look at the WKWebView of apps you did not create nor of your own apps from TestFlight / the App Store. However, you can inspect debug builds installed via Xcode even if the debugger is not active (i.e. you build to the device then quit Xcode).</li>
  <li>Conversely, you can use the Web Inspector with any SFSafariViewController even if it is not in your own app.</li>
  <li>Whilst it is still possible to submit apps that use UIWebView, the web inspector will not work with them; <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/wkwebview.jpg">it needs to be WKWebView</a>.</li>
  <li>This also works for AppKit, SwiftUI, and Catalyst apps on macOS.</li>
</ul>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:naming" role="doc-endnote">
      <p>I use an ‚ÄúiDod‚Äù naming prefix for all of my devices; a throwback pun to my first Apple product, the iPod.¬†<a href="#fnref:naming" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2022/03/11/browser-note/">Browser Note and the process of building an iOS 15 Safari Extension</a></h1>
			
			<time datetime="2022-03-11" pubdate=""><a href="/weblog/2022/03/11/browser-note/">March 11, 2022</a></time>
    	</header>
    	<div>
			<p>I order a Chinese takeaway most weeks and my regular order is half a crispy aromatic duck. This is a bit excessive and so I‚Äôve been aiming to reduce this to a quarter. The problem is that it‚Äôs too easy to hit reorder at the end of a long day and whilst I could add a reminder in Things or an alert in my calendar these are very easy to ignore. My solution was to use the new support for browser extensions in iOS 15 to throw up a fullscreen prompt when I go to the takeaway website:</p>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2022/quack.jpg" width="800" height="450" />
    <figure>Problem solved.</figure>
</div>

<p>After using this solution for a week or two, I quickly found myself wanting to use it in on other sites such as BBC News and Twitter to prevent me from habitually visiting them. I developed the extension further so I could add notes directly within Safari and instantly saw my phone usage drop by several hours a week. It turns out that adding a short ‚Äúare you sure‚Äù dialogue before visiting a website is a great way to break the habit<sup id="fnref:screentime" role="doc-noteref"><a href="#fn:screentime" class="footnote" rel="footnote">1</a></sup>.</p>

<p>Whilst I make a lot of apps for my own <a href="/sideprojects">personal use</a>, this seemed like something that could be beneficial for everybody, particularly as I could not find any apps that already do this. Therefore, I‚Äôm very happy to release my first self-published app in over 5 years: <a href="https://apps.apple.com/us/app/browser-note/id1613527249">Browser Note</a>.</p>

<div class="gofigure">
    <a href="https://apps.apple.com/us/app/browser-note/id1613527249">
        <img src="https://bendodson.s3.amazonaws.com/dodo/browser-note.jpg" width="800" height="450" />
    </a>
</div>

<p>Browser Note is an app that does one thing incredibly well; it adds fullscreen notes to webpages. It does this by making use of an iOS 15 Safari Extension that you can activate within Safari to add your note and later update or delete it. When a note is displayed on a page, a ‚ÄúView Website‚Äù button is available to let you continue into the site; when tapped, the note is snoozed for a period of time at which point it will appear again on any subsequent reloads (the snooze period is 15 minutes but you can change this within the app).</p>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/dodo/browser-note-ipad.jpg" width="800" height="450" />
    <figure>All of your notes are visible within the app (shown left). You can add, update, and delete your notes by tapping the Browser Note icon within Safari (shown right).</figure>
</div>

<p>There is no App Store just for Safari Extensions so instead they have to come bundled within an app. From a development perspective, Safari Extensions are very similar to those made for Chrome and Firefox; Apple even provide <a href="https://developer.apple.com/documentation/safariservices/safari_web_extensions/converting_a_web_extension_for_safari">a converter</a> to migrate any extensions you‚Äôve built for other browsers. Xcode has a template for Safari Extension based-apps which I used to get started but after that you‚Äôre on your own; whilst there is <a href="https://developer.apple.com/documentation/safariservices/safari_app_extensions">documentation from Apple</a>, it‚Äôs predominantly for Safari Extensions on macOS which are very different. The most frustrating aspect is that the documentation does not say which platforms it supports and as many of the APIs are the same it was easy to spend a couple of hours wondering why something doesn‚Äôt work only to find it doesn‚Äôt apply to iOS<sup id="fnref:sfsafariextensionmanager" role="doc-noteref"><a href="#fn:sfsafariextensionmanager" class="footnote" rel="footnote">2</a></sup>.</p>

<p>My initial thought was to use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API">Web Storage API</a> to store notes as then everything would be wrapped up in a tidy extension. However, there isn‚Äôt a way for the app to access that data so if I wanted to add syncing in future (i.e. between iPad and iPhone) then this was not going to be a viable solution. Most apps that have extensions just give you a tutorial on how to enable them but I wanted to go a bit further and add some functionality within there as well, so again I wanted the app to be able to access the notes that were created.</p>

<p>In the end, I came up with a model whereby the app is in control of all of the notes data within a <a href="https://docs.mongodb.com/realm/sdk/swift/">local Realm database</a> situated in an App Group so both the app and extension can communicate with it. When you load a website, the extension wakes up the app which checks whether there is a note matching the current URL; if there is, it responds with the data and the extension removes all of the HTML from the page and replaces it with it‚Äôs own note UI. Similarly, when you invoke the popup sheet to add a note or edit one, the commands are sent through to the app to perform those actions on the database. Within the iOS simulator this is quite slow ‚Äì it would take a few seconds after visiting a page before the note would appear ‚Äì but on a device it‚Äôs practically instantaneous.</p>

<p>In order to communicate between the extension and the app, there are a number of hoops to jump through. First of all we have the <code class="language-plaintext highlighter-rouge">content.js</code> file which is loaded on each page request:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">browser</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="dl">"</span><span class="s2">request</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">check</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">})).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">isSnoozed</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">createContentView</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">emoji</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">displayText</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">"</span><span class="s2">ignore</span><span class="dl">"</span><span class="p">:</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>This sends a message to the <code class="language-plaintext highlighter-rouge">background.js</code> file with the current url and also the request type (there is <em>check</em>, <em>add</em>, <em>update</em>, <em>delete</em>, and <em>snooze</em> - in this case we‚Äôre just checking to see if there is a note). If a response comes back with a type of <em>message</em> then we‚Äôll make sure the note isn‚Äôt currently snoozed and then throw up the note UI. But how does the response get generated?</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">browser</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onMessage</span><span class="p">.</span><span class="nx">addListener</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span> <span class="nx">sender</span><span class="p">,</span> <span class="nx">sendResponse</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">sendNativeMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">application.id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">request</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sendResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure>

<p>This is the <code class="language-plaintext highlighter-rouge">background.js</code> file in its entirety. Not much there ü§£. In order to communicate with the native app, we have to use a <code class="language-plaintext highlighter-rouge">sendNativeMessage</code> API but this cannot be used from <code class="language-plaintext highlighter-rouge">content.js</code>, it has to be invoked by <code class="language-plaintext highlighter-rouge">background.js</code>, hence this background file just acts as a middleman taking any messages from the content and sending them to the native app before shuttling back the response. One important item to note here is that you must <code class="language-plaintext highlighter-rouge">return true</code> when you are responding to a message from the content otherwise the connection is closed instantly (i.e. it will not wait for the native app to respond).</p>

<p>Now that we‚Äôve sent a message to the app, it‚Äôs time to look at the Swift code that is responding to these events. This is all handled by a <code class="language-plaintext highlighter-rouge">SafariWebExtensionHandler</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">SafariServices</span>

<span class="kd">class</span> <span class="kt">SafariWebExtensionHandler</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">NSExtensionRequestHandling</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">beginRequest</span><span class="p">(</span><span class="n">with</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">NSExtensionContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">item</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">inputItems</span><span class="o">.</span><span class="n">first</span> <span class="k">as?</span> <span class="kt">NSExtensionItem</span><span class="p">,</span> <span class="k">let</span> <span class="nv">userInfo</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">userInfo</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">arg</span> <span class="o">=</span> <span class="n">userInfo</span><span class="p">[</span><span class="kt">SFExtensionMessageKey</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">CVarArg</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"%@"</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">),</span> <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">ExtensionRequest</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">requestType</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">requestType</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">response</span><span class="p">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"ignore"</span><span class="p">]</span>
            <span class="k">switch</span> <span class="n">requestType</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">check</span><span class="p">:</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="k">let</span> <span class="nv">device</span> <span class="o">=</span> <span class="kt">UIDevice</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">userInterfaceIdiom</span> <span class="o">==</span> <span class="o">.</span><span class="n">pad</span> <span class="p">?</span> <span class="s">"ipad"</span> <span class="p">:</span> <span class="s">"iphone"</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">reminder</span> <span class="o">=</span> <span class="kt">DataStore</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"message"</span><span class="p">,</span> <span class="s">"id"</span><span class="p">:</span> <span class="n">reminder</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s">"displayText"</span><span class="p">:</span> <span class="n">reminder</span><span class="o">.</span><span class="n">displayText</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"&lt;br&gt;"</span><span class="p">),</span> <span class="s">"emoji"</span><span class="p">:</span> <span class="n">reminder</span><span class="o">.</span><span class="n">emoji</span><span class="p">,</span> <span class="s">"text"</span><span class="p">:</span> <span class="n">reminder</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">"isSnoozed"</span><span class="p">:</span> <span class="n">reminder</span><span class="o">.</span><span class="n">isSnoozed</span><span class="p">,</span> <span class="s">"device"</span><span class="p">:</span> <span class="n">device</span><span class="p">]</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"ignore"</span><span class="p">,</span> <span class="s">"host"</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">host</span> <span class="p">??</span> <span class="s">""</span><span class="p">,</span> <span class="s">"device"</span><span class="p">:</span> <span class="n">device</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">add</span><span class="p">:</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">text</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="k">let</span> <span class="nv">blockHost</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">blockHost</span> <span class="p">??</span> <span class="kc">true</span>
                <span class="k">let</span> <span class="nv">reminder</span> <span class="o">=</span> <span class="kt">Reminder</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span> <span class="nv">matchExactPath</span><span class="p">:</span> <span class="o">!</span><span class="n">blockHost</span><span class="p">)</span>
                <span class="kt">DataStore</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">reminder</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"reload"</span><span class="p">]</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">update</span><span class="p">:</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="k">let</span> <span class="nv">text</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">text</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="kt">DataStore</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">updateText</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">id</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="n">text</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"reload"</span><span class="p">]</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">delete</span><span class="p">:</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="kt">DataStore</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">delete</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">id</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"reload"</span><span class="p">]</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">snooze</span><span class="p">:</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="k">let</span> <span class="nv">reminder</span> <span class="o">=</span> <span class="kt">DataStore</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">id</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="n">reminder</span><span class="o">.</span><span class="nf">snooze</span><span class="p">()</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"reload"</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">let</span> <span class="nv">responseItem</span> <span class="o">=</span> <span class="kt">NSExtensionItem</span><span class="p">()</span>
            <span class="n">responseItem</span><span class="o">.</span><span class="n">userInfo</span> <span class="o">=</span> <span class="p">[</span><span class="kt">SFExtensionMessageKey</span><span class="p">:</span> <span class="n">response</span><span class="p">]</span>
            <span class="n">context</span><span class="o">.</span><span class="nf">completeRequest</span><span class="p">(</span><span class="nv">returningItems</span><span class="p">:</span> <span class="p">[</span><span class="n">responseItem</span><span class="p">],</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure>

<p>The data comes through as a string within the user info dictionary of an <code class="language-plaintext highlighter-rouge">NSExtensionItem</code>. I send JSON from the extension via this mechanism as then I can use the <code class="language-plaintext highlighter-rouge">Codable</code> protocol in Swift to unpack it into a native struct. I then look at the request type and perform what actions are needed on the database before responding with a dictionary of my own; if there is a note then that data is sent back, otherwise the response will tell the extension to either do nothing or reload the page. In the end, we have an extension that can talk with the native app and store all the data in the Swift world allowing me to display the notes and allow them to be deleted from within the app:</p>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2022/browser-note-edit.jpg" width="800" height="450" />
    <figure>Notes are stored within the app so can be deleted natively. I could also add the option to add and edit notes within the native app but I cut that functionality from the initial release so I could get it shipped.</figure>
</div>

<p>As I mentioned, I would like to add note syncing in a future version that would allow the iPhone and iPad apps to remain in sync. I‚Äôm also intrigued as to whether a Catalyst version of the app would get this working on macOS but after over 30 hours of development I decided it was best to get an initial version launched before adding additional features.</p>

<h3 id="conclusion">Conclusion</h3>

<p>This project started as a simple alert for a single webpage but has quickly become a labor of love for me as the benefits of a pause in web browsing became apparent. I‚Äôve spent far too much time tweaking aspects of the app and haven‚Äôt bought up a number of tiny details I‚Äôm very proud of:</p>

<ul>
  <li>I used SwiftUI via a UIHostingController to create the <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/browser-note-tutorial.jpg">tutorial panels</a> shown on app launch. These were able to be reused really easily within the settings page.</li>
  <li>There are videos to show how to install the extension and use the app. I used data within an Asset Catalogue for the first time so I could have a different video depending on whether the app is installed on iPhone or iPad (and due to App Thinning it means the app doesn‚Äôt even include the other device video thus reducing download and install size).</li>
  <li>I‚Äôm really pleased with the <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/browser-note-icon.png">app icon</a> I designed and am slightly surprised it got through App Review; it‚Äôs the Safari logo in green but using a pen for the compass arrow.</li>
  <li>Speaking of App Review, I‚Äôm amazed <a href="https://bendodson.s3-eu-west-1.amazonaws.com/weblog/2022/browser-note-mac-studio.png">this screenshot</a> was allowed ü§£</li>
  <li>The app resizes beautifully on iPad and all of it‚Äôs various multitasking window sizes. This also goes for the HTML within the extension which is in a modal popup on compact sizes but a floating panel on regular sizes.</li>
  <li>Dark mode is fully supported so your note will reflect the system theme.</li>
</ul>

<p>I‚Äôd love it if you would give <a href="https://apps.apple.com/us/app/browser-note/id1613527249">Browser Note</a> a try. It‚Äôs available on all devices running iOS 15 and above and is available worldwide<sup id="fnref:worldwide" role="doc-noteref"><a href="#fn:worldwide" class="footnote" rel="footnote">3</a></sup> now.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:screentime" role="doc-endnote">
      <p>I have attempted to do this in the past using Screen Time but it‚Äôs a blunt instrument. It can only apply to an entire domain and you can‚Äôt personalise the text that appears so it‚Äôs only really useful as a block; you don‚Äôt get the positive reinforcement from a message you‚Äôve written.¬†<a href="#fnref:screentime" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:sfsafariextensionmanager" role="doc-endnote">
      <p>I‚Äôm looking at you <a href="https://developer.apple.com/documentation/safariservices/sfsafariextensionmanager">SFSafariExtensionManager</a>; there is no way for your app to know if the extension is installed correctly on iOS.¬†<a href="#fnref:sfsafariextensionmanager" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:worldwide" role="doc-endnote">
      <p>Well, almost worldwide. <strike>üá∑üá∫üáßüáæ</strike>¬†<a href="#fnref:worldwide" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	<article>
		<header>
     		
				<h1><a href="/weblog/2021/03/10/stoutness/">Side Project: Stoutness</a></h1>
			
			<time datetime="2021-03-10" pubdate=""><a href="/weblog/2021/03/10/stoutness/">March 10, 2021</a></time>
    	</header>
    	<div>
			<p><span class="prelude">This is part of a <a href="/sideprojects/">series of blog posts</a> in which I showcase some of the side projects I work on for my own use. As with all of my side projects, I‚Äôm not focused on perfect code or UI; <a href="https://bendodson.s3.amazonaws.com/butitdoesrun.jpg">it just needs to run</a>!</span></p>

<p>Over the years I‚Äôve been slowly tinkering with an idea I liked to call ‚ÄúThe Morning Briefing‚Äù, a simple way to give me the information I want in the mornings such as the news, weather, and a list of my upcoming tasks. Originally this would have been read to me by Siri<sup id="fnref:whatsmyupdate" role="doc-noteref"><a href="#fn:whatsmyupdate" class="footnote" rel="footnote">1</a></sup> but in mid-2020 I decided instead it would be more fun to have it as a printed page; a personalised newspaper just for me<sup id="fnref:navigator" role="doc-noteref"><a href="#fn:navigator" class="footnote" rel="footnote">2</a></sup>. It would have consisted of weather icons for the next 7 days, a list of my tasks I could physically check off, and then maybe some personal data from Health such as Apple Watch rings, heart rate data, and sleep averages.</p>

<p>I did make a start on this idea but then late last year my chiropractor told me that I desperately needed to improve my activity level. I also needed to perform the stretches I‚Äôd been assigned back in 2017 every day as I‚Äôd fallen out of the habit. The video I use for my stretches is by <a href="https://www.youtube.com/watch?v=RXxsVvc9mGc">Straighten Up UK</a> and whilst it‚Äôs very good there are several bits that can be fast forwarded through once you know the routine. It was also affecting my recommended videos on YouTube as I‚Äôd watch it every morning which meant YouTube kept assuming I wanted more and more stretch videos. Eventually I decided that I‚Äôd just download the video, remove the extraneous bits, and put it in a basic tvOS app. I then realised that my Morning Briefing idea might work better if it was paired along with the stretching video and thus <strong>Stoutness</strong> was born.</p>

<div class="tangent">
    <h4>Tangent: Name and App Icon</h4>
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-icon.gif" width="300" height="200" style="position: relative; float: right; padding: 0 0 10px 20px" />
    <p>As any good developer knows, half the battle is what to name your side project. Originally this was "Morning Briefing" and then became "Hummingbird" after one of the sillier stretches which you'll see shortly. The final name was eventually hit on when my wife remarked (rather cruelly) that I looked like Winnie-the-Pooh doing his <a href="https://www.youtube.com/watch?v=Fz_MxmGP6Aw&amp;t=48s">stoutness exercise</a>.</p>
    <p>One of my favourite things about working on tvOS is the way in which parallax is used to convey focus. Naturally I wanted to have a nice icon if I was going to use it every day and so I decided to take Pooh Bear and let him move around a little. The icon is made of three layers; Pooh on top, the room (with a hole where the mirror is) in the middle, and then the reflection at the back. The result is that both of the Pooh's move opposingly as the icon is highlighted. The whole thing was taken from a very low-res screenshot and then I made judicious use of the "content aware fill" tool in Photoshop to fill in the extra bits of image I'd need such as the space behind Pooh and extending the reflection cut out. You can <a href="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-icon-layers.zip">download a zip</a> of the three individual layers if you're curious to see exactly how it works.</p>
</div>

<p>As with all of my side projects, I generally like to use them as an excuse to learn some new code technique. In this case, I mainly focused on how to mix-and-match SwiftUI with UIKit (as that seems like it may prove useful in the coming years) but I also dabbled in some Combine and with using Swift Package Manager over CocoaPods for the limited number of dependencies I use. In the end, I also needed to dabble with AppleScript, Shortcuts, and writing a couple of iOS and macOS apps to help power everything‚Ä¶</p>

<h3 id="weather">Weather</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-weather.jpg" width="800" height="450" />
</div>

<p>On opening the app the current date is shown along with a loading spinner whilst the five different data sources are called and cached; two of my own APIs, YouTube, Pocket, and OpenWeather. Only once they are all loaded does the ‚ÄúGet Started‚Äù button appear.</p>

<p>The weather icons are displayed as soon as the OpenWeather API response is received and show the weather for the next 7 days along with the high and low temperatures. This entire row is powered by SwiftUI with each day rendered like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">DailyWeatherView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">weather</span><span class="p">:</span> <span class="kt">DailyWeather</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span><span class="p">(</span><span class="nv">spacing</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">weather</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">subheadline</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">fontWeight</span><span class="p">(</span><span class="o">.</span><span class="n">bold</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">multilineTextAlignment</span><span class="p">(</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
            
            <span class="kt">VStack</span> <span class="p">{</span>
                <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="n">weather</span><span class="o">.</span><span class="n">icon</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="nf">system</span><span class="p">(</span><span class="nv">size</span><span class="p">:</span> <span class="mi">80</span><span class="p">))</span>
                <span class="kt">Spacer</span><span class="p">()</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">maxHeight</span><span class="p">:</span> <span class="mi">120</span><span class="p">)</span>
            
            <span class="kt">Text</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">weather</span><span class="o">.</span><span class="n">low</span><span class="se">)</span><span class="s">‚Üì </span><span class="se">\(</span><span class="n">weather</span><span class="o">.</span><span class="n">high</span><span class="se">)</span><span class="s">‚Üë"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">subheadline</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">fontWeight</span><span class="p">(</span><span class="o">.</span><span class="n">bold</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">multilineTextAlignment</span><span class="p">(</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">opacity</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">220</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">center</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>I love how quick and easy it is to prototype something with SwiftUI and with the new Apple Silicon Macs it‚Äôs actually feasible to use the realtime preview in Xcode. The icons for each weather type are pulled from <a href="https://developer.apple.com/design/human-interface-guidelines/sf-symbols/">SF Symbols</a> and you may notice I had to lock the <code class="language-plaintext highlighter-rouge">VStack</code> they appear in to 120pt high with a <code class="language-plaintext highlighter-rouge">Spacer</code> underneath; this is because the icons are all different sizes and so <code class="language-plaintext highlighter-rouge">cloud</code> would be misaligned when placed next to <code class="language-plaintext highlighter-rouge">cloud.rain</code>.</p>

<h3 id="newspapers">Newspapers</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-newspapers.jpg" width="800" height="450" />
    <figure><strong>Stand Tall:</strong> To start with we're going to adopt the ideal posture. Try and retain this posture as often as you can. Stand straight and tall with your head high. Make sure your ears, shoulders, hips, knees, and ankles are in a straight line and pull your tummy button in.</figure>
</div>

<p>In my original idea for ‚ÄúMorning Briefing‚Äù I had wanted to get the news headlines along with an excerpt. This is relatively easy to do via something like BBC News with screenscraping but the recent pandemic meant that nearly all of the ‚Äútop read‚Äù stories were pandemic related which I didn‚Äôt really care to read about. I have a subscription to The Times so thought about scraping that site somehow but there was no easy way to get the same content as the newspaper so it ended up being whatever was breaking right now which I also didn‚Äôt want<sup id="fnref:newsphilosophy" role="doc-noteref"><a href="#fn:newsphilosophy" class="footnote" rel="footnote">3</a></sup>. Perhaps I could hook into Apple News now that I‚Äôve got a subscription with Apple One? Nope, Apple News has no APIs or SDK and one look at the network requests with Charles Proxy made me think I didn‚Äôt want to go down that rabbit hole. In the end, I opted for a much simpler solution of having a carousel of the front pages of today‚Äôs newspapers. This lets me see the main topics of the day without getting bogged down in article excerpts which are often a bit click-baity to get you to the actual article.</p>

<p>I tried a few ways to get front pages (originally from the BBC and Sky News websites) but in the end I wrote a very simple PHP script to scrape <a href="https://tomorrowspapers.co.uk">tomorrowspapers.co.uk</a> every few hours:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">require_once</span><span class="p">(</span><span class="s1">'simplehtmldom/HtmlWeb.php'</span><span class="p">);</span>
<span class="kn">use</span> <span class="nc">simplehtmldom\HtmlWeb</span><span class="p">;</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HtmlWeb</span><span class="p">();</span>
<span class="nv">$html</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="nf">load</span><span class="p">(</span><span class="s1">'https://www.tomorrowspapers.co.uk'</span><span class="p">);</span>

<span class="nv">$images</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$html</span><span class="o">-&gt;</span><span class="nf">find</span><span class="p">(</span><span class="s1">'img.size-full'</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$imgTag</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$imgTag</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">,</span> <span class="s1">'DESIGNFORM-Logo'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$images</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$imgTag</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">shuffle</span><span class="p">(</span><span class="nv">$images</span><span class="p">);</span>

<span class="nv">$json</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$images</span><span class="p">);</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'newspapers.txt'</span><span class="p">,</span> <span class="nv">$json</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$json</span><span class="p">;</span></code></pre></figure>

<p>The front pages themselves are image views within a <code class="language-plaintext highlighter-rouge">UIPageViewController</code>. This has the nice side benefit that they are automatically placed into an endless carousel that can be swiped through with the Siri Remote. I randomise the pages each day so that I see each newspaper in a different order.</p>

<div class="tangent">
    <h4>Tangent: Page Layout</h4>
    <p>There are 12 stretches in my chiropractic video which I've trimmed from the original downloaded video and saved as individual files. I then typed up the narration for each exercise and placed it in a <a href="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness.json">JSON file</a>.</p>
    <p>The newspaper page and all the subsequent pages are all the same <code>UIViewController</code> which use the data in the JSON file to display the appropriate video, stretch name, and instructions. They then load a child view controller on the right hand side of the page; this was a <code>UIPageViewController</code> for the newspapers but is a <code>UIHostingController</code> with a SwiftUI view in it for all of the following stretches.</p>
</div>

<h3 id="tasks">Tasks</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-tasks.jpg" width="800" height="450" />
    <figure><strong>Tilting Star:</strong> From the stand tall position, spread your arms and legs into a star. Facing forwards, place one hand in the air and the other at your side. Breathe in as you slowly stretch one arm overhead while slowly bending to the opposite side and sliding the hand down the thigh. Relax at the end of the stretch and don't forget to breathe. Perform slowly twice each side.</figure>
</div>

<p>I‚Äôve been a long time user of <a href="https://culturedcode.com/things/">Things</a>, the task manager based on the <a href="https://gettingthingsdone.com">Getting Things Done methodology</a>. I have several repeating tasks in intervals along with ad hoc tasks I create throughout the day, all sorted into areas and projects prefixed with an emoji so they don‚Äôt look quite so dull. Unfortunately, there is no online component with Things<sup id="fnref:thingsapi" role="doc-noteref"><a href="#fn:thingsapi" class="footnote" rel="footnote">4</a></sup> and thus no public API as there is with something like <a href="https://developer.todoist.com/sync/v8/#overview">Todoist</a>. Whilst there is some support for <a href="https://culturedcode.com/things/support/articles/2955145/">Siri Shortcuts</a> they are for opening the app rather than extracting data out of it. However, the macOS app does have comprehensive support for AppleScript and so that offered me a way to get at the data:</p>

<figure class="highlight"><pre><code class="language-applescript" data-lang="applescript"><span class="k">on</span> <span class="nv">zero_pad</span><span class="p">(</span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="nv">string_length</span><span class="p">)</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">string_zeroes</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s2">""</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">digits_to_pad</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">string_length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">length</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="p">(</span><span class="nv">value</span><span class="w"> </span><span class="k">as </span><span class="nc">string</span><span class="p">))</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="nv">digits_to_pad</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w">
        </span><span class="k">repeat</span><span class="w"> </span><span class="nv">digits_to_pad</span><span class="w"> </span><span class="k">times</span><span class="w">
            </span><span class="k">set</span><span class="w"> </span><span class="nv">string_zeroes</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">string_zeroes</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">"0"</span><span class="w"> </span><span class="k">as </span><span class="nc">string</span><span class="w">
        </span><span class="k">end</span><span class="w"> </span><span class="k">repeat</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">padded_value</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">string_zeroes</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">as </span><span class="nc">string</span><span class="w">
    </span><span class="nb">return</span><span class="w"> </span><span class="nv">padded_value</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">zero_pad</span><span class="w">

</span><span class="k">set</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">(</span><span class="nb">current date</span><span class="p">)</span><span class="w">
</span><span class="k">set</span><span class="w"> </span><span class="nv">today</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">(</span><span class="nb">year</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nv">integer</span><span class="p">)</span><span class="w"> </span><span class="k">as </span><span class="nc">string</span><span class="w">
</span><span class="k">set</span><span class="w"> </span><span class="nv">today</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">"-"</span><span class="w">
</span><span class="k">set</span><span class="w"> </span><span class="nv">today</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nv">zero_pad</span><span class="p">(</span><span class="nb">month</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nv">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">
</span><span class="k">set</span><span class="w"> </span><span class="nv">today</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">"-"</span><span class="w">
</span><span class="k">set</span><span class="w"> </span><span class="nv">today</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nv">zero_pad</span><span class="p">(</span><span class="nb">day</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nv">integer</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">

</span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"Things3"</span><span class="w">
    
    </span><span class="k">set</span><span class="w"> </span><span class="nv">todayIdentifiers</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="k">repeat</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">task</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">dos</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="s2">"Today"</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">properties</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">task</span><span class="w">
        </span><span class="nb">copy</span><span class="w"> </span><span class="na">id</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">todayIdentifiers</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">repeat</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">taggedTasks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="k">repeat</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">toDo</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">dos</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="s2">"Anytime"</span><span class="w">
        </span><span class="k">if</span><span class="w"> </span><span class="na">tag</span><span class="w"> </span><span class="nv">names</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">toDo</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="s2">"One A Day"</span><span class="w"> </span><span class="k">then</span><span class="w">
            </span><span class="k">set</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">properties</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">toDo</span><span class="w">
            </span><span class="k">if</span><span class="w"> </span><span class="nv">todayIdentifiers</span><span class="w"> </span><span class="ow">does not contain</span><span class="w"> </span><span class="na">id</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">then</span><span class="w">
                </span><span class="nb">copy</span><span class="w"> </span><span class="nv">toDo</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">taggedTasks</span><span class="w">
            </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
        </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">repeat</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">listSize</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">taggedTasks</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="nv">listSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">then</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">randomNumber</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">(</span><span class="nb">random number</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">listSize</span><span class="p">)</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">toDo</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="nv">randomNumber</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">taggedTasks</span><span class="w">
        </span><span class="nv">move</span><span class="w"> </span><span class="nv">toDo</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="s2">"Today"</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
    
    
    </span><span class="k">set</span><span class="w"> </span><span class="nv">listOfProjects</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="k">repeat</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">proj</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">projects</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">properties</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">proj</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">projectId</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">id</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">projectName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{</span><span class="nv">projectName</span><span class="p">:</span><span class="nv">projectName</span><span class="p">,</span><span class="w"> </span><span class="nv">projectId</span><span class="p">:</span><span class="nv">projectId</span><span class="p">}</span><span class="w">
        </span><span class="nb">copy</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">listOfProjects</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">repeat</span><span class="w">
    
    </span><span class="k">set</span><span class="w"> </span><span class="nv">listOfTasks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{}</span><span class="w">
    
    </span><span class="k">set</span><span class="w"> </span><span class="nv">tasks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">dos</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="s2">"Inbox"</span><span class="w">
    </span><span class="k">repeat</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">task</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">tasks</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">properties</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">task</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">projectName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s2">"Inbox"</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">taskName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{</span><span class="err">|</span><span class="na">name</span><span class="err">|</span><span class="p">:</span><span class="nv">taskName</span><span class="p">,</span><span class="w"> </span><span class="err">|</span><span class="nv">project</span><span class="err">|</span><span class="p">:</span><span class="nv">projectName</span><span class="p">}</span><span class="w">
        </span><span class="nb">copy</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">listOfTasks</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">repeat</span><span class="w">
    
    </span><span class="k">set</span><span class="w"> </span><span class="nv">tasks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">dos</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="s2">"Today"</span><span class="w">
    </span><span class="k">repeat</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">task</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">tasks</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">properties</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">task</span><span class="w">
        </span><span class="k">set</span><span class="w"> </span><span class="nv">projectName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="k">if</span><span class="w"> </span><span class="nb">exists</span><span class="w"> </span><span class="nv">project</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w"> </span><span class="k">then</span><span class="w">
            </span><span class="k">set</span><span class="w"> </span><span class="nv">projectId</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">id</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">project</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w">
            </span><span class="k">repeat</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">proj</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">listOfProjects</span><span class="w">
                </span><span class="k">if</span><span class="w"> </span><span class="nv">projectId</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">proj</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="nv">projectId</span><span class="w"> </span><span class="k">then</span><span class="w">
                    </span><span class="k">set</span><span class="w"> </span><span class="nv">projectName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">projectName</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">proj</span><span class="w">
                </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
            </span><span class="k">end</span><span class="w"> </span><span class="k">repeat</span><span class="w">
        </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
        
        </span><span class="k">set</span><span class="w"> </span><span class="nv">taskName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">props</span><span class="w">
        
        </span><span class="k">set</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{</span><span class="err">|</span><span class="na">name</span><span class="err">|</span><span class="p">:</span><span class="nv">taskName</span><span class="p">,</span><span class="w"> </span><span class="err">|</span><span class="nv">project</span><span class="err">|</span><span class="p">:</span><span class="nv">projectName</span><span class="p">}</span><span class="w">
        
        </span><span class="nb">copy</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">listOfTasks</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">repeat</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">


</span><span class="k">set</span><span class="w"> </span><span class="nv">exportPath</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s2">"~/Dropbox/Apps/Morning Briefing/things.plist"</span><span class="w">
</span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">plistData</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">{</span><span class="err">|</span><span class="nv">date</span><span class="err">|</span><span class="p">:</span><span class="nv">today</span><span class="p">,</span><span class="w"> </span><span class="nv">tasks</span><span class="p">:</span><span class="nv">listOfTasks</span><span class="p">}</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">rootDictionary</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">make</span><span class="w"> </span><span class="nb">new</span><span class="w"> </span><span class="k">property</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="na">properties</span><span class="w"> </span><span class="p">{</span><span class="nv">kind</span><span class="p">:</span><span class="nv">record</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="p">:</span><span class="nv">plistData</span><span class="p">}</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">export</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">make</span><span class="w"> </span><span class="nb">new</span><span class="w"> </span><span class="k">property</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="na">properties</span><span class="w"> </span><span class="p">{</span><span class="na">contents</span><span class="p">:</span><span class="nv">rootDictionary</span><span class="p">,</span><span class="w"> </span><span class="na">name</span><span class="p">:</span><span class="nv">exportPath</span><span class="p">}</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">tell</span></code></pre></figure>

<p>There‚Äôs quite a lot there but essentially it boils down to going through my Today list and sorting each task by its project. These all then get added to a plist (as easier to deal with in AppleScript than JSON) as an array of dictionaries containing the task name and project name which is then saved to my Dropbox where a PHP script on my server can access it and return it through my own API.</p>

<p>One habit I‚Äôve gotten into over the years is to create a number of short tasks that need to be done at some point and then tagging them ‚ÄúOne A Day‚Äù with the aim being to do one of them every day. In this way, small jobs around the house or minor tweaks to projects slowly get done over time rather than lingering around. To help with that, the script above will find all of my tasks tagged in such a way, pick one at random, and then move it to Today before the list is exported.</p>

<p>On the app side, this plist is fetched and then parsed in order to make it more palatable to the app by grouping the tasks into their projects and fixing a few minor issues i.e. tasks in Things marked as ‚ÄúThis Evening‚Äù still show up in the AppleScript as their project name so I rename their project to ‚Äúüåò This Evening‚Äù mimicking the waning crescent moon icon Things uses in its apps. I could likely do this within the AppleScript file but it‚Äôs just easier to do it in Swift!</p>

<p>In an ideal world this script would run automatically first thing in the morning so everything is synced up when I open the Apple TV app. Unfortunately this isn‚Äôt possible for me at the moment as I‚Äôm exclusively using an Apple Silicon MacBook Pro and I don‚Äôt leave it running continuously as I used to with my Mac Pro. For now, I need to run the script manually each morning (which is as simple as double clicking an exported app from Script Editor) but this will change once the Apple Silicon desktop machines launch!</p>

<h3 id="schedule">Schedule</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-schedule.jpg" width="800" height="450" />
    <figure><strong>Twirling Star:</strong> In the star position with your tummy button drawn inward, gently turn your head to look at one hand. Slowly turn to watch your hand as it goes behind you, relaxing in this position. Breathe normally. Perform slowly twice each side.</figure>
</div>

<p>Another habit I‚Äôve gotten into recently is scheduling my week in advance. I do this for my client work but also for things like what exercises I‚Äôm going to do or what meals I‚Äôm going to eat<sup id="fnref:schedulingfood" role="doc-noteref"><a href="#fn:schedulingfood" class="footnote" rel="footnote">5</a></sup>. Whilst I could have just typed it into a database to get it out of the API easily, it isn‚Äôt much fun manually entering data into an SQL client. Instead, I decided to use the calendar app on my mac and sync the data using Shortcuts on iOS. This is far easier as I can quickly type up my schedule on a Sunday and then sync it each day prior to starting the app.</p>

<div class="tangent">
    <h4>Tangent: Shortcuts</h4>
    <p>Shortcuts n√©e <a href="https://workflow.is">Workflow</a> is a powerful system app that allows you to join data from various apps together. I use it extensively for this app, mostly to get otherwise inaccessible data out of my iPhone and into my database so my API can send it to the app. For example:</p>
    <ul>
        <li><a href="https://www.icloud.com/shortcuts/091388091476450ab123fc223944e47d">Fetching my calendar entries for the day</a> and formatting them into a JSON array</li>
        <li>Retrieving my exercise minutes and step count from a custom HealthKit app I wrote</li>
        <li>Getting the amount of water I drank yesterday from Health</li>
        <li>Fetching my sleep stats from the AutoSleep app</li>
    </ul>
    <p>All of this data can then be packaged up in JSON and posted to my server using the poorly named "Get contents of" network action.</p>
    <p>The only downside is that I do have to trigger this manually as no app, not even Shortcuts, can access your Health database when your iPhone is locked so a shortcut set to run at a specific time won't work unless I'm using my phone. This hasn't proved too annoying though as I'm now in the habit of running the shortcut directly from a widget on my home screen before I launch the Apple TV app.</p>
</div>

<p>I divide the day up into five sections; Anytime (all-day tasks), Morning (before midday), Lunchtime (midday - 2pm), Afternoon (2pm - 5pm), and Evening (after 5pm). If there are items at a specific time then that time is displayed but mostly items will be from my Schedule calendar which is comprised of tasks tagged in a specific way. For example, for dinner I will create an all-day task named ‚Äú[food:dinner] Penne Bolognese‚Äù and the app will know to use the correct prefix and colour. Once again, SwiftUI becomes a joy to use for short interfaces like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">ScheduleView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">schedule</span><span class="p">:</span> <span class="kt">MorningBriefingResponse</span><span class="o">.</span><span class="kt">Schedule</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>

        <span class="kt">VStack</span><span class="p">()</span> <span class="p">{</span>
        
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Schedule"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
                        
            <span class="kt">VStack</span><span class="p">(</span><span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">,</span> <span class="nv">spacing</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
                
                <span class="kt">ForEach</span><span class="p">(</span><span class="n">schedule</span><span class="o">.</span><span class="n">formatted</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">section</span> <span class="k">in</span>
                    
                    <span class="kt">VStack</span><span class="p">(</span><span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">,</span> <span class="nv">spacing</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kt">Text</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
                        <span class="kt">Divider</span><span class="p">()</span>
                            <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">primary</span><span class="p">)</span>
                    <span class="p">}</span>
                        <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">leading</span><span class="p">,</span> <span class="mi">210</span><span class="p">)</span>
                    
                    <span class="kt">ForEach</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">entries</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">entry</span> <span class="k">in</span>
                        <span class="kt">HStack</span><span class="p">(</span><span class="nv">spacing</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kt">Text</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">())</span>
                                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">caption2</span><span class="p">)</span>
                                <span class="o">.</span><span class="nf">bold</span><span class="p">()</span>
                                <span class="o">.</span><span class="nf">multilineTextAlignment</span><span class="p">(</span><span class="o">.</span><span class="n">leading</span><span class="p">)</span>
                                <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="kt">Color</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">color</span> <span class="p">??</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
                                <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">trailing</span><span class="p">)</span>
                            
                            <span class="kt">Text</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
                                <span class="o">.</span><span class="nf">multilineTextAlignment</span><span class="p">(</span><span class="o">.</span><span class="n">leading</span><span class="p">)</span>
                            <span class="kt">Spacer</span><span class="p">()</span>
                        <span class="p">}</span><span class="o">.</span><span class="nf">opacity</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="kt">Spacer</span><span class="p">()</span>
                        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">height</span><span class="p">:</span> <span class="mi">40</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="kt">Spacer</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The entire interface took less than 5 minutes to create and avoided the usual need to create either a reusable cell in a table view or a custom view to be added to a stack view dynamically.</p>

<h3 id="sleep">Sleep</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-sleep.jpg" width="800" height="450" />
    <figure><strong>Twisting Star:</strong> From the star position, raise your arms and put your hands up. Bring your left elbow across your body to your raised right knee. Repeat the movement using your right elbow and left knee. Remain upright as you continue to alternate sides for 15 seconds. Breathe freely and enjoy.</figure>
</div>

<p>Getting more sleep is usually the simplest way you can improve your life. If you‚Äôre getting less than 8 hours a day then sleeping more will improve your mood, cognition, memory, and help with weight loss and food cravings. I used to be terrible for sleep, typically getting 5 hours or less a day, but a concerted effort this year had me at an 8 hour average for most of January and February.</p>

<p>I use the excellent <a href="https://apps.apple.com/gb/app/autosleep-track-sleep-on-watch/id1164801111">AutoSleep</a> app on Apple Watch to track my sleep. The counterpart iOS app can reply to a Siri Shortcut by pasting a dictionary of your sleep data to the clipboard making it trivial to export and use as part of a workflow (although it also saves to HealthKit so you could just export it from there as well depending on what stats you are after).</p>

<p>The interface above is about to become fairly familiar as I use it for a number of metrics within the app. It comprises of 3 rings in an Apple Activity style giving me the sleep duration for last night, the nightly average over the last week, and the nightly average for the current year. Each ring is aiming to hit the 8 hour target and I write the duration as both time and percentage within each ring.</p>

<div class="tangent">
    <h4>Tangent: Rings</h4>
    <p>The rings themselves are provided by <a href="https://github.com/maxkonovalov/MKRingProgressView">MKRingProgressView</a> which are Swift views for use within UIKit apps. To get them to work in SwiftUI was relatively straightforward requiring only that I write a small class conform to <code>UIViewRepresentable</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">MKRingProgressView</span>

<span class="kd">struct</span> <span class="kt">ProgressRingView</span><span class="p">:</span> <span class="kt">UIViewRepresentable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">progress</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="k">var</span> <span class="nv">ringWidth</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="k">var</span> <span class="nv">startColor</span><span class="p">:</span> <span class="kt">UIColor</span>
    <span class="k">var</span> <span class="nv">endColor</span><span class="p">:</span> <span class="kt">UIColor</span>

    <span class="kd">func</span> <span class="nf">makeUIView</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">RingProgressView</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">view</span> <span class="o">=</span> <span class="kt">RingProgressView</span><span class="p">()</span>
        <span class="n">view</span><span class="o">.</span><span class="n">ringWidth</span> <span class="o">=</span> <span class="n">ringWidth</span>
        <span class="k">return</span> <span class="n">view</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">updateUIView</span><span class="p">(</span><span class="n">_</span> <span class="nv">uiView</span><span class="p">:</span> <span class="kt">RingProgressView</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">uiView</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="n">progress</span>
        <span class="n">uiView</span><span class="o">.</span><span class="n">startColor</span> <span class="o">=</span> <span class="n">startColor</span>
        <span class="n">uiView</span><span class="o">.</span><span class="n">endColor</span> <span class="o">=</span> <span class="n">endColor</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

    <p>Each ring can then be created in SwiftUI as simply as:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kt">ProgressRingView</span><span class="p">(</span><span class="nv">progress</span><span class="p">:</span> <span class="n">progress</span><span class="p">,</span> <span class="nv">ringWidth</span><span class="p">:</span> <span class="n">size</span><span class="o">.</span><span class="n">ringWidth</span><span class="p">,</span> <span class="nv">startColor</span><span class="p">:</span> <span class="n">startColor</span><span class="p">,</span> <span class="nv">endColor</span><span class="p">:</span> <span class="n">endColor</span><span class="p">)</span></code></pre></figure>

    <p>The only issue with this is that it's slow, especially on the Apple TV hardware which is several chip cycles behind modern iPhones. It may be the <code>MKRingProgressView</code> class itself is quite heavy going but I get the feeling translating it to work with SwiftUI and then pushing the whole SwiftUI view back to UIKit via <code>UIHostingController</code> might also be adding some lag. Overall it isn't a problem but it does mean that the view takes a half second to load.</p>
</div>

<h3 id="alcohol">Alcohol</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-alcohol.jpg" width="800" height="450" />
    <figure><strong>Trap Openers:</strong> Breathe deeply, calmly, and relax your tummy. Let your head hang slightly forward and gently turn your head from one side to the other. Then, using your fingers, gently massage the area just below the back of your head. Move down to the base of your neck, then relax your shoulders and slowly roll them backwards and forwards. Repeat for 15 seconds.</figure>
</div>

<p>As part of a concerted effort to improve my health, the amount of alcohol I was drinking had to come down fairly significantly. I‚Äôve tried many habit tracking apps in the past mostly in the form of maintaining a chain; the problem I have with them is that once the chain is broken I tend to go all out (i.e. if I‚Äôm going to get a black mark to say ‚Äúdrank alcohol‚Äù for having a glass of wine I may as well have a bottle of wine). To remedy that I take the idea of chaining but also pair it with the government guidelines for alcohol consumption which is 14 units a week for men.</p>

<p>The data for this is manually input into my SQL database for now but I have other apps I‚Äôm working on that interact with those tables. For now, I add what I‚Äôve drank and how many units along with a date and the API then returns the data you see above; how many units I drank yesterday, how many days since I last had something alcoholic (if yesterday was 0 units), the number of units I‚Äôve drank in the last 7 days, and a weekly average for the past 3 months. This differs slightly from the other ring-based metrics in the app as rather than a daily average over 7 days I needed to fetch a cumulative sum to ensure I wasn‚Äôt going over 14 units in a 7 day period. The weekly average is also interesting as I needed to go through each Monday-Sunday period of the past 3 months and get a cumulative total before averaging that.</p>

<p>This system has worked very well for me with the result being an average of 1 glass of wine and 1 beer a week which is down significantly from what was likely around 4 bottles of wine and several beers a week. I also had a dry spell of over 2 weeks which is likely the longest duration in around 10 years. I have a lot more thoughts around alcohol tracking and logging which I‚Äôll come back to in a future side project.</p>

<p>The one update I might make to this page is to show how much water I‚Äôm drinking a day. I track my water intake via <a href="https://apps.apple.com/gb/app/waterminder/id653031147">WaterMinder</a> and already sync the data to my server using the Shortcut I‚Äôve mentioned previously. Originally I had a whole page for showing this data but I dropped it in favour of some more important metrics as I found my water levels were pretty consistent once I‚Äôd gotten into the habit of drinking more. It looks like it‚Äôs not something I need to keep an eye on quite so much but if I do bring it back I think it will be on this page.</p>

<h3 id="steps">Steps</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-steps.jpg" width="800" height="450" />
    <figure><strong>The Eagle:</strong> Take your arms out to the side and slowly raise them above your head breathing in and keeping your shoulder blades together. Touch your hands together above your head. Slowly lower your hands to your sides while breathing out. Perform 3 times. This will help the movement of air in and out of your lungs.</figure>
</div>

<p>Along with doing my morning stretches, my chiropractor was also very adamant that I needed to increase my physical exercise as my step count was a rather woeful average of 6000 steps per day in 2020<sup id="fnref:stepcount" role="doc-noteref"><a href="#fn:stepcount" class="footnote" rel="footnote">6</a></sup>. To that end I‚Äôve started running again on my treadmill and going for multiple walks each day.</p>

<p>Whilst the data above is rendered in much the same way as the sleep data, getting it is far tricker than you might think due to the complication of having an Apple Watch and an iPhone. If you use Shortcuts to fetch your data from Health, then it isn‚Äôt possible to deduplicate properly and so you‚Äôll end up with a total number of steps from both your Apple Watch and iPhone which is bad if you ever walk around with both devices at the same time which I obviously do. You can limit the fetch to a single device but then you run into problems as you won‚Äôt be recording any steps whilst your watch is charging for instance. I don‚Äôt know how this error has been allowed to continue for so long in Shortcuts but the solution is rather simple for iOS apps: you use a <code class="language-plaintext highlighter-rouge">HKStatisticsQuery</code> along with the <code class="language-plaintext highlighter-rouge">.cumulativeSum</code> and <code class="language-plaintext highlighter-rouge">.separateBySource</code> options. Unfortunately this meant I needed to write an iOS app to fetch my steps data along with an Intent Extension to allow that to then be exported via Siri Shortcuts.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">StepsService</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">HKHealthStore</span><span class="p">()</span>
    
    <span class="kd">func</span> <span class="nf">authorize</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">quantityType</span> <span class="o">=</span> <span class="kt">HKObjectType</span><span class="o">.</span><span class="nf">quantityType</span><span class="p">(</span><span class="nv">forIdentifier</span><span class="p">:</span> <span class="kt">HKQuantityTypeIdentifier</span><span class="o">.</span><span class="n">stepCount</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="n">store</span><span class="o">.</span><span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">toShare</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">read</span><span class="p">:</span> <span class="p">[</span><span class="n">quantityType</span><span class="p">])</span> <span class="p">{</span> <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Authorized"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="k">for</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span><span class="p">,</span> <span class="n">onCompletion</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">quantityType</span> <span class="o">=</span> <span class="kt">HKObjectType</span><span class="o">.</span><span class="nf">quantityType</span><span class="p">(</span><span class="nv">forIdentifier</span><span class="p">:</span> <span class="kt">HKQuantityTypeIdentifier</span><span class="o">.</span><span class="n">stepCount</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">fatalError</span><span class="p">(</span><span class="s">"StepCount quantity doesn't exist"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">let</span> <span class="nv">start</span> <span class="o">=</span> <span class="kt">Calendar</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="nf">startOfDay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span>
        
        <span class="k">var</span> <span class="nv">dayComponent</span> <span class="o">=</span> <span class="kt">DateComponents</span><span class="p">()</span>
        <span class="n">dayComponent</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">tomorrow</span> <span class="o">=</span> <span class="kt">Calendar</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">byAdding</span><span class="p">:</span> <span class="n">dayComponent</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">end</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">(</span><span class="nv">timeIntervalSince1970</span><span class="p">:</span> <span class="kt">Calendar</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="nf">startOfDay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">tomorrow</span><span class="p">)</span><span class="o">.</span><span class="n">timeIntervalSince1970</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">predicate</span> <span class="o">=</span> <span class="kt">HKQuery</span><span class="o">.</span><span class="nf">predicateForSamples</span><span class="p">(</span><span class="nv">withStart</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="n">end</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">strictStartDate</span><span class="p">,</span> <span class="o">.</span><span class="n">strictEndDate</span><span class="p">])</span>
        <span class="k">let</span> <span class="nv">query</span> <span class="o">=</span> <span class="kt">HKStatisticsQuery</span><span class="p">(</span><span class="nv">quantityType</span><span class="p">:</span> <span class="n">quantityType</span><span class="p">,</span> <span class="nv">quantitySamplePredicate</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">cumulativeSum</span><span class="p">,</span> <span class="o">.</span><span class="n">separateBySource</span><span class="p">])</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">,</span> <span class="k">let</span> <span class="nv">sum</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="nf">sumQuantity</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nf">completionHandler</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                
                <span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="kt">Int</span><span class="p">(</span><span class="n">sum</span><span class="o">.</span><span class="nf">doubleValue</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">HKUnit</span><span class="o">.</span><span class="nf">count</span><span class="p">()))</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">store</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">StepsIntentHandler</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">StepsIntentHandling</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">intent</span><span class="p">:</span> <span class="kt">StepsIntent</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">StepsIntentResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">components</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="kt">Calendar</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">components</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="kt">StepsIntentResponse</span><span class="p">(</span><span class="nv">code</span><span class="p">:</span> <span class="o">.</span><span class="n">failure</span><span class="p">,</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="nf">completion</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="k">let</span> <span class="nv">stepsService</span> <span class="o">=</span> <span class="kt">StepsService</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">exerciseService</span> <span class="o">=</span> <span class="kt">ExerciseService</span><span class="p">()</span>
        <span class="n">stepsService</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="k">in</span>
            <span class="n">exerciseService</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">minutes</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="kt">StepsIntentResponse</span><span class="p">(</span><span class="nv">code</span><span class="p">:</span> <span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
                
                <span class="k">var</span> <span class="nv">activity</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Int</span><span class="p">]()</span>
                <span class="n">activity</span><span class="p">[</span><span class="s">"steps"</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
                <span class="n">activity</span><span class="p">[</span><span class="s">"exercise"</span><span class="p">]</span> <span class="o">=</span> <span class="n">minutes</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">activity</span><span class="p">),</span> <span class="k">let</span> <span class="nv">output</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nf">completion</span><span class="p">(</span><span class="kt">StepsIntentResponse</span><span class="p">(</span><span class="nv">code</span><span class="p">:</span> <span class="o">.</span><span class="n">failure</span><span class="p">,</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                
                <span class="n">response</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
                <span class="nf">completion</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>After opening the app and authorising it for read access on my HealthKit store, it now sits hidden in the App Library and is woken each morning as my sync shortcut requests the data and sends it to my server. It‚Äôs a long winded solution but it works!</p>

<h3 id="exercise">Exercise</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-exercise.jpg" width="800" height="450" />
    <figure><strong>The Hummingbird:</strong> Put your arms to the side with your hands up. Pull your shoulders together. Next, make small backward circles with your hands and arms drawing your shoulder blades together. Sway gently from side to side in The Hummingbird. Keep it going while you count to 10.</figure>
</div>

<p>The exercise view is pretty much identical to the steps view previously only with different data input, colour, and a goal of 30 minutes. Originally I used the native Health actions within Shortcuts to extract the exercise minutes but then I ran into similar duplication issues if I wore my Apple Watch whilst doing a work out on my Peleton bike as that too would add an exercise. To make things simple I added exercise minutes to the same exporter app I mentioned above.</p>

<h3 id="youtube">YouTube</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-youtube.jpg" width="800" height="450" />
    <figure><strong>The Butterfly:</strong> Place your hands behind your head and gently draw your elbows backwards. Slowly and gently press your head backwards against your hands for a count of two. Release, again slowly and gently. Keeping your hands in this position, perform 3 times. This will make you more relaxed and improve your sense of wellbeing.</figure>
</div>

<p>Whilst I‚Äôm on my treadmill I‚Äôll typically watch a variety of videos I‚Äôve saved on YouTube. This screen shows me the number of videos left in my ‚ÄúTo Watch‚Äù playlist along with the total runtime<sup id="fnref:youtuberuntime" role="doc-noteref"><a href="#fn:youtuberuntime" class="footnote" rel="footnote">7</a></sup>. I then show the details of five videos; the most recently added, the two oldest, and then two random ones from those that are left. In this way I get to know which videos have been sat a while and that I should really watch whilst also seeing something that is likely more exciting to me right now as I added it most recently. I‚Äôm not forced to watch these particular videos but I find I usually do choose them as it‚Äôs one less thing to think about when I get onto the treadmill.</p>

<p>Fetching the videos is relatively easy using the YouTube API as a single request can give you all the video details for a single playlist. Unfortunately, and for reasons I don‚Äôt understand, YouTube doesn‚Äôt provide access to the default ‚ÄúWatch Later‚Äù playlist even with an authenticated request so I had to create a public playlist named ‚ÄúTo Watch‚Äù and then remember to add all of my videos to that. It‚Äôs a bit of a pain as I nearly always want to just click the ‚ÄúWatch Later‚Äù button on YouTube but I‚Äôm slowly getting used to adding to the playlist instead.</p>

<h3 id="pocket">Pocket</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-articles.jpg" width="800" height="450" />
    <figure><strong>Tight Rope:</strong> In the stand tall position pull your tummy in. Take a step forward as if on a tightrope. Make sure your knee is over your ankle and not over your toes. Allow the heel of your back foot to lift. Balance in this position for 20 seconds. Don't worry if you wobble a bit, it's normal. Repeat on the opposite side.</figure>
</div>

<p>In a similar vein to the YouTube page, I do something very similar to show me the articles I currently have to read in Pocket<sup id="fnref:pocketrocket" role="doc-noteref"><a href="#fn:pocketrocket" class="footnote" rel="footnote">8</a></sup>. I connect directly to the Pocket API and return the number of articles remaining, the estimated reading time of them all, and then 5 articles as a mixture of newest, oldest, and random entries.</p>

<h3 id="coding">Coding</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-projects.jpg" width="800" height="450" />
    <figure><strong>The Rocker:</strong> Stand tall with your feet wider than shoulders. Gently rotate your upper body from side to side. Let your arms flop loosely as you shift your weight from knee to knee. Breathe calmly and deeply. Continue for 15 seconds.</figure>
</div>

<p>I mentioned previously that I like to have a couple of ‚ÄúOne A Day‚Äù tasks so I can make slow and steady progress on items over time. This is also true of my own personal projects such as this app which will often remain nothing but ideas unless time is carved out to work on them. To help with that, I maintain a list of the projects I‚Äôm working on and then have the API pick one at random each day to show me; the idea then is that I will work on that app for at least 18 minutes<sup id="fnref:eighteenminutes" role="doc-noteref"><a href="#fn:eighteenminutes" class="footnote" rel="footnote">9</a></sup> during the day. It‚Äôs a system that has worked well for me and gets around the issue of the current favourite project getting all of my attention.</p>

<div class="tangent">
    <h4>Tangent: Choices Choices</h4>
    <p>There is a theory that "<a href="https://www.behavioraleconomics.com/resources/mini-encyclopedia-of-be/choice-overload/">Overchoice</a>" or "Choice Overload" occurs when we are presented with too many options and that it causes us stress and slows down our process of choosing whilst also sapping our energy reserves. The original studies of this from the '70s have since been called into question but I personally find that oftentimes if I'm given the freedom to do anything I'll end up doing nothing as I can't choose between the numerous options available to me. This is true of what I should watch, read, play, and work on in my spare time. My solution, as briefly alluded to above with YouTube videos and Pocket articles, is to take a subsection and return them randomly so that I don't have to pick.</p>
    <p>This is something I also use with my personal projects, books, and games; rather than have all the options available to me, I take the items that are currently active and then the app will return a single result each day. This avoids any decision making on my part as if I want to do some coding I already know what project it will be on or if I'm going to read I know which of my current books it will be. The only rules I set myself are that if I really want to do something else, I must meet the minimum requirement for the day on the original choice first (i.e. lets say I want to work on my Lord of the Rings LCG app but I've been assigned Pocket Rocket, then I work on Pocket Rocket for the 18 minutes to fulfill my daily goal and then I'm free to work on whatever I like).</p>
    <p>The one thing I'm particularly mindful of with this approach is that I may need to tweak how random it actually is. With true randomness, I could get the same result every day for a week and generally I'll want to mix things up a bit. It's also the case that I don't necessarily have time for my hobbies every day so I might have 2 days reading the same book and then go 3 days without reading anything; when I get to the 6th day the same book is randomly returned and I've missed out on the other books on the previous days. The only way around this is likely to remove results if my database sees I've spent concurrent days on the same item. I've also started restricting these choices to just 3 active items at a time as otherwise there are a few too many for the randomness to work nicely.</p>
</div>

<p>For logging time on projects, I have written a small app named ‚ÄúTime Well Spent‚Äù which I‚Äôll be covering in a future side projects article. This data is then stored in my database where my API returns it for rendering the three activity rings in a similar way to the steps or exercise rings covered earlier.</p>

<h3 id="reading">Reading</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-reading.jpg" width="800" height="450" />
    <figure><strong>The Triangle:</strong> Stand tall with your feet wider than your shoulders and your tummy in. Turn your foot outwards as you lean to that side. Feel the gentle stretch on the inside of your leg. Your knee should be above your ankle. Lean over so your elbow can rest on your bent knee as you stretch your arm over your upper body. Do this slowly so you have more control. Stretch for 10 seconds on each side.</figure>
</div>

<p>I‚Äôm a big believer in the power of <a href="https://nesslabs.com/inspiration-to-idea-sex">Idea Sex</a>, the notion that by juggling several different thoughts together you‚Äôll trigger more creative thinking. One way to do this is to read multiple books at the same time rather than reading in a linear fashion. As you may be able to guess from the tangent box above, I do this with books by having the app tell me what book I‚Äôm going to read today from the pool of books I‚Äôm currently reading. Beneath that I render the familiar three activity rings based on data I‚Äôve logged via my ‚ÄúTime Well Spent‚Äù app and a 30 minute daily goal. I might also add a tally of how many books I‚Äôve completed this year at some point but for now this is working well.</p>

<p>I listen to an audiobook on most of my evening walks and have recently begun tracking that data as well. It‚Äôs likely that I may try juggling multiple audiobooks and use a similar system to the above to pick one for me each day.</p>

<h3 id="games">Games</h3>

<div class="gofigure">
    <img src="https://bendodson.s3.amazonaws.com/weblog/2021/stoutness-games.jpg" width="800" height="450" />
    <figure><strong>Shaking Loose:</strong> Now it's time to let go. Shake your limbs loosely for 15 seconds.</figure>
</div>

<p>The final screen was originally intended to be a bit of a sweetener to force me to do my stoutness routine every day; it tells me what video game I can play today. However, the amount of time I‚Äôm spending on video games has dropped fairly dramatically this year taken up by an increase in exercise and board games and (soon) a newborn baby. It‚Äôs no longer quite the pull it once was but I‚Äôve managed to go through this routine every day so far this year so I‚Äôm not too concerned!</p>

<p>I‚Äôve long tracked my gaming hobby as I used to run a website where I‚Äôd output my currently logged time and write reviews. I have a dedicated app for this purpose which I‚Äôm currently migrating into ‚ÄúTime Well Spent‚Äù but I also have some automated scripts to fetch my play time from services such as Steam and Xbox Live. In addition, I have a number of game collections which I can query such as ‚ÄúCurrently Playing‚Äù and ‚ÄúTo Play‚Äù. Using these, it was very easy to render the above page showing which game I‚Äôm allowed to play today but also giving me a secondary choice should I complete that game<sup id="fnref:completegame" role="doc-noteref"><a href="#fn:completegame" class="footnote" rel="footnote">10</a></sup>.</p>

<p>I don‚Äôt use the activity rings to render the average data as I don‚Äôt have a goal for how much time I want to play for whereas steps, exercise, projects, and reading are all things I want to do a certain minimum of (or maximum in the case of alcohol).</p>

<h3 id="conclusion">Conclusion</h3>

<p>As of the time of writing, I‚Äôve spent 24.4 hours working on the Stoutness app from its origins as a printed daily report to the Apple TV app it is now complete with its suite of data providers from AppleScript apps to Shortcut workflows. Since using it daily from the start of the year I‚Äôve had huge improvements in nearly all of the metrics I track; I‚Äôm sleeping longer, drinking less, exercising more, and reading more. I‚Äôve also noticed big improvements in my health with my daily stretching leading to more flexibility<sup id="fnref:flexing" role="doc-noteref"><a href="#fn:flexing" class="footnote" rel="footnote">11</a></sup> and less aches and my average resting heart rate falling from ~70bpm to ~50bpm. Finally, I‚Äôve lost over 22lbs since using the app which is just over 10% of my starting weight; that isn‚Äôt all attributable to this app but it has definitely helped by encouraging me to keep working on the various rings that I see every morning.</p>

<p>With a lot of side project apps I often think about how they can be adapted so others can make use of them but in this case what I have is a highly specialised app bespoke to me‚Ä¶ and that‚Äôs OK! One of the great joys of being a developer is that you can take seemingly disparate data and merge it together into something just for you. Hopefully this article will inspire you to do likewise and learn some new coding skills whilst building something to help you in your own life.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:whatsmyupdate" role="doc-endnote">
      <p>Originally I would have done this using text-to-voice within an app but obviously it‚Äôs far easier to do it with Siri Shortcuts nowadays such as this <a href="https://www.icloud.com/shortcuts/e9889b4b8f74461d933e838acae9bd58">Morning Routine</a> by <a href="https://www.macstories.net/shortcuts/">MacStories</a>. Also, with HomePod update 14.2 it is now possible to say ‚ÄúWhat‚Äôs my update‚Äù and get something similar.¬†<a href="#fnref:whatsmyupdate" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:navigator" role="doc-endnote">
      <p>I‚Äôd envisioned it being a little like the <a href="https://www.wdwinfo.com/wdwinfo/cruise-new/cr-stateroom-navigator.htm">Personal Navigator</a> that used to get printed on Disney Cruises showing you the schedule for the next day along with weather and other pertinent information.¬†<a href="#fnref:navigator" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:newsphilosophy" role="doc-endnote">
      <p>I despise rolling news and the culture of ‚Äúinformation now‚Äù which is why I subscribe to a newspaper. I like to get a clear picture of the days news after the dust has settled rather than the incessant guessing at what is happening, about to happen, and the reaction of what just happened. Don‚Äôt get me started on ‚Äú[public figure] is expected to say‚Äù with announcement previews.¬†<a href="#fnref:newsphilosophy" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:thingsapi" role="doc-endnote">
      <p>Well that‚Äôs not strictly true. There is a private API as data is synced to Things Cloud but I don‚Äôt fancy reverse engineering that!¬†<a href="#fnref:thingsapi" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:schedulingfood" role="doc-endnote">
      <p>I used a meal planning app for a while but it was too much hassle to peck everything in on an iPad; now I just create an all-day event in a dedicated calendar. Why plan meals? Mostly because I‚Äôm terrible with letting food expire especially at the moment where recent food shortages at supermarkets have led to shorter shelf lives on several products.¬†<a href="#fnref:schedulingfood" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:stepcount" role="doc-endnote">
      <p>The real average was likely lower as there were 2 weeks in Walt Disney World where I was over 20k steps every day which would skew the averages.¬†<a href="#fnref:stepcount" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:youtuberuntime" role="doc-endnote">
      <p>Rather than returning something normal like seconds, YouTube returns video durations in a format like PT24M49S which required an extra bit of working around.¬†<a href="#fnref:youtuberuntime" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:pocketrocket" role="doc-endnote">
      <p>Obligatory ‚Äú<a href="https://apps.apple.com/us/app/pocket-rocket-quickly-read/id1062699303?ls=1">go check out my Pocket app</a>‚Äù comment.¬†<a href="#fnref:pocketrocket" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:eighteenminutes" role="doc-endnote">
      <p>18 minutes is a bit specific you might very well think but there‚Äôs a (sort of) good reason. My database first started logging games and these were done in a decimal format of hours to one decimal place as that‚Äôs how they came from Steam thus all of my gaming time is broken down into 6 minute chunks. When I added other items to the tracking system I kept the same format and this persisted when I started tracking how much time I was spending on personal projects; whilst I‚Äôd probably prefer it to be a goal of 15 or 20 minutes a day, it‚Äôs 18 so it can be represented cleanly as 0.3 hours in the database. I could make the ring show 20 minutes but then it would always be not quite full or over full and that seems messy.¬†<a href="#fnref:eighteenminutes" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:completegame" role="doc-endnote">
      <p>This is something I‚Äôve also thought about adding for books but it‚Äôs slightly different as I know how long it will take me to finish a book ‚Äî you can see how many pages are left ‚Äî but it isn‚Äôt always obvious how much you have left of a game hence the need for a backup if I sit down and finish the current one in short order.¬†<a href="#fnref:completegame" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:flexing" role="doc-endnote">
      <p>At the start of the year I used to struggle to touch my knees with my elbows for the ‚ÄúTwisting Star‚Äù exercise as I just couldn‚Äôt bend that well; now I can do it with no problems. Hooray for basic levels of fitness!¬†<a href="#fnref:flexing" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

		</div>
	</article>
    
	
</section>


<section id="pagination">
     
    	<a href="/weblog/page/2/" title="Previous Page" class="pagination-previous">&laquo; Older Entries</a>
     
	
    
</section>

		
		<footer>
			<p>I perform all freelance work through my company <strong>Dodo Apps Ltd</strong> (07856552) registered at The Bristol Office, 2nd Floor, 5 High Street, Westbury on Trym, Bristol, England, BS9 3BY</p>
		</footer>

	</div>


</body>
</html>